/*
  SFMediaStream
  HTML5 media streamer library for playing music, video, playlist,
  or even live streaming microphone & camera with node server

  https://github.com/ScarletsFiction/SFMediaStream
*/
"use strict";window.ScarletsAudioBufferStreamer=function(e,n){(!e||e<3)&&(e=3),n||(n=1e3);var t=this;t.debug=!1,t.bufferElement=[],t.bufferAvailable=[],t.bufferPending=[],t.currentBuffer=0,t.playing=!1,t.buffering=!1,t.streaming=!1,t.currentDuration=!1,t.latency=0,t.error=0,t.realtime=!1,t.bufferSkip=.07,t.mimeType=null,t.webAudio=!!ScarletsMedia.convert.isMobile(),t.audioContext=ScarletsMedia.audioContext;var a=!1;t.setBufferHeader=function(e){e?(a=e,e.byteLength,t.audioContext&&t.audioContext.decodeAudioData(e.slice(0),function(e){t.bufferSkip=e.duration})):a=!1};for(var i=function(e){t.bufferElement[e].onended=function(){t.debug&&console.log("Buffer ended with ID: "+e),t.webAudio?this.disconnect(0):(URL.revokeObjectURL(t.bufferElement[e].src),t.bufferElement[e].src=""),t.realtime||(t.bufferAvailable[e]=!1,t.playing=!1,t.buffering=!0,t.playAvailable(),-1!=t.bufferAvailable.indexOf(!1)&&0!=t.bufferPending.length&&l())}},r=0;r<e;r++)o(r);function o(e){if(t.webAudio)t.bufferElement.push(t.audioContext.createBufferSource()),t.bufferAvailable.push(!1);else{var n=new Audio;n&&(t.bufferElement.push(n),t.bufferAvailable.push(!1),i(e))}}function c(e,n){var a=t.bufferElement[e].onended;t.bufferElement[e]=t.audioContext.createBufferSource(),t.bufferElement[e].buffer=n,t.bufferElement[e].connect(t.audioContext.destination),t.bufferElement[e].onended=a}t.receiveBuffer=function(a){if(t.debug&&console.log("Receiving data",a[0].byteLength),t.streaming){var i=a[1];if(t.realtime=!1,n){for(var r=t.bufferPending.length,o=0;o<e;o++)t.bufferAvailable[o]&&r++;t.latency=Number(String(Date.now()).slice(-5,-3))-i+n*r+t.audioContext.baseLatency,t.debug&&console.log("Total latency: "+t.latency)}t.bufferPending.push(a[0]),l(),t.buffering&&t.playAvailable()}};var u=new FileReader,d=0;t.realtimeBufferPlay=function(e){t.debug&&console.log("Receiving data",e[0].byteLength),t.latency=Number(String(Date.now()).slice(-5,-3))-e[1]+n/1e3+t.audioContext.baseLatency,t.realtime=!0;var i=d;++d>2&&(d=0),t.webAudio?(u.onload=function(){t.audioContext.decodeAudioData(this.result,function(e){c(i,e),t.bufferElement[i].start(t.bufferSkip)})},u.readAsArrayBuffer(new Blob([a,e[0]],{type:t.mimeType}))):(URL.revokeObjectURL(t.bufferElement[i].src),t.bufferElement[i].src=URL.createObjectURL(new Blob([a,e[0]],{type:t.mimeType})),t.bufferElement[i].load(),t.bufferElement[i].play(),t.bufferElement[i].currentTime=t.bufferSkip)};var l=function(){var e=t.bufferAvailable.indexOf(!1,t.currentBuffer);-1==e&&(e=t.bufferAvailable.indexOf(!1)),-1!=e&&0!=t.bufferPending.length&&(t.webAudio?(u.onload=function(){t.audioContext.decodeAudioData(this.result,function(n){c(e,n)})},u.readAsArrayBuffer(new Blob([a,t.bufferPending[0]],{type:t.mimeType}))):(t.bufferElement[e].src=URL.createObjectURL(new Blob([a,t.bufferPending[0]],{type:t.mimeType})),t.bufferElement[e].load()),t.bufferPending.shift(),t.bufferAvailable[e]=!0,t.buffering&&t.playAvailable(),t.debug&&console.log("Buffer updated with ID: "+e))};t.playBuffer=function(e){t.bufferElement[e].duration&&(t.debug&&console.log("Current stream duration: "+t.bufferElement[e].duration),!1!==n?(t.buffering=!1,t.playing=!0,n=t.bufferElement[e].duration,t.bufferElement[e].start?t.bufferElement[e].start(t.bufferSkip):(t.bufferElement[e].play(),t.bufferElement[e].currentTime=t.bufferSkip),t.currentBuffer=e,t.debug&&console.log("Playing buffer ID: "+t.currentBuffer)):n=t.bufferElement[e].duration)},t.playAvailable=function(){if(!t.playing){if(t.bufferAvailable[t.currentBuffer])return t.playBuffer(t.currentBuffer);var e=t.bufferAvailable.indexOf(!0,t.currentBuffer);return-1!=e?t.playBuffer(e):-1!=(e=t.bufferAvailable.indexOf(!0))?t.playBuffer(e):void 0}},t.playStream=function(){t.streaming=t.buffering=!0},t.stop=function(){t.bufferPending.splice(0);for(var n=0;n<e;n++)t.bufferElement[n].stop(),i(n),t.bufferAvailable[n]=!1;t.playing=!1,t.buffering=!1,t.currentBuffer=0}},window.ScarletsMedia={audioContext:!!window.AudioContext&&new AudioContext,elementNode:function(e){return e.crossOrigin="anonymous",this.audioContext.createMediaElementSource(e)}},ScarletsMedia.convert={midiToFreq:function(e){return e<=-1500?0:e>1499?3.282417553401589e38:440*Math.pow(2,(Math.floor(e)-69)/12)},freqToMidi:function(e){return e>0?Math.floor(Math.log(e/440)/Math.LN2*12+69):-1500},powerToDb:function(e){if(e<=0)return 0;var n=100+10/Math.LN10*Math.log(e);return n<0?0:n},dbToPower:function(e){return e<=0?0:(e>870&&(e=870),Math.exp(.1*Math.LN10*(e-100)))},ampToDb:function(e){return 20*(e>1e-5?Math.log(e)/Math.LN10:-5)},dbToAmp:function(e){return Math.pow(10,e/20)},velToAmp:function(e){return e/127}},window.ScarletsMediaPlayer=function(e){var n=this,t=["autoplay","loop","buffered","buffered","controller","currentTime","currentSrc","duration","ended","error","readyState","networkState","paused","played","seekable","seeking"];"video"===e.tagName.toLowerCase()&&(t=t.concat(["poster","height","width"])),n.load=function(){e.load()},n.canPlayType=function(){e.canPlayType()};for(var a=0;a<t.length;a++)ScarletsMedia.extra.objectPropertyLinker(n,e,t[a]);n.preload=!0,e.preload="metadata",n.audioFadeEffect=!0,n.speed=function(n){if(void 0===n)return e.defaultPlaybackRate;e.defaultPlaybackRate=e.playbackRate=n},n.mute=function(n){if(void 0===n)return e.muted;e.defaultMuted=e.muted=n};var i=1;n.volume=function(n){if(void 0===n)return i;e.volume=i=n},n.play=function(t){if(e.paused){if(n.audioFadeEffect)return e.volume=0,e.play(),void ScarletsMedia.extra.fadeNumber(0,i,.02,400,function(n){e.volume=n},t);e.play(),t&&t()}else t&&t()},n.pause=function(t){e.paused?t&&t():n.audioFadeEffect?ScarletsMedia.extra.fadeNumber(i,0,-.02,400,function(n){e.volume=n},function(){e.pause(),t&&t()}):(e.pause(),t&&t())},n.prepare=function(t,a,i){if(!i&&!e.paused)return n.pause(function(){n.prepare(t,a,!0)});for(var r=e.querySelectorAll("source"),o=r.length-1;o>=0;o--)r[o].remove();if("string"==typeof t)e.insertAdjacentHTML("beforeend",'<source src="'+t+'"/>');else{r="";for(o=0;o<t.length;o++)r+='<source src="'+t[o]+'"/>';e.insertAdjacentHTML("beforeend",r)}n.preload&&e.load(),a&&a()};var r={};function o(e){for(var t=0;t<r[e.type].length;t++)r[e.type][t](e,n)}n.on=function(t,a){var i=t.toLowerCase();return void 0===r[i]&&(e.addEventListener(t,o,!0),r[i]=[]),r[i].push(a),n},n.off=function(t,a){var i=t.toLowerCase();if(void 0!==r[i])return a?r[i].splice(r[i].indexOf(a),1):r[i].splice(0),0===r[i].length&&(r[i]=void 0,e.removeEventListener(t,o,!0)),n},n.once=function(t,a){return e.addEventListener(t,a,{once:!0}),n},n.destroy=function(){for(var t in r)n.off(t);for(var t in n.playlist.list.splice(0),n.playlist.original.splice(0),n)delete n[t];n=null,e.pause(),e.innerHTML=""};var c=!1;function u(){c||(c=!0,n.on("ended",function(){n.playlist.currentIndex<n.playlist.list.length-1?n.playlist.next(!0):n.playlist.loop&&n.playlist.play(0)}))}function d(e){if(r[e])for(var t=0;t<r[e].length;t++)r[e][t](n,n.playlist,n.playlist.currentIndex)}n.playlist={currentIndex:0,list:[],original:[],loop:!1,shuffled:!1,reload:function(e){this.original=e,this.shuffle(this.shuffled),u()},add:function(e){this.original.push(e),this.shuffle(this.shuffled),u()},remove:function(e){this.original.splice(e,1),this.shuffle(this.shuffled)},next:function(e){if(this.currentIndex++,this.currentIndex>=this.list.length){if(!this.loop)return void this.currentIndex--;this.currentIndex=0}e?this.play(this.currentIndex):d("playlistchange")},previous:function(e){if(this.currentIndex--,this.currentIndex<0){if(!this.loop)return void this.currentIndex++;this.currentIndex=this.list.length-1}e?this.play(this.currentIndex):d("playlistchange")},play:function(e){this.currentIndex=e,d("playlistchange"),n.prepare(this.list[e].stream,function(){n.play()})},shuffle:function(e){var n,t,a;if(!0===e)for(a=this.list.length-1;a>0;a--)n=Math.floor(Math.random()*(a+1)),t=this.list[a],this.list[a]=this.list[n],this.list[n]=t;else this.list=this.original.slice(0);this.shuffled=e}}},window.ScarletsMediaPresenter=function(e,n){var t=this;n||(n=1e3),t.debug=!1,t.onRecordingReady=null,t.onBufferProcess=null,t.mediaRecorder=null,t.recordingReady=!1,t.recording=!1,t.mediaGranted=!1;var a=new FileReader;t.options={},e.audio&&!e.video?MediaRecorder.isTypeSupported('audio/webm;codecs="vp9"')?t.options.mimeType='audio/webm;codecs="vp9"':MediaRecorder.isTypeSupported('audio/webm;codecs="vp8"')?t.options.mimeType='audio/webm;codecs="vp8"':MediaRecorder.isTypeSupported('audio/webm;codecs="vorbis"')?t.options.mimeType='audio/webm;codecs="vorbis"':MediaRecorder.isTypeSupported("audio/webm")?t.options.mimeType="audio/webm":MediaRecorder.isTypeSupported('audio/ogg;codecs="opus"')?t.options.mimeType='audio/ogg;codecs="opus"':MediaRecorder.isTypeSupported('audio/ogg;codecs="vorbis"')?t.options.mimeType='audio/ogg;codecs="vorbis"':MediaRecorder.isTypeSupported("audio/ogg")?t.options.mimeType="audio/ogg":MediaRecorder.isTypeSupported('audio/mp4;codecs="mp4a.40.5')?t.options.mimeType='audio/mp4;codecs="mp4a.40.5':MediaRecorder.isTypeSupported("audio/mp4")&&(t.options.mimeType="audio/mp4"):!e.audio&&e.video?MediaRecorder.isTypeSupported('video/webm;codecs="vp9"')?t.options.mimeType='video/webm;codecs="vp9"':MediaRecorder.isTypeSupported('video/webm;codecs="vp8"')?t.options.mimeType='video/webm;codecs="vp8"':MediaRecorder.isTypeSupported('video/webm;codecs="vorbis"')?t.options.mimeType='video/webm;codecs="vorbis"':MediaRecorder.isTypeSupported("video/webm")?t.options.mimeType="video/webm":MediaRecorder.isTypeSupported('video/ogg;codecs="opus"')?t.options.mimeType='video/ogg;codecs="opus"':MediaRecorder.isTypeSupported('video/ogg;codecs="vorbis"')?t.options.mimeType='video/ogg;codecs="vorbis"':MediaRecorder.isTypeSupported("video/ogg")?t.options.mimeType="video/ogg":MediaRecorder.isTypeSupported('video/mp4;codecs="mp4a.40.5')?t.options.mimeType='video/mp4;codecs="mp4a.40.5':MediaRecorder.isTypeSupported("video/mp4")&&(t.options.mimeType="video/mp4"):MediaRecorder.isTypeSupported("video/webm")?t.options.mimeType="video/webm":MediaRecorder.isTypeSupported("video/mp4")&&(t.options.mimeType="video/mp4");var i=!1,r=function(e){t.mediaGranted=!0,t.bufferHeader=null;var r=!1;t.mediaRecorder=new MediaRecorder(e,t.options),t.debug&&console.log("MediaRecorder obtained"),t.mediaRecorder.onstart=function(e){t.recording=!0,!1===r&&t.mediaRecorder.requestData()},t.mediaRecorder.ondataavailable=function(e){a.onload=function(){var e=this.result;if(!1===r){if(0==(r=e.byteLength))return r=!1,void setTimeout(function(){t.mediaRecorder.requestData()},1);t.bufferHeader=e,t.onRecordingReady&&t.onRecordingReady(t.bufferHeader),t.recordingReady=!0}else if(t.onBufferProcess){var n=Number(String(Date.now()).slice(-5,-3));t.onBufferProcess([e,n])}},a.readAsArrayBuffer(e.data)},t.mediaRecorder.start(),i=setInterval(function(){t.recordingReady&&t.mediaRecorder.requestData()},n)};t.startRecording=function(){t.mediaGranted&&t.mediaRecorder.stream&&t.mediaRecorder.stream.active?(t.mediaRecorder.start(),t.recording=!0):(t.recordingReady=!1,navigator.mediaDevices.getUserMedia(e).then(r).catch(console.error))},t.stopRecording=function(){if(clearInterval(i),t.mediaRecorder.stop(),t.mediaRecorder.stream.stop)t.mediaRecorder.stream.stop();else for(var e=t.mediaRecorder.stream.getTracks(),n=0;n<e.length;n++)e[n].stop(),t.mediaRecorder.stream.removeTrack(e[n]);t.mediaRecorder.ondataavailable=null,t.mediaRecorder.onstart=null,t.bufferHeader=null,t.recording=!1}},ScarletsMedia.extra={isMobile:function(){return/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(navigator.userAgent)},objectPropertyLinker:function(e,n,t){Object.defineProperty(e,t,{get:function(){return n[t]},set:function(e){n[t]=e},enumerable:!0,configurable:!0})},normalize:function(e,n,t){return(t-n)*e+n},denormalize:function(e,n,t){return(e-n)/(t-n)},maxFade:0,fadeNumber:function(e,n,t,a,i,r){this.maxFade=0;var o=e,c=a/(Math.abs(e-n)/Math.abs(t));if(c&&c!=1/0)var u=setInterval(function(){if(this.maxFade>=100&&clearInterval(u),this.maxFade++,o=1e3*(o+t),o=Math.ceil(o)/1e3,t>=0&&(o>=n||e>=n)||t<=0&&(o<=n||e<=n)||o==1/0||!o)return clearInterval(u),i(n),void(r&&r());i&&i(o)},c);else setTimeout(function(){i&&i(n),r&&r()},a)}},ScarletsMedia.extra.isMobile()&&function(){var e=ScarletsMedia.audioContext.createBuffer(1,1,22050),n=function n(t){var a=ScarletsMedia.audioContext.createBufferSource();a.buffer=e,a.connect(ScarletsMedia.audioContext.destination),a.onended=function(){a.disconnect(0),a=e=null,document.removeEventListener("touchstart",n,!0),document.removeEventListener("touchend",n,!0),document.removeEventListener("click",n,!0)},a.start?a.start(0):a.noteOn(0),ScarletsMedia.audioContext.resume()};document.addEventListener("touchstart",n,!0),document.addEventListener("touchend",n,!0),document.addEventListener("click",n,!0)}(),ScarletsMedia.chorus=function(e){var n=this.audioContext,t=n.createGain(),a=void 0===e?n.createGain():null;a&&(e=a);var i=n.createGain(),r=n.createGain(),o=n.createChannelSplitter(2),c=n.createChannelMerger(2);e.connect(o),e.connect(i);for(var u=[{},{}],d=0;d<u.length;d++){var l=u[d];l.stream=n.createGain(),l.delayVibrato=n.createDelay(),l.delayFixed=n.createDelay(),l.feedback=n.createGain(),l.feedforward=n.createGain(),l.blend=n.createGain(),o.connect(l.stream,d,0),l.stream.connect(l.delayVibrato),l.stream.connect(l.delayFixed),l.delayVibrato.connect(l.feedforward),l.delayVibrato.connect(c,0,d),l.delayFixed.connect(l.feedback),l.feedback.connect(l.stream),l.blend.connect(c,0,d)}c.connect(r),i.connect(t),r.connect(t);var f=n.createOscillator(),s=n.createGain(),v=n.createGain();f.connect(s),f.connect(v),s.connect(u[0].delayVibrato.delayTime),v.connect(u[1].delayVibrato.delayTime),f.start(0),f.type="sine",f.frequency.value=.15,s.gain.value=.013,v.gain.value=-.017,u[0].delayFixed.delayTime.value=.005,u[1].delayFixed.delayTime.value=.007,u[0].delayVibrato.delayTime.value=.013,u[1].delayVibrato.delayTime.value=.017;var p={output:t,input:a,rate:function(e){e=.29*e+.01,f.frequency.value=e},intensity:function(e){for(var n=1-.2929*e,t=.2929*e+.7071,a=.7071*e,i=0;i<u.length;i++)u[i].blend.gain.value=n,u[i].feedforward.gain.value=t,u[i].feedback.gain.value=a},mix:function(e){i.gain.value=e},destroy:function(){a&&a.disconnect(),t.disconnect(),f.stop(0),f.disconnect();for(var e=0;e<u.length;e++)u[e].stream.disconnect();for(var n in this)delete this[n];t=null}};return p.rate(.5),p.intensity(0),p.mix(.75),p},ScarletsMedia.conReverb=function(e){var n=this.audioContext,t=n.createGain(),a=void 0===e?n.createGain():null;a&&(e=a);var i=n.createConvolver(),r=n.createGain(),o=n.createGain();return e.connect(o),e.connect(i),i.connect(r),o.connect(t),r.connect(t),{output:t,input:a,setBuffer:function(e){i.buffer=e},loadBuffer:function(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){var e=t.response;n.decodeAudioData(e,function(e){i.buffer=e},function(e){e.err})},t.send()},mix:function(e){if(void 0===e)return r.gain.value;o.gain.value=1-e,r.gain.value=e},destroy:function(){for(var e in a&&a.disconnect(),o.disconnect(),t.disconnect(),i.disconnect(),this)delete this[e];t=null}}},ScarletsMedia.cutOff=function(e,n){var t=this.audioContext,a=t.createGain(),i=void 0===n?t.createGain():null;i&&(n=i);var r=t.createBiquadFilter();return r.type=e||"lowpass",r.frequency.value=350,r.Q.value=1,r.connect(a),n.connect(r),{output:a,input:i,frequency:function(e){if(void 0===e)return r.frequency.value;r.frequency.value=e},peak:function(e){if(void 0===e)return r.Q.value;r.Q.value=e},destroy:function(){for(var e in i&&i.disconnect(),r.disconnect(),a.disconnect(),this)delete this[e];a=null}}},ScarletsMedia.delay=function(e){var n=this.audioContext,t=n.createGain(),a=void 0===e?n.createGain():null;a&&(e=a);var i=n.createGain(),r=n.createGain(),o=n.createGain(),c=n.createDelay();e.connect(i),i.connect(t),c.connect(o),o.connect(c),e.connect(c),c.connect(r),r.connect(t);var u={output:t,input:a,mix:function(e){if(void 0===e)return r.gain.value;i.gain.value=1-e,r.gain.value=e},time:function(e){if(void 0===e)return c.delayTime.value;c.delayTime.value=e},feedback:function(e){if(void 0===e)return o.gain.value;o.gain.value=e},destroy:function(){for(var e in a&&a.disconnect(),t.disconnect(),i.disconnect(),r.disconnect(),o.disconnect(),c.disconnect(),this)delete this[e];t=null}};return u.mix(.5),u.time(.3),u.feedback(.5),u},ScarletsMedia.distortion=function(e){var n=this.audioContext,t=n.createGain(),a=void 0===e?n.createGain():null;a&&(e=a);var i=57*Math.PI/180,r=n.createWaveShaper();return r.connect(t),e.connect(r),{set:function(e){e*=10;for(var t=new Float32Array(n.sampleRate),a=2/n.sampleRate,o=0;o<n.sampleRate;o++){var c=o*a-1;t[o]=(3+e)*c*i/(Math.PI+e*Math.abs(c))}r.curve=t},output:t,input:a,destroy:function(){for(var e in a&&a.disconnect(),r.disconnect(),t.disconnect(),r=t=null,this)delete this[e]}}},ScarletsMedia.dubDelay=function(e){var n=this.audioContext,t=n.createGain(),a=void 0===e?n.createGain():null;a&&(e=a);var i=n.createGain(),r=n.createGain(),o=n.createGain(),c=n.createDelay(),u=n.createBiquadFilter();e.connect(i),i.connect(t),e.connect(r),e.connect(o),o.connect(u),u.connect(c),c.connect(o),c.connect(r),r.connect(t);var d={output:t,input:a,mix:function(e){if(void 0===e)return r.gain.value;i.gain.value=1-e,r.gain.value=e},time:function(e){if(void 0===e)return c.delayTime.value;c.delayTime.value=e},feedback:function(e){if(void 0===e)return o.gain.value;o.gain.value=e},cutoff:function(e){if(void 0===e)return u.frequency.value;u.frequency.value=e},destroy:function(){for(var e in a&&a.disconnect(),t.disconnect(),i.disconnect(),r.disconnect(),o.disconnect(),this)delete this[e];t=null}};return d.mix(.5),d.time(.7),d.feedback(.6),d.cutoff(700),d},ScarletsMedia.equalizer=function(e,n){var t=e||[32,64,125,250,500,1e3,2e3,4e3,8e3,16e3],a=this.audioContext,i=a.createGain(),r=void 0===n?a.createGain():null;r&&(n=r);var o={},c=t.length-1,u=t.length-3;u<=1&&(u=1.1),u=(4-4/u).toFixed(2);for(var d=0;d<t.length;d++){var l=a.createBiquadFilter(),f=a.createGain();l.Q.value=1,l.frequency.value=t[d],0===d?l.type="lowpass":d===c?l.type="highpass":(l.type="bandpass",l.Q.value=u),n.connect(l),l.connect(f),f.connect(i),o[t[d]]=[f,l]}return{output:i,input:r,frequency:function(e,n){if(void 0===n)return o[e][0].gain.value;o[e][0].gain.value=n},destroy:function(){for(var e=0;e<t.length;e++)o[t[e]][0].disconnect(),o[t[e]][1].disconnect();for(var n in o.splice(0),r&&r.disconnect(),i.disconnect(),this)delete this[n];o=i=null}}},ScarletsMedia.fade=function(e){var n=this.audioContext,t=n.createGain(),a=void 0===e?n.createGain():null;return a&&(e=a),t.gain.value=1,e.connect(t),{output:t,input:a,in:function(e,a,i){t.gain.cancelScheduledValues(n.currentTime);var r=(1-t.gain.value)*e;t.gain.setTargetAtTime(1,n.currentTime,r*a),i&&setTimeout(i,1e3*a)},out:function(e,a,i){t.gain.cancelScheduledValues(n.currentTime);var r=t.gain.value*e;t.gain.setTargetAtTime(1e-5,n.currentTime,r/a),i&&setTimeout(i,1e3*a)},destroy:function(){for(var e in a&&a.disconnect(),t.disconnect(),this)delete this[e];t=null}}},ScarletsMedia.flanger=function(e){var n=this.audioContext,t=n.createGain(),a=void 0===e?n.createGain():null;a&&(e=a);var i=n.createGain(),r=n.createGain(),o=n.createGain(),c=n.createDelay(),u=n.createOscillator(),d=n.createGain(),l=n.createGain();u.type="sine",e.connect(i),e.connect(o),i.connect(c),i.connect(r),c.connect(r),c.connect(l),l.connect(i),u.connect(d),d.connect(c.delayTime),o.connect(t),r.connect(t),u.start(0);var f={output:t,input:a,mix:function(e){if(void 0===e)return r.gain.value;o.gain.value=1-e,r.gain.value=e},time:function(e){if(void 0===e)return ScarletsMedia.extra.denormalize(c.delayTime.value,.001,.02);c.delayTime.value=ScarletsMedia.extra.normalize(e,.001,.02)},speed:function(e){if(void 0===e)return ScarletsMedia.extra.denormalize(c.delayTime.value,.5,5);u.frequency.value=ScarletsMedia.extra.normalize(e,.5,5)},depth:function(e){if(void 0===e)return ScarletsMedia.extra.denormalize(c.delayTime.value,5e-4,.005);d.gain.value=ScarletsMedia.extra.normalize(e,5e-4,.005)},feedback:function(e){if(void 0===e)return ScarletsMedia.extra.denormalize(c.delayTime.value,0,.8);l.gain.value=ScarletsMedia.extra.normalize(e,0,.8)},destroy:function(){for(var e in a&&a.disconnect(),t.disconnect(),i.disconnect(),o.disconnect(),this)delete this[e];t=null}};return f.time(.45),f.speed(.2),f.depth(.1),f.feedback(.1),f.mix(.5),f},ScarletsMedia.harmonizer=function(e){var n=this.audioContext,t=n.createGain(),a=void 0===e?n.createGain():null;a&&(e=a);for(var i=[],r=[],o=[],c=0;c<8;c++)i[c]=n.createBiquadFilter(),i[c].type="bandpass",r[c]=n.createBiquadFilter(),r[c].type="bandpass",e.connect(i[c]),o[c]=n.createGain(),o[c].connect(t),i[c].connect(r[c]).connect(o[c]);t.gain.value=35;var u={output:t,input:a,pitch:function(e){for(var n=ScarletsMedia.convert.midiToFreq(e),t=0;t<8;t++)i[t].frequency.value=n,r[t].frequency.value=n},slope:function(e){for(var n=0;n<8;n++)o[n].gain.value=1+Math.sin(Math.PI+Math.PI/2*(e+n/8))},width:function(e){for(var n=1;n<8;n++){var t=2+90*Math.pow(1-n/8,e);i[n].Q.value=t,r[n].Q.value=t}},destroy:function(){a&&a.disconnect(),t.disconnect();for(var e=0;e<8;e++)i[e].disconnect();for(var n in this)delete this[n];t=null}};return u.pitch(34),u.slope(.65),u.width(.15),u},ScarletsMedia.noise=function(){var e=this.audioContext,n=e.createGain(),t=void 0===sourceNode?e.createGain():null;t&&(sourceNode=t);for(var a=Math.floor(9.73*e.sampleRate),i=new Float32Array(a),r=0;r<a;r++)i[r]=Math.sqrt(-2*Math.log(Math.random()))*Math.cos(2*Math.PI*Math.random())*.5;var o=e.createBuffer(2,a,e.sampleRate);o.getChannelData(0).set(i,0),o.getChannelData(1).set(i,0);var c=e.createBufferSource();return c.to(n),c.loop=!0,c.start(0),c.buffer=o,c.loopStart=9.73*Math.random(),{output:n,input:t,destroy:function(){for(var e in c.loop=!1,c.buffer=null,c.stop(0),c.disconnect(),c=null,t&&t.disconnect(),n.disconnect(),this)delete this[e];n=null}}},ScarletsMedia.pingPongDelay=function(e){var n=this.audioContext,t=n.createGain(),a=void 0===e?n.createGain():null;a&&(e=a);var i=n.createDelay(),r=n.createDelay(),o=n.createGain(),c=n.createGain(),u=n.createGain(),d=n.createChannelMerger(2);e.connect(o),o.connect(t),i.connect(d,0,0),r.connect(d,0,1),i.connect(r),u.connect(i),r.connect(u),e.connect(u),d.connect(c),c.connect(t);var l={output:t,input:a,mix:function(e){if(void 0===e)return c.gain.value;o.gain.value=1-e,c.gain.value=e},time:function(e){if(void 0===e)return i.delayTime.value;i.delayTime.value=e,r.delayTime.value=e},feedback:function(e){if(void 0===e)return u.gain.value;u.gain.value=e},destroy:function(){for(var e in a&&a.disconnect(),t.disconnect(),o.disconnect(),u.disconnect(),this)delete this[e];t=null}};return l.mix(.5),l.time(.3),l.feedback(.5),l},ScarletsMedia.reverb=function(e){var n=this.audioContext,t=n.createGain(),a=void 0===e?n.createGain():null;a&&(e=a);var i=n.createConvolver(),r=n.createGain(),o=n.createGain();e.connect(o),o.connect(t),r.connect(t);var c=1,u=.1,d=!1;function l(){for(var t=n.sampleRate*c,a=n.createBuffer(2,t,n.sampleRate),o=a.getChannelData(0),l=a.getChannelData(1),f=0;f<t;f++){var s=d?t-f:f;o[f]=(2*Math.random()-1)*Math.pow(1-s/t,u),l[f]=(2*Math.random()-1)*Math.pow(1-s/t,u)}i.disconnect(),i=n.createConvolver(),e.connect(i),i.connect(r),i.buffer=a}return l(),{output:t,input:a,mix:function(e){if(void 0===e)return r.gain.value;o.gain.value=1-e,r.gain.value=e},time:function(e){if(void 0===e)return c;c=e,l()},decay:function(e){if(void 0===e)return u;u=e,l()},reverse:function(e){if(void 0===e)return d;d=e,l()},destroy:function(){for(var e in a&&a.disconnect(),o.disconnect(),t.disconnect(),i.disconnect(),this)delete this[e];t=null}}},ScarletsMedia.stereoPanner=function(e){var n=this.audioContext,t=n.createGain(),a=void 0===e?n.createGain():null;a&&(e=a);var i=!1;if(n.createStereoPanner){var r=n.createStereoPanner();i=!0}else{(r=n.createPanner()).type="equalpower"}return e.connect(r),r.connect(t),r.pan.value=0,{output:t,input:a,set:function(e){i?r.pan.value=e:r.setPosition(e,0,1-Math.abs(e))},destroy:function(){for(var e in a&&a.disconnect(),t.disconnect(),r.disconnect(),this)delete this[e];t=r=null}}},ScarletsMedia.tremolo=function(e){var n=this.audioContext,t=n.createGain(),a=void 0===e?n.createGain():null;a&&(e=a);var i=n.createGain(),r=n.createGain(),o=n.createGain();o.gain.value=0;var c=n.createWaveShaper();c.curve=new Float32Array([0,1]),c.connect(o.gain),e.connect(i),i.connect(t);var u=n.createOscillator();u.connect(c),u.type="sine",u.start(0),e.connect(o),o.connect(r),r.connect(t);var d={output:t,input:a,mix:function(e){if(void 0===e)return r.gain.value;i.gain.value=1-e,r.gain.value=e},speed:function(e){if(void 0===e)return ScarletsMedia.extra.denormalize(u.frequency.value,0,20);u.frequency.value=ScarletsMedia.extra.normalize(e,0,20)},depth:function(e){if(void 0===e)return 1-this.shaperNode.curve[0];c.curve=new Float32Array([1-e,1])},destroy:function(){for(var e in a&&a.disconnect(),t.disconnect(),i.disconnect(),o.disconnect(),this)delete this[e];t=null}};return d.speed(.2),d.depth(1),d.mix(.8),d},ScarletsMedia.vibrato=function(e){var n=this.audioContext,t=n.createGain(),a=void 0===e?n.createGain():null;a&&(e=a),console.error("The vibrato effect still need some maintenance");var i=n.createBiquadFilter();i.type="peaking",i.gain.value=1,i.Q.value=1,i.connect(t),e.connect(i);var r=n.createGain();r.gain.value=30,r.connect(i.detune);var o=n.createOscillator();return o.connect(r),o.frequency.value=5,o.start(0),{output:t,input:a,speed:function(e){if(void 0===e)return ScarletsMedia.extra.denormalize(o.frequency.value,0,20);o.frequency.value=ScarletsMedia.extra.normalize(e,0,20)},destroy:function(){for(var e in a&&a.disconnect(),t.disconnect(),o.stop(),o.disconnect(),this)delete this[e];t=null}}};
//# sourceMappingURL=SFMediaStream.min.js.map
