/*
  SFMediaStream
  HTML5 media streamer library for playing music, video, playlist,
  or even live streaming microphone & camera with node server

  https://github.com/ScarletsFiction/SFMediaStream
*/
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?(module.exports={},n(module.exports,window,!0)):n(e,window)}(this||window,function(e,n,t){"use strict";var i={audioContext:!1,getElementAudioNode:function(e){return e.crossOrigin="anonymous",this.audioContext.createMediaElementSource(e)},getElementVideoNode:function(e){return e.crossOrigin="anonymous",null}},a={};!function(){var e=function(e){if(!n.AudioContext)return t();i.audioContext=new AudioContext;var a=i.audioContext.createBuffer(1,1,22050),r=i.audioContext.createBufferSource();r.buffer=a,r.connect(i.audioContext.destination),r.onended=function(){r.disconnect(0),r=a=null,t()},r.start?r.start(0):r.noteOn(0),i.audioContext.resume()};function t(){document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0)}document.addEventListener("touchstart",e,!0),document.addEventListener("touchend",e,!0),document.addEventListener("click",e,!0)}();var r=function(e,n,t){(!e||e<3)&&(e=3),n||(n=1e3);var a=this;a.debug=!1,a.bufferElement=[],a.bufferAvailable=[],a.bufferPending=[],a.currentBuffer=0,a.playing=!1,a.buffering=!1,a.streaming=!1,a.currentDuration=!1,a.latency=0,a.error=0,a.realtime=!1,a.bufferSkip=.07,a.mimeType=null,a.webAudio=!(!t&&!i.extra.isMobile()),a.audioContext=i.audioContext,a.outputNode=!1;var r=!1;a.stop=function(){a.bufferPending.splice(0);for(var n=0;n<e;n++)a.bufferElement[n].stop(),a.bufferAvailable[n]=!1;a.playing=!1,a.buffering=!1,a.currentBuffer=0},a.setBufferHeader=function(e){e?(r=new Uint8Array(e),a.audioContext.decodeAudioData(e.slice(0),function(e){a.bufferSkip=e.duration,l=e.getChannelData(0).length})):r=!1};for(var o=0;o<e;o++)c(o);function c(e){if(a.webAudio)a.bufferElement.push(u()),a.bufferAvailable.push(!1);else{var n=new Audio;n&&(a.bufferElement.push(n),a.bufferAvailable.push(!1),n.onended=function(){a.debug&&console.log("Buffer ended with ID: "+e),URL.revokeObjectURL(this.src),this.src="",a.realtime||(a.bufferAvailable[e]=!1,a.playing=!1,a.buffering=!0,a.playAvailable(),-1!==a.bufferAvailable.indexOf(!1)&&0!=a.bufferPending.length&&v())})}}function u(){var e=a.audioContext.createBufferSource();return e.onended=function(){this.stop(),this.disconnect()},e}var d=function(e){var n=new Uint8Array(r.byteLength+e.byteLength);return n.set(r,0),n.set(new Uint8Array(e),r.byteLength),n.buffer},l=0;function f(e,n){a.bufferElement[e]=u(),a.bufferElement[e].buffer=function(e){for(var n=e.getChannelData(0).length-l,t=e.numberOfChannels,i=a.audioContext.createBuffer(t,n,e.sampleRate),r=0;r<t;r++)i.getChannelData(r).set(e.getChannelData(r).subarray(l));return i}(n),a.outputNode&&a.outputNode.context?a.bufferElement[e].connect(a.outputNode):a.bufferElement[e].connect(a.audioContext.destination)}a.playStream=function(){a.streaming=a.buffering=!0};var s=0;a.realtimeBufferPlay=function(e){if(a.debug&&console.log("Receiving data",e[0].byteLength),0!==e[0].byteLength){e=e[0],a.latency=Number(String(Date.now()).slice(-5,-3))-e[1]+n/1e3+a.audioContext.baseLatency,a.realtime=!0;var t=s;++s>2&&(s=0),a.webAudio?a.audioContext.decodeAudioData(d(e),function(e){f(t,e),a.bufferElement[t].start(a.bufferSkip)}):(URL.revokeObjectURL(a.bufferElement[t].src),a.bufferElement[t].src=URL.createObjectURL(new Blob([r,e],{type:a.mimeType})),a.bufferElement[t].load(),a.bufferElement[t].play(),a.bufferElement[t].currentTime=a.bufferSkip)}},a.receiveBuffer=function(t){if(a.debug&&console.log("Receiving data",t[0].byteLength),a.streaming){var i=t[1];if(a.realtime=!1,n){for(var r=a.bufferPending.length,o=0;o<e;o++)a.bufferAvailable[o]&&r++;a.latency=Number(String(Date.now()).slice(-5,-3))-i+n*r+a.audioContext.baseLatency,a.debug&&console.log("Total latency: "+a.latency)}a.bufferPending.push(t[0]),v(),a.buffering&&a.playAvailable()}};var v=function(){var e=a.bufferAvailable.indexOf(!1,a.currentBuffer);-1==e&&(e=a.bufferAvailable.indexOf(!1)),-1!=e&&0!=a.bufferPending.length&&(a.webAudio?a.audioContext.decodeAudioData(d(a.bufferPending[0]),function(n){f(e,n)}):(a.bufferElement[e].src=URL.createObjectURL(new Blob([r,a.bufferPending[0]],{type:a.mimeType})),a.bufferElement[e].load()),a.bufferPending.shift(),a.bufferAvailable[e]=!0,a.buffering&&a.playAvailable(),a.debug&&console.log("Buffer updated with ID: "+e))};a.playBuffer=function(e){a.bufferElement[e].duration&&(a.debug&&console.log("Current stream duration: "+a.bufferElement[e].duration),!1!==n?(a.buffering=!1,a.playing=!0,n=a.bufferElement[e].duration,a.bufferElement[e].start?a.bufferElement[e].start(a.bufferSkip):(a.bufferElement[e].play(),a.bufferElement[e].currentTime=a.bufferSkip),a.currentBuffer=e,a.debug&&console.log("Playing buffer ID: "+a.currentBuffer)):n=a.bufferElement[e].duration)},a.playAvailable=function(){if(!a.playing){if(a.bufferAvailable[a.currentBuffer])return a.playBuffer(a.currentBuffer);var e=a.bufferAvailable.indexOf(!0,a.currentBuffer);return-1!=e?a.playBuffer(e):-1!=(e=a.bufferAvailable.indexOf(!0))?a.playBuffer(e):void 0}}};i.convert={midiToFreq:function(e){return e<=-1500?0:e>1499?3.282417553401589e38:440*Math.pow(2,(Math.floor(e)-69)/12)},freqToMidi:function(e){return e>0?Math.floor(Math.log(e/440)/Math.LN2*12+69):-1500},powerToDb:function(e){if(e<=0)return 0;var n=100+10/Math.LN10*Math.log(e);return n<0?0:n},dbToPower:function(e){return e<=0?0:(e>870&&(e=870),Math.exp(.1*Math.LN10*(e-100)))},ampToDb:function(e){return 20*(e>1e-5?Math.log(e)/Math.LN10:-5)},dbToAmp:function(e){return Math.pow(10,e/20)},velToAmp:function(e){return e/127}};var o=function(e){var n=this,t=["autoplay","loop","buffered","buffered","controller","currentTime","currentSrc","duration","ended","error","readyState","networkState","paused","played","seekable","seeking"],a=!1;if(Object.defineProperty(n,"audioOutput",{get:function(){return a||(a=i.getElementAudioNode(e)),a},enumerable:!0}),"video"===e.tagName.toLowerCase()){t=t.concat(["poster","height","width"]);var r=!1;Object.defineProperty(n,"videoOutput",{get:function(){return r||(r=i.getElementVideoNode(e)),r},enumerable:!0})}n.load=function(){e.load()},n.canPlayType=function(){e.canPlayType()};for(var o=0;o<t.length;o++)i.extra.objectPropertyLinker(n,e,t[o]);n.preload=!0,e.preload="metadata",n.audioFadeEffect=!0,n.speed=function(n){if(void 0===n)return e.defaultPlaybackRate;e.defaultPlaybackRate=e.playbackRate=n},n.mute=function(n){if(void 0===n)return e.muted;e.defaultMuted=e.muted=n};var c=1;n.volume=function(n){if(void 0===n)return c;e.volume=c=n},n.play=function(t){if(e.paused){if(n.audioFadeEffect)return e.volume=0,e.play(),void i.extra.fadeNumber(0,c,.02,400,function(n){e.volume=n},t);e.play(),t&&t()}else t&&t()},n.pause=function(t){e.paused?t&&t():n.audioFadeEffect?i.extra.fadeNumber(c,0,-.02,400,function(n){e.volume=n},function(){e.pause(),t&&t()}):(e.pause(),t&&t())},n.prepare=function(t,i,a){if(!a&&!e.paused)return n.pause(function(){n.prepare(t,i,!0)});for(var r=e.querySelectorAll("source"),o=r.length-1;o>=0;o--)r[o].remove();if("string"==typeof t)e.insertAdjacentHTML("beforeend",'<source src="'+t+'"/>');else{r="";for(o=0;o<t.length;o++)r+='<source src="'+t[o]+'"/>';e.insertAdjacentHTML("beforeend",r)}n.preload&&e.load(),i&&i()};var u={};function d(e){for(var t=0;t<u[e.type].length;t++)u[e.type][t](e,n)}n.on=function(t,i){var a=t.toLowerCase();return void 0===u[a]&&(e.addEventListener(t,d,!0),u[a]=[]),u[a].push(i),n},n.off=function(t,i){var a=t.toLowerCase();if(void 0!==u[a])return i?u[a].splice(u[a].indexOf(i),1):u[a].splice(0),0===u[a].length&&(u[a]=void 0,e.removeEventListener(t,d,!0)),n},n.once=function(t,i){return e.addEventListener(t,i,{once:!0}),n},n.destroy=function(){for(var t in u)n.off(t);for(var t in n.playlist.list.splice(0),n.playlist.original.splice(0),n)delete n[t];n=null,e.pause(),e.innerHTML=""};var l=!1;function f(){l||(l=!0,n.on("ended",function(){n.playlist.currentIndex<n.playlist.list.length-1?n.playlist.next(!0):n.playlist.loop&&n.playlist.play(0)}))}function s(e){if(u[e])for(var t=0;t<u[e].length;t++)u[e][t](n,n.playlist,n.playlist.currentIndex)}n.playlist={currentIndex:0,list:[],original:[],loop:!1,shuffled:!1,reload:function(e){this.original=e,this.shuffle(this.shuffled),f()},add:function(e){this.original.push(e),this.shuffle(this.shuffled),f()},remove:function(e){this.original.splice(e,1),this.shuffle(this.shuffled)},next:function(e){if(this.currentIndex++,this.currentIndex>=this.list.length){if(!this.loop)return void this.currentIndex--;this.currentIndex=0}e?this.play(this.currentIndex):s("playlistchange")},previous:function(e){if(this.currentIndex--,this.currentIndex<0){if(!this.loop)return void this.currentIndex++;this.currentIndex=this.list.length-1}e?this.play(this.currentIndex):s("playlistchange")},play:function(e){this.currentIndex=e,s("playlistchange"),n.prepare(this.list[e].stream,function(){n.play()})},shuffle:function(e){var n,t,i;if(!0===e)for(i=this.list.length-1;i>0;i--)n=Math.floor(Math.random()*(i+1)),t=this.list[i],this.list[i]=this.list[n],this.list[n]=t;else this.list=this.original.slice(0);this.shuffled=e}}},c=function(e,n){var t=this;n||(n=1e3),t.debug=!1,t.onRecordingReady=null,t.onBufferProcess=null,t.mediaRecorder=null,t.recordingReady=!1,t.recording=!1,t.mediaGranted=!1,t.options={},e.audio&&!e.video?MediaRecorder.isTypeSupported('audio/webm;codecs="vp9"')?t.options.mimeType='audio/webm;codecs="vp9"':MediaRecorder.isTypeSupported('audio/webm;codecs="vp8"')?t.options.mimeType='audio/webm;codecs="vp8"':MediaRecorder.isTypeSupported('audio/webm;codecs="vorbis"')?t.options.mimeType='audio/webm;codecs="vorbis"':MediaRecorder.isTypeSupported("audio/webm")?t.options.mimeType="audio/webm":MediaRecorder.isTypeSupported('audio/ogg;codecs="opus"')?t.options.mimeType='audio/ogg;codecs="opus"':MediaRecorder.isTypeSupported('audio/ogg;codecs="vorbis"')?t.options.mimeType='audio/ogg;codecs="vorbis"':MediaRecorder.isTypeSupported("audio/ogg")?t.options.mimeType="audio/ogg":MediaRecorder.isTypeSupported('audio/mp4;codecs="mp4a.40.5')?t.options.mimeType='audio/mp4;codecs="mp4a.40.5':MediaRecorder.isTypeSupported("audio/mp4")&&(t.options.mimeType="audio/mp4"):!e.audio&&e.video?MediaRecorder.isTypeSupported('video/webm;codecs="vp9"')?t.options.mimeType='video/webm;codecs="vp9"':MediaRecorder.isTypeSupported('video/webm;codecs="vp8"')?t.options.mimeType='video/webm;codecs="vp8"':MediaRecorder.isTypeSupported('video/webm;codecs="vorbis"')?t.options.mimeType='video/webm;codecs="vorbis"':MediaRecorder.isTypeSupported("video/webm")?t.options.mimeType="video/webm":MediaRecorder.isTypeSupported('video/ogg;codecs="opus"')?t.options.mimeType='video/ogg;codecs="opus"':MediaRecorder.isTypeSupported('video/ogg;codecs="vorbis"')?t.options.mimeType='video/ogg;codecs="vorbis"':MediaRecorder.isTypeSupported("video/ogg")?t.options.mimeType="video/ogg":MediaRecorder.isTypeSupported('video/mp4;codecs="mp4a.40.5')?t.options.mimeType='video/mp4;codecs="mp4a.40.5':MediaRecorder.isTypeSupported("video/mp4")&&(t.options.mimeType="video/mp4"):MediaRecorder.isTypeSupported("video/webm")?t.options.mimeType="video/webm":MediaRecorder.isTypeSupported("video/mp4")&&(t.options.mimeType="video/mp4");var a=!1,r=function(e){t.mediaGranted=!0,t.bufferHeader=null;var r=!1;t.mediaRecorder=new MediaRecorder(e,t.options),t.debug&&console.log("MediaRecorder obtained"),t.mediaRecorder.onstart=function(e){t.recording=!0,!1===r&&t.mediaRecorder.requestData()},t.mediaRecorder.ondataavailable=function(e){if(!1===r)0!==e.data.size?(t.bufferHeader=e.data,r=e.data.byteLength,t.onRecordingReady&&t.onRecordingReady(t.bufferHeader),t.recordingReady=!0):setTimeout(function(){t.mediaRecorder.requestData()},0);else{if(0===e.data.size)return;var n=Number(String(Date.now()).slice(-5,-3));t.onBufferProcess([e.data,n])}},t.mediaRecorder.start(),a=i.extra.preciseInterval(function(){t.recordingReady&&t.mediaRecorder.requestData()},n)};t.startRecording=function(){t.mediaGranted&&t.mediaRecorder.stream&&t.mediaRecorder.stream.active?(t.mediaRecorder.start(),t.recording=!0):(t.recordingReady=!1,navigator.mediaDevices.getUserMedia(e).then(r).catch(console.error))},t.stopRecording=function(){if(i.extra.clearPreciseInterval(a),t.mediaRecorder.stop(),t.mediaRecorder.stream.stop)t.mediaRecorder.stream.stop();else for(var e=t.mediaRecorder.stream.getTracks(),n=0;n<e.length;n++)e[n].stop(),t.mediaRecorder.stream.removeTrack(e[n]);t.mediaRecorder.ondataavailable=null,t.mediaRecorder.onstart=null,t.bufferHeader=null,t.recording=!1}};a.chorus=function(e){var n=this.audioContext,t=n.createGain(),i=void 0===e?n.createGain():null;i&&(e=i);var a=n.createGain(),r=n.createGain(),o=n.createChannelSplitter(2),c=n.createChannelMerger(2);e.connect(o),e.connect(a);for(var u=[{},{}],d=0;d<u.length;d++){var l=u[d];l.stream=n.createGain(),l.delayVibrato=n.createDelay(),l.delayFixed=n.createDelay(),l.feedback=n.createGain(),l.feedforward=n.createGain(),l.blend=n.createGain(),o.connect(l.stream,d,0),l.stream.connect(l.delayVibrato),l.stream.connect(l.delayFixed),l.delayVibrato.connect(l.feedforward),l.delayVibrato.connect(c,0,d),l.delayFixed.connect(l.feedback),l.feedback.connect(l.stream),l.blend.connect(c,0,d)}c.connect(r),a.connect(t),r.connect(t);var f=n.createOscillator(),s=n.createGain(),v=n.createGain();f.connect(s),f.connect(v),s.connect(u[0].delayVibrato.delayTime),v.connect(u[1].delayVibrato.delayTime),f.start(0),f.type="sine",f.frequency.value=.15,s.gain.value=.013,v.gain.value=-.017,u[0].delayFixed.delayTime.value=.005,u[1].delayFixed.delayTime.value=.007,u[0].delayVibrato.delayTime.value=.013,u[1].delayVibrato.delayTime.value=.017;var p={rate:0,intensity:0,mix:0},m={output:t,input:i,rate:function(e){if(void 0===e)return p.rate;p.rate=e,e=.29*e+.01,f.frequency.value=e},intensity:function(e){if(void 0===e)return p.intensity;p.intensity=e;for(var n=1-.2929*e,t=.2929*e+.7071,i=.7071*e,a=0;a<u.length;a++)u[a].blend.gain.value=n,u[a].feedforward.gain.value=t,u[a].feedback.gain.value=i},mix:function(e){if(void 0===e)return p.mix;p.mix=e,a.gain.value=e},destroy:function(){i&&i.disconnect(),t.disconnect(),f.stop(0),f.disconnect();for(var e=0;e<u.length;e++)u[e].stream.disconnect();for(var n in this)delete this[n];t=null}};return m.rate(.5),m.intensity(0),m.mix(.75),m},a.conReverb=function(e){var n=this.audioContext,t=n.createGain(),i=void 0===e?n.createGain():null;i&&(e=i);var a=n.createConvolver(),r=n.createGain(),o=n.createGain();function c(t){null!==a.buffer&&(a.disconnect(),a=n.createConvolver(),e.connect(a),a.connect(r)),a.buffer=t}return e.connect(o),e.connect(a),a.connect(r),o.connect(t),r.connect(t),{output:t,input:i,setBuffer:c,loadBuffer:function(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){var e=t.response;n.decodeAudioData(e,function(e){c(e)},function(e){e.err})},t.send()},mix:function(e){if(void 0===e)return r.gain.value;o.gain.value=1-e,r.gain.value=e},destroy:function(){for(var e in i&&i.disconnect(),o.disconnect(),t.disconnect(),a.disconnect(),this)delete this[e];t=null}}},a.cutOff=function(e,n){var t=this.audioContext,i=t.createGain(),a=void 0===n?t.createGain():null;a&&(n=a);var r=t.createBiquadFilter();return r.type=e||"lowpass",r.frequency.value=350,r.Q.value=1,r.connect(i),n.connect(r),{output:i,input:a,type:function(e){if(void 0===e)return r.type;r.type=e},frequency:function(e){if(void 0===e)return r.frequency.value;r.frequency.value=e},width:function(e){if(void 0===e)return r.Q.value;r.Q.value=e},destroy:function(){for(var e in a&&a.disconnect(),r.disconnect(),i.disconnect(),this)delete this[e];i=null}}},a.delay=function(e){var n=this.audioContext,t=n.createGain(),i=void 0===e?n.createGain():null;i&&(e=i);var a=n.createGain(),r=n.createGain(),o=n.createGain(),c=n.createDelay();e.connect(a),a.connect(t),c.connect(o),o.connect(c),e.connect(c),c.connect(r),r.connect(t);var u={output:t,input:i,mix:function(e){if(void 0===e)return r.gain.value;a.gain.value=1-e,r.gain.value=e},time:function(e){if(void 0===e)return c.delayTime.value;c.delayTime.value=e},feedback:function(e){if(void 0===e)return o.gain.value;o.gain.value=e},destroy:function(){for(var e in i&&i.disconnect(),t.disconnect(),a.disconnect(),r.disconnect(),o.disconnect(),c.disconnect(),this)delete this[e];t=null}};return u.mix(.5),u.time(.3),u.feedback(.5),u},a.distortion=function(e){var n=this.audioContext,t=n.createGain(),i=void 0===e?n.createGain():null;i&&(e=i);var a=57*Math.PI/180,r=n.createWaveShaper();r.connect(t),e.connect(r);var o={amount:0};return{set:function(e){if(void 0===e)return o.amount;o.amount=e,e*=10;for(var t=new Float32Array(n.sampleRate),i=2/n.sampleRate,c=0;c<n.sampleRate;c++){var u=c*i-1;t[c]=(3+e)*u*a/(Math.PI+e*Math.abs(u))}r.curve=t},output:t,input:i,destroy:function(){for(var e in i&&i.disconnect(),r.disconnect(),t.disconnect(),r=t=null,this)delete this[e]}}},a.dubDelay=function(e){var n=this.audioContext,t=n.createGain(),i=void 0===e?n.createGain():null;i&&(e=i);var a=n.createGain(),r=n.createGain(),o=n.createGain(),c=n.createDelay(),u=n.createBiquadFilter();e.connect(a),a.connect(t),e.connect(r),e.connect(o),o.connect(u),u.connect(c),c.connect(o),c.connect(r),r.connect(t);var d={output:t,input:i,mix:function(e){if(void 0===e)return r.gain.value;a.gain.value=1-e,r.gain.value=e},time:function(e){if(void 0===e)return c.delayTime.value;c.delayTime.value=e},feedback:function(e){if(void 0===e)return o.gain.value;o.gain.value=e},cutoff:function(e){if(void 0===e)return u.frequency.value;u.frequency.value=e},destroy:function(){for(var e in i&&i.disconnect(),t.disconnect(),a.disconnect(),r.disconnect(),o.disconnect(),this)delete this[e];t=null}};return d.mix(.5),d.time(.7),d.feedback(.6),d.cutoff(700),d},a.equalizer=function(e,n){var t=e||[32,64,125,250,500,1e3,2e3,4e3,8e3,16e3],i=this.audioContext,a=i.createGain(),r=void 0===n?i.createGain():null;r&&(n=r);for(var o={},c=t.length-1,u=0;u<t.length;u++){var d=i.createBiquadFilter();d.gain.value=0,d.frequency.value=t[u],d.type=0===u?"lowshelf":u===c?"highshelf":"peaking",0!==u&&o[t[u-1]].connect(d),o[t[u]]=d}return n.connect(o[t[0]]),d.connect(a),{output:a,input:r,frequency:function(e,n){if(void 0===n)return o[e].gain.value;o[e].gain.value=n},destroy:function(){for(var e=0;e<t.length;e++)o[t[e]].disconnect();for(var n in o.splice(0),r&&r.disconnect(),a.disconnect(),this)delete this[n];o=a=null}}},a.fade=function(e){var n=this.audioContext,t=n.createGain(),i=void 0===e?n.createGain():null;return i&&(e=i),t.gain.value=1,e.connect(t),{output:t,input:i,in:function(e,i,a){t.gain.cancelScheduledValues(n.currentTime);var r=(1-t.gain.value)*e;t.gain.setTargetAtTime(1,n.currentTime,r*i),a&&setTimeout(a,1e3*i)},out:function(e,i,a){t.gain.cancelScheduledValues(n.currentTime);var r=t.gain.value*e;t.gain.setTargetAtTime(1e-5,n.currentTime,r/i),a&&setTimeout(a,1e3*i)},destroy:function(){for(var e in i&&i.disconnect(),t.disconnect(),this)delete this[e];t=null}}},a.flanger=function(e){var n=this.audioContext,t=n.createGain(),a=void 0===e?n.createGain():null;a&&(e=a);var r=n.createGain(),o=n.createGain(),c=n.createGain(),u=n.createDelay(),d=n.createOscillator(),l=n.createGain(),f=n.createGain();d.type="sine",e.connect(r),e.connect(c),r.connect(u),r.connect(o),u.connect(o),u.connect(f),f.connect(r),d.connect(l),l.connect(u.delayTime),c.connect(t),o.connect(t),d.start(0);var s={output:t,input:a,mix:function(e){if(void 0===e)return o.gain.value;c.gain.value=1-e,o.gain.value=e},time:function(e){if(void 0===e)return i.extra.denormalize(u.delayTime.value,.001,.02);u.delayTime.value=i.extra.normalize(e,.001,.02)},speed:function(e){if(void 0===e)return i.extra.denormalize(u.delayTime.value,.5,5);d.frequency.value=i.extra.normalize(e,.5,5)},depth:function(e){if(void 0===e)return i.extra.denormalize(u.delayTime.value,5e-4,.005);l.gain.value=i.extra.normalize(e,5e-4,.005)},feedback:function(e){if(void 0===e)return i.extra.denormalize(u.delayTime.value,0,.8);f.gain.value=i.extra.normalize(e,0,.8)},destroy:function(){for(var e in a&&a.disconnect(),t.disconnect(),r.disconnect(),c.disconnect(),this)delete this[e];t=null}};return s.time(.45),s.speed(.2),s.depth(.1),s.feedback(.1),s.mix(.5),s},a.harmonizer=function(e){var n=this.audioContext,t=n.createGain(),a=void 0===e?n.createGain():null;a&&(e=a);for(var r=[],o=[],c=[],u=0;u<8;u++)r[u]=n.createBiquadFilter(),r[u].type="bandpass",o[u]=n.createBiquadFilter(),o[u].type="bandpass",e.connect(r[u]),c[u]=n.createGain(),c[u].connect(t),r[u].connect(o[u]).connect(c[u]);t.gain.value=35;var d={pitch:0,slope:0,width:0},l={output:t,input:a,pitch:function(e){if(void 0===e)return d.pitch;d.pitch=e;for(var n=i.convert.midiToFreq(e),t=0;t<8;t++)r[t].frequency.value=n,o[t].frequency.value=n},slope:function(e){if(void 0===e)return d.slope;d.slope=e;for(var n=0;n<8;n++)c[n].gain.value=1+Math.sin(Math.PI+Math.PI/2*(e+n/8))},width:function(e){if(void 0===e)return d.width;d.width=e;for(var n=1;n<8;n++){var t=2+90*Math.pow(1-n/8,e);r[n].Q.value=t,o[n].Q.value=t}},destroy:function(){a&&a.disconnect(),t.disconnect();for(var e=0;e<8;e++)r[e].disconnect();for(var n in this)delete this[n];t=null}};return l.pitch(34),l.slope(.65),l.width(.15),l},a.noise=function(){var e=this.audioContext,n=e.createGain(),t=void 0===sourceNode?e.createGain():null;t&&(sourceNode=t);for(var i=Math.floor(9.73*e.sampleRate),a=new Float32Array(i),r=0;r<i;r++)a[r]=Math.sqrt(-2*Math.log(Math.random()))*Math.cos(2*Math.PI*Math.random())*.5;var o=e.createBuffer(2,i,e.sampleRate);o.getChannelData(0).set(a,0),o.getChannelData(1).set(a,0);var c=e.createBufferSource();return c.to(n),c.loop=!0,c.start(0),c.buffer=o,c.loopStart=9.73*Math.random(),{output:n,input:t,destroy:function(){for(var e in c.loop=!1,c.buffer=null,c.stop(0),c.disconnect(),c=null,t&&t.disconnect(),n.disconnect(),this)delete this[e];n=null}}},a.pingPongDelay=function(e){var n=this.audioContext,t=n.createGain(),i=void 0===e?n.createGain():null;i&&(e=i);var a=n.createDelay(),r=n.createDelay(),o=n.createGain(),c=n.createGain(),u=n.createGain(),d=n.createChannelMerger(2);e.connect(o),o.connect(t),a.connect(d,0,0),r.connect(d,0,1),a.connect(r),u.connect(a),r.connect(u),e.connect(u),d.connect(c),c.connect(t);var l={output:t,input:i,mix:function(e){if(void 0===e)return c.gain.value;o.gain.value=1-e,c.gain.value=e},time:function(e){if(void 0===e)return a.delayTime.value;a.delayTime.value=e,r.delayTime.value=e},feedback:function(e){if(void 0===e)return u.gain.value;u.gain.value=e},destroy:function(){for(var e in i&&i.disconnect(),t.disconnect(),o.disconnect(),u.disconnect(),this)delete this[e];t=null}};return l.mix(.5),l.time(.3),l.feedback(.5),l},a.pitchShift=function(e){var n=this.audioContext,t=n.createGain(),i=void 0===e?n.createGain():null;i&&(e=i);var a=.1,r=a/2,o=a*n.sampleRate,c=n.createGain(),u=n.createGain(),d=n.createDelay(),l=n.createDelay();c.connect(d.delayTime),u.connect(l.delayTime),e.connect(d),e.connect(l);var f=n.currentTime+r,s=n.currentTime+a;function v(e){for(var t=n.createBuffer(1,o,n.sampleRate),i=t.getChannelData(0),a=0;a<o;a++)i[a]=e?(o-a)/o:a/o;return t}for(var p=[0,0,0,0],m=[0,0,0,0],h=0;h<p.length;h++)p[h]=n.createBufferSource(),p[h].loop=!0,m[h]=n.createGain(),h<2?p[h].buffer=v(!1):(p[h].buffer=v(!0),m[h].gain.value=0),h%2?(m[h].connect(u),p[h].start(s)):(m[h].connect(c),p[h].start(f)),p[h].connect(m[h]);var y=function(){for(var e=n.createBuffer(1,o,n.sampleRate),t=e.getChannelData(0),i=r*n.sampleRate,a=o-i,c=0;c<o;c++)t[c]=c<i?Math.sqrt(c/i):Math.sqrt(1-(c-a)/i);return e}(),g=[0,0],b=[0,0];for(h=0;h<g.length;h++)g[h]=n.createBufferSource(),g[h].loop=!0,g[h].buffer=y,b[h]=n.createGain(),b[h].gain.value=0,g[h].connect(b[h].gain),h%2?(m[h].connect(u),g[h].start(s)):(m[h].connect(c),g[h].start(f)),b[h].connect(t);function T(e){c.gain.value=u.gain.value=.5*a*Math.abs(e)}d.connect(b[0]),l.connect(b[1]);var x={output:t,input:i,shift:function(e){if(void 0!==e){var n=e>0;m[0].gain.value=m[1].gain.value=n?0:1,m[2].gain.value=m[3].gain.value=n?1:0,T(e)}},destroy:function(){i&&i.disconnect(),t.disconnect();for(var e=0;e<g.length;e++)g[e].stop(),g[e].disconnect(),b[e].disconnect();for(e=0;e<p.length;e++)p[e].stop(),p[e].disconnect(),m[e].disconnect();for(var n in c.disconnect(),u.disconnect(),d.disconnect(),l.disconnect(),this)delete this[n];t=null}};return T(0),x},a.reverb=function(e){var n=this.audioContext,t=n.createGain(),i=void 0===e?n.createGain():null;i&&(e=i);var a=n.createConvolver(),r=n.createGain(),o=n.createGain();e.connect(o),o.connect(t),r.connect(t);var c=1,u=.1,d=!1;function l(){for(var t=n.sampleRate*c,i=n.createBuffer(2,t,n.sampleRate),o=i.getChannelData(0),l=i.getChannelData(1),f=0;f<t;f++){var s=d?t-f:f;o[f]=(2*Math.random()-1)*Math.pow(1-s/t,u),l[f]=(2*Math.random()-1)*Math.pow(1-s/t,u)}a.disconnect(),a=n.createConvolver(),e.connect(a),a.connect(r),a.buffer=i}return l(),{output:t,input:i,mix:function(e){if(void 0===e)return r.gain.value;o.gain.value=1-e,r.gain.value=e},time:function(e){if(void 0===e)return c;c=e,l()},decay:function(e){if(void 0===e)return u;u=e,l()},reverse:function(e){if(void 0===e)return d;d=e,l()},destroy:function(){for(var e in i&&i.disconnect(),o.disconnect(),t.disconnect(),a.disconnect(),this)delete this[e];t=null}}},a.stereoPanner=function(e){var n=this.audioContext,t=n.createGain(),i=void 0===e?n.createGain():null;i&&(e=i);var a=!1;if(n.createStereoPanner){var r=n.createStereoPanner();a=!0}else{(r=n.createPanner()).type="equalpower"}return e.connect(r),r.connect(t),r.pan.value=0,{output:t,input:i,set:function(e){if(void 0===e)return r.pan.value;a?r.pan.value=e:r.setPosition(e,0,1-Math.abs(e))},destroy:function(){for(var e in i&&i.disconnect(),t.disconnect(),r.disconnect(),this)delete this[e];t=r=null}}},a.tremolo=function(e){var n=this.audioContext,t=n.createGain(),a=void 0===e?n.createGain():null;a&&(e=a);var r=n.createGain(),o=n.createGain(),c=n.createGain();c.gain.value=0;var u=n.createWaveShaper();u.curve=new Float32Array([0,1]),u.connect(c.gain),e.connect(r),r.connect(t);var d=n.createOscillator();d.connect(u),d.type="sine",d.start(0),e.connect(c),c.connect(o),o.connect(t);var l={output:t,input:a,mix:function(e){if(void 0===e)return o.gain.value;r.gain.value=1-e,o.gain.value=e},speed:function(e){if(void 0===e)return i.extra.denormalize(d.frequency.value,0,20);d.frequency.value=i.extra.normalize(e,0,20)},depth:function(e){if(void 0===e)return 1-this.shaperNode.curve[0];u.curve=new Float32Array([1-e,1])},destroy:function(){for(var e in a&&a.disconnect(),t.disconnect(),r.disconnect(),c.disconnect(),this)delete this[e];t=null}};return l.speed(.2),l.depth(1),l.mix(.8),l},a.vibrato=function(e){var n=this.audioContext,t=n.createGain(),i=void 0===e?n.createGain():null;i&&(e=i),console.log("Vibrato was not finished yet");var a=n.createDelay(),r=n.createGain(),o=n.createGain(),c=n.createOscillator();return e.connect(o),o.connect(t),r.connect(t),a.delayTime.value=1,c.frequency.value=3,c.type="sine",c.start(0),c.connect(a.delayTime),e.connect(a),a.connect(r),{output:t,input:i,mix:function(e){if(void 0===e)return r.gain.value;o.gain.value=1-e,r.gain.value=e},delay:function(e){if(void 0===e)return a.delayTime.value;a.delayTime.value=e},depth:function(e){if(void 0===e)return depthNode.gain.value;depthNode.gain.value=e},speed:function(e){if(void 0===e)return c.frequency.value;c.frequency.value=e},destroy:function(){for(var n in i&&i.disconnect(),t.disconnect(),e.disconnect(a),e.disconnect(o),c.stop(),c.disconnect(),depthNode.disconnect(),this)delete this[n];t=null}}},i.extra=new function(){this.isMobile=function(){return/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(navigator.userAgent)},this.objectPropertyLinker=function(e,n,t){Object.defineProperty(e,t,{get:function(){return n[t]},set:function(e){n[t]=e},enumerable:!0,configurable:!0})},this.normalize=function(e,n,t){return(t-n)*e+n},this.denormalize=function(e,n,t){return(e-n)/(t-n)};var e=0;this.fadeNumber=function(n,t,i,a,r,o){e=0;var c=n,u=a/(Math.abs(n-t)/Math.abs(i));if(u&&u!=1/0)var d=setInterval(function(){if(e>=100&&clearInterval(d),e++,c=1e3*(c+i),c=Math.ceil(c)/1e3,i>=0&&(c>=t||n>=t)||i<=0&&(c<=t||n<=t)||c==1/0||!c)return clearInterval(d),r(t),void(o&&o());r&&r(c)},u);else setTimeout(function(){r&&r(t),o&&o()},a)};var n=[],t=0;this.preciseTimeout=function(e,i){var a=Date.now();return t++,n.push({id:t,when:a+i,func:e,fallback:setTimeout(function(){r(t).func()},i)}),c(),t},this.clearPreciseTimeout=function(e){r(e,n)};var i=[],a=0;function r(e,n){for(var t in n)if(n[t].id===e)return n.splice(t,1)}this.preciseInterval=function(e,n){var t=Date.now(),r={id:++a,interval:n,when:t+n,func:e};return r.fallback=setInterval(function(){r.when>=Date.now()||(r.when+=r.interval,r.func())},n),i.push(r),c(),a},this.clearPreciseInterval=function(e){var n=r(e,i);clearInterval(n.fallback)};var o=!1;function c(){if(!o){o=!0;requestAnimationFrame(function e(){if(0!==n.length||0!==i.length){requestAnimationFrame(e);var t=Date.now();for(var a in n)n[a].when<t&&(n[a].func(),clearTimeout(n[a].fallback),n.splice(a,1));for(var a in i)i[a].when<t&&(i[a].func(),i[a].when+=i[a].interval)}else o=!1})}}},t?(e.Media=i,e.MediaEffect=a,e.AudioBufferStreamer=r,e.MediaPlayer=o,e.MediaPresenter=c):(e.ScarletsMedia=i,e.ScarletsMediaEffect=a,e.ScarletsAudioBufferStreamer=r,e.ScarletsMediaPlayer=o,e.ScarletsMediaPresenter=c)});
//# sourceMappingURL=SFMediaStream.min.js.map
