{"version":3,"sources":["a_init.js","AudioStreamer.js","BufferHeader.js","Convert.js","MediaBuffer.js","MediaPlayer.js","MediaPresenter.js","Plugin/Chorus.js","Plugin/ConReverb.js","Plugin/CutOff.js","Plugin/Delay.js","Plugin/Distortion.js","Plugin/DubDelay.js","Plugin/Equalizer.js","Plugin/Fade.js","Plugin/Flanger.js","Plugin/Harmonizer.js","Plugin/Noise.js","Plugin/PingPongDelay.js","Plugin/PitchShift.js","Plugin/Reverb.js","Plugin/StereoPanner.js","Plugin/Tremolo.js","Plugin/Vibrato.js","VideoStreamer.js","z_extra.js"],"names":["global","factory","exports","_typeof","module","window","this","moduleMode","ScarletsMedia","audioContext","getElementAudioNode","elem","crossOrigin","createMediaElementSource","getElementVideoNode","ScarletsMediaEffect","audioCodecs","webm","mp4","ogg","videoCodecs","3gpp","waitingUnlock","userInteracted","AudioContext","console","error","mobileMediaUnlock","e","emptyBuffer","createBuffer","source","createBufferSource","buffer","connect","destination","onended","disconnect","removeListener","start","noteOn","resume","document","removeEventListener","i","length","addEventListener","ScarletsAudioStreamer","chunksDuration","chunksSeconds","scope","debug","playing","latency","mimeType","bufferElement","onStop","outputNode","directAudioOutput","bufferHeader","mediaBuffer","audioElement","element","Audio","audioNode","target","node","createGain","stop","buffering","setBufferHeader","packet","data","arrayBuffer","MediaBuffer","Uint8Array","src","objectURL","decodeAudioData","slice","audioBuffer","noiseLength","getChannelData","webAudioBufferInsert","index","temp","frameCount","channelLength","numberOfChannels","newBuffer","sampleRate","set","subarray","cleanNoise","context","destinatgion","playStream","bufferElementIndex","realtimeBufferPlay","streamingTime","log","byteLength","Number","String","Date","now","baseLatency","finalBuffer","addBufferHeader","receiveBuffer","append","paused","play","BufferHeader","audio/webm;codecs=opus","convert","midiToFreq","midi","Math","pow","floor","freqToMidi","freq","LN2","powerToDb","power","db","LN10","dbToPower","exp","ampToDb","lin","dbToAmp","velToAmp","velocity","MediaSource","URL","createObjectURL","removing","totalTime","sourceBuffer","buffers","startAppending","appendBuffer","onsourceopen","addSourceBuffer","mode","onerror","onupdateend","remove","updating","shift","buffered","push","abort","readyState","endOfStream","ScarletsMediaPlayer","self","constructor","createElement","body","appendChild","propertyLinker","audioOutputNode","Object","defineProperty","get","enumerable","tagName","toLowerCase","concat","videoOutputNode","load","canPlayType","extra","objectPropertyLinker","preload","crossorigin","audioFadeEffect","speed","undefined","defaultPlaybackRate","playbackRate","mute","muted","defaultMuted","pause","currentTime","volume","stillWaiting","successCallback","errorCallback","then","catch","fadeNumber","num","callback","prepare","links","force","querySelectorAll","once","off","insertAdjacentHTML","split","join","eventRegistered","eventTrigger","type","on","eventName","name","splice","indexOf","destroy","key","playlist","list","original","innerHTML","playlistInitialized","internalPlaylistEvent","currentIndex","next","loop","playlistTriggerEvent","shuffled","reload","lists","shuffle","add","obj","autoplay","previous","stream","currentSrc","j","x","random","ScarletsMediaPresenter","options","mediaStream","onRecordingReady","onBufferProcess","mediaRecorder","recordingReady","recording","mediaGranted","captureStream","mediaType","video","MediaRecorder","isTypeSupported","supportedMimeType","codecsList","format","codecs","audio","createMediaStreamSource","pendingConnect","firstSourceConnect","bufferHeaderLength","onstart","isVideo","headerLatency","ondataavailable","state","size","predefinedBuffer","chrome","buff","Blob","atob","UInt","charCodeAt","getBufferHeader","startTime","hasVideo","setTimeout","createMediaStreamDestination","reAddTracks","streams","getTracks","addTrack","afterStop","startRecording","screen","navigator","mediaDevices","getDisplayMedia","getUserMedia","stopRecording","removeTrack","chorus","sourceNode","output","input","dry","wet","splitter","createChannelSplitter","merger","createChannelMerger","channel","c","delayVibrato","createDelay","delayFixed","feedback","feedforward","blend","lfo","createOscillator","LDepth","RDepth","delayTime","frequency","value","gain","rate","intensity","mix","ret","conReverb","reverbNode","createConvolver","wetGainNode","dryGainNode","setBuffer","loadBuffer","url","ajaxRequest","XMLHttpRequest","open","responseType","onload","audioData","response","err","send","cutOff","passType","filterNode","createBiquadFilter","Q","width","delay","feedbackGainNode","delayNode","time","distortion","deg","PI","waveShaperNode","createWaveShaper","amount","curve","Float32Array","abs","dubDelay","bqFilterNode","cutoff","equalizer","frequencies","lastIndex","filter","dB","fade","in","cancelScheduledValues","remainingTime","setTargetAtTime","out","flanger","inputFeedbackNode","oscillatorNode","gainNode","feedbackNode","denormalize","normalize","depth","harmonizer","filters1","filters2","gains","pitch","slope","f0","sin","q","noise","noiseFloat32","sqrt","cos","noiseBuffer","to","loopStart","pingPongDelay","delayNodeLeft","delayNodeRight","channelMerger","pitchShift","bufferTime","fadeTime","bufferRate","modulateGain1","modulateGain2","delayNode1","delayNode2","fTime","bTime","createPitchBuffer","shiftUp","bufferSource","bufferGain","fadeBuffer","fadeLength","bufferLeft","createPitchFadeBuffer","fadeNode","mixNode","pitchGain","pitchUp","reverb","decay","reverse","rebuildImpulse","impulse","impulseL","impulseR","n","stereoPanner","stereoSupport","createStereoPanner","pannerNode","createPanner","pan","setPosition","tremolo","tremoloGainNode","shaperNode","lfoNode","vibrato","depthNode","ScarletsVideoStreamer","videoElement","audioConnect","audioDisconnect","isMobile","test","userAgent","property","configurable","min","max","maxFade","from","increment","onIncrease","onFinish","current","interval","Infinity","timer","setInterval","clearInterval","ceil","timeout","timeoutIncrement","preciseTimeout","func","miliseconds","id","when","fallback","clearPreciseTimer","startPreciseTime","clearPreciseTimeout","intervalIncrement","preciseInterval","clearPreciseInterval","preciseTimerStarted","requestAnimationFrame","preciseTimer","clearTimeout","Media","MediaEffect","AudioStreamer","VideoStreamer","MediaPlayer","MediaPresenter"],"mappings":"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","file":"SFMediaStream.min.js","sourcesContent":["/*\n\tScarletsFiction MediaStream Library\n\n\tHTML5 media streamer library for playing music, video, playlist,\n\tor even live streaming microphone & camera with node server\n\thttps://github.com/ScarletsFiction/SFMediaStream\n*/\n(function(global, factory){\n  if(typeof exports === 'object' && typeof module !== 'undefined'){\n  \tmodule.exports = {};\n  \tfactory(module.exports, window, true);\n  }\n  else factory(global, window);\n}(this || window, (function(global, window, moduleMode){'use strict';\n// ===== Module Init =====\n\n// Initialize global data\nvar ScarletsMedia = {\n\taudioContext: false, // Created after user gesture\n\n\t// Get Audio Node from HTML5's audio tag\n\tgetElementAudioNode:function(elem){\n\t\telem.crossOrigin = 'anonymous';\n\t\treturn this.audioContext.createMediaElementSource(elem);\n\t},\n\n\t// videoContext: window.VideoContext ? new VideoContext() : false,\n\n\t// Still underdevelopment: https://github.com/bbc/VideoContext\n\tgetElementVideoNode:function(elem){\n\t\telem.crossOrigin = 'anonymous';\n\t\treturn null;\n\t}\n};\n\nvar ScarletsMediaEffect = {};\nvar audioCodecs = {\n\twebm:['opus', 'vorbis'],\n\tmp4:['mp4a.67', 'mp4a.40.29', 'mp4a.40.5', 'mp4a.40.2', 'mp3'],\n\togg:['opus', 'vorbis'], // This may not work on mobile\n};\nvar videoCodecs = {\n\twebm:['vp8,opus', 'vp8,vorbis'],\n\tmp4:['mp4v.20.8,mp4a.40.2', 'mp4v.20.240,mp4a.40.2', 'avc1.42E01E,mp4a.40.2', 'avc1.58A01E,mp4a.40.2', 'avc1.64001E,mp4a.40.2'],\n\t'3gpp':['mp4v.20.8,samr'],\n\togg:['dirac,vorbis', 'theora,vorbis'], // This may not work on mobile\n};\n\nvar waitingUnlock = [];\nvar userInteracted = false;\n\n// Unlock mobile media security\n(function(){\n\tif(!window.AudioContext) return console.error(\"`AudioContext` was not available\");\n\tScarletsMedia.audioContext = new AudioContext();\n\n\tvar mobileMediaUnlock = function(e){\n\t\tvar emptyBuffer = ScarletsMedia.audioContext.createBuffer(1, 1, 22050);\n\t\tvar source = ScarletsMedia.audioContext.createBufferSource();\n\t\tsource.buffer = emptyBuffer;\n\t\tsource.connect(ScarletsMedia.audioContext.destination);\n\n\t\tsource.onended = function(){\n\t\t\tsource.disconnect(0);\n\t\t\tsource = emptyBuffer = null;\n\n\t\t\tremoveListener();\n\t\t}\n\n\t\t// Play the empty buffer.\n\t\tif(!source.start) source.noteOn(0);\n\t\telse source.start(0);\n\t\tScarletsMedia.audioContext.resume();\n\t}\n\n\tfunction removeListener(){\n\t\tdocument.removeEventListener('touchstart', mobileMediaUnlock, true);\n\t\tdocument.removeEventListener('touchend', mobileMediaUnlock, true);\n\t\tdocument.removeEventListener('click', mobileMediaUnlock, true);\n\n\t\tfor (var i = 0; i < waitingUnlock.length; i++) {\n\t\t\twaitingUnlock[i]();\n\t\t}\n\n\t\twaitingUnlock.length = 0;\n\t}\n\n\tdocument.addEventListener('touchstart', mobileMediaUnlock, true);\n\tdocument.addEventListener('touchend', mobileMediaUnlock, true);\n\tdocument.addEventListener('click', mobileMediaUnlock, true);\n})();","// Minimum 3 bufferElement\nvar ScarletsAudioStreamer = function(chunksDuration){\n\tif(!chunksDuration) chunksDuration = 1000;\n\tvar chunksSeconds = chunksDuration/1000;\n\n\tvar scope = this;\n\n\tscope.debug = false;\n\tscope.playing = false;\n\tscope.latency = 0;\n\tscope.mimeType = null;\n\tscope.bufferElement = [];\n\n\tscope.onStop = null;\n\n\tscope.audioContext = ScarletsMedia.audioContext;\n\tscope.outputNode = false; // Set this to a connectable Audio Node\n\n\t// If the outputNode is not set, then the audio will be outputted directly\n\tvar directAudioOutput = true;\n\n\tvar bufferHeader = false;\n\tvar mediaBuffer = false;\n\n\tvar audioElement = scope.element = new Audio();\n\tvar audioNode = scope.audioContext.createMediaElementSource(audioElement);\n\n\t// ToDo: we may need to try to recreate the element if error happen\n\t// Or reducing the extra latency\n\taudioElement.addEventListener('error', function(e){\n\t\tconsole.error(e.target.error);\n\t});\n\n\tscope.connect = function(node){\n\t\tif(directAudioOutput === true){\n\t\t\tdirectAudioOutput = false;\n\t\t\taudioNode.disconnect();\n\t\t}\n\n\t\tscope.outputNode = scope.audioContext.createGain();\n\t\tscope.outputNode.connect(node);\n\t\taudioNode.connect(node);\n\t}\n\n\tscope.disconnect = function(node){\n\t\tscope.outputNode.disconnect(node);\n\t\tdirectAudioOutput = true;\n\n\t\taudioNode.disconnect(node);\n\t\taudioNode.connect(scope.audioContext.destination);\n\t}\n\n\tscope.stop = function(){\n\t\tmediaBuffer.stop();\n\t\tscope.playing = false;\n\t\tscope.buffering = false;\n\t\tif (scope.onStop) scope.onStop();\n\t}\n\n\tscope.setBufferHeader = function(packet){\n\t\tif(!packet.data){\n\t\t\tbufferHeader = false;\n\t\t\treturn;\n\t\t}\n\n\t\tvar arrayBuffer = packet.data;\n\t\tscope.mimeType = packet.mimeType;\n\n\t\tif(mediaBuffer !== false)\n\t\t\tmediaBuffer.stop();\n\t\telse audioNode.connect(scope.audioContext.destination);\n\n\t\tmediaBuffer = new MediaBuffer(scope.mimeType, chunksDuration, arrayBuffer);\n\t\tbufferHeader = new Uint8Array(arrayBuffer);\n\n\t\taudioElement.src = scope.objectURL = mediaBuffer.objectURL;\n\n\t\t// Get buffer noise length\n\t\tscope.audioContext.decodeAudioData(arrayBuffer.slice(0), function(audioBuffer){\n\t\t\t// headerDuration = audioBuffer.duration;\n\t\t\tnoiseLength = audioBuffer.getChannelData(0).length;\n\t\t});\n\t}\n\n\t// ===== For handling WebAudio =====\n\tfunction createBufferSource(){\n\t\tvar temp = scope.audioContext.createBufferSource();\n\t\ttemp.onended = function(){\n\t\t\tthis.stop();\n\t\t\tthis.disconnect();\n\t\t}\n\t\treturn temp;\n\t}\n\n\tvar addBufferHeader = function(arrayBuffer){\n\t\tvar finalBuffer = new Uint8Array(bufferHeader.byteLength + arrayBuffer.byteLength);\n\t\tfinalBuffer.set(bufferHeader, 0);\n\t\tfinalBuffer.set(new Uint8Array(arrayBuffer), bufferHeader.byteLength);\n\t\treturn finalBuffer.buffer;\n\t}\n\n\tvar noiseLength = 0;\n\tfunction cleanNoise(buffer){\n\t\tvar frameCount = buffer.getChannelData(0).length - noiseLength;\n\t\tif(frameCount === 0) return false;\n\n  \t\tvar channelLength = buffer.numberOfChannels;\n\t\tvar newBuffer = scope.audioContext.createBuffer(channelLength, frameCount, buffer.sampleRate);\n\n\t\tfor (var i = 0; i < channelLength; i++) {\n\t    \tnewBuffer.getChannelData(i).set(buffer.getChannelData(i).subarray(noiseLength));\n\t    }\n\n\t    return newBuffer;\n\t}\n\n\tfunction webAudioBufferInsert(index, buffer){\n\t\tscope.bufferElement[index] = createBufferSource();\n\t\tbuffer = cleanNoise(buffer);\n\n\t\tif(buffer === false) return false;\n\t\tscope.bufferElement[index].buffer = buffer;\n\n\t\tif(scope.outputNode && scope.outputNode.context && directAudioOutput === false)\n\t\t\tscope.bufferElement[index].connect(scope.outputNode);\n\n\t\telse // Direct output to destination\n\t\t\tscope.bufferElement[index].connect(scope.audioContext.destinatgion);\n\t\treturn true;\n\t}\n\n\t// ===== Realtime Playing =====\n\t// Play audio immediately after received\n\n\tscope.playStream = function(){\n\t\tscope.playing = true;\n\t}\n\n\tvar bufferElementIndex = 0;\n\tscope.realtimeBufferPlay = function(packet){\n\t\tif(scope.playing === false) return;\n\n\t\tvar arrayBuffer = packet[0];\n\t\tvar streamingTime = packet[1];\n\n\t\tif(scope.debug) console.log(\"Receiving data\", arrayBuffer.byteLength);\n\t\tif(arrayBuffer.byteLength === 0) return;\n\n\t\tscope.latency = (Number(String(Date.now()).slice(-5, -3)) - streamingTime) + chunksSeconds + scope.audioContext.baseLatency;\n\n\t\tvar index = bufferElementIndex;\n\t\tbufferElementIndex++;\n\t\tif(bufferElementIndex > 2)\n\t\t\tbufferElementIndex = 0;\n\n\t\tscope.audioContext.decodeAudioData(addBufferHeader(arrayBuffer), function(buffer){\n\t\t\tif(webAudioBufferInsert(index, buffer) === false)\n\t\t\t\treturn;\n\n\t\t\tscope.bufferElement[index].start(0);\n\t\t});\n\t}\n\n\t// ====== Synchronous Playing ======\n\t// Play next audio when last audio was finished\n\n\tscope.receiveBuffer = function(packet){\n\t\tif(scope.playing === false || !mediaBuffer.append) return;\n\n\t\tvar arrayBuffer = packet[0];\n\t\tvar streamingTime = packet[1];\n\n\t\tmediaBuffer.append(arrayBuffer);\n\n\t\tif(audioElement.paused)\n\t\t\taudioElement.play();\n\n\t\tscope.latency = (Number(String(Date.now()).slice(-5, -3)) - streamingTime) +  scope.audioContext.baseLatency + chunksSeconds;\n\t\tif(scope.debug) console.log(\"Total latency: \"+scope.latency);\n\t}\n}\n","var BufferHeader = {\n\t\"audio/webm;codecs=opus\": \"GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQRChYECGFOAZwH/////////FUmpZpkq17GDD0JATYCGQ2hyb21lV0GGQ2hyb21lFlSua7+uvdeBAXPFh7o5nyc1kHqDgQKGhkFfT1BVU2Oik09wdXNIZWFkAQIAAIC7AAAAAADhjbWERzuAAJ+BAmJkgSAfQ7Z1Af/////////ngQCjjIEAAID/A//+//7//qM=\"\n};\n\nfunction getBufferHeader(type) {\n\tif (!window.chrome && type === \"audio/webm;codecs=opus\" ) {\n\t\t// this header is only for chrome based brosers\n\t\treturn false;\n\t}\n\n\tvar buff = BufferHeader[type];\n\tif(buff === void 0) return false;\n\n\tif(buff.constructor === Blob)\n\t\treturn buff;\n\n\tbuff = atob(buff);\n\n\tvar UInt = new Uint8Array(buff.length);\n\tfor (var i = 0; i < buff.length; i++)\n\t\tUInt[i] = buff.charCodeAt(i);\n\n\treturn BufferHeader[type] = new Blob([UInt]);\n}","ScarletsMedia.convert = {\n\t// Converts a MIDI pitch number to frequency.\n\t// midi = 0 ~ 127\n\tmidiToFreq:function (midi) {\n\t    if(midi <= -1500) return 0;\n\t    else if(midi > 1499) return 3.282417553401589e+38;\n\t    else return 440.0 * Math.pow(2, (Math.floor(midi) - 69) / 12.0);\n\t},\n\n\t// Converts frequency to MIDI pitch.\n\tfreqToMidi:function(freq){\n\t\tif(freq > 0)\n\t\t\treturn Math.floor(Math.log(freq/440.0) / Math.LN2 * 12 + 69);\n\t\telse return -1500;\n\t},\n\n    // Converts power to decibel. Note that it is off by 100dB to make it\n\tpowerToDb:function(power){\n\t    if (power <= 0)\n\t    \treturn 0;\n\t    else {\n\t        var db = 100 + 10.0 / Math.LN10 * Math.log(power);\n\t        if(db < 0) return 0;\n\t        return db;\n\t    }\n\t},\n\n    // Converts decibel to power\n\tdbToPower:function(db){\n\t    if (db <= 0) return 0;\n\t    else {\n  \t        if (db > 870) db = 870;\n  \t        return Math.exp(Math.LN10 * 0.1 * (db - 100.0));\n\t    }\n\t},\n\n\t// Converts amplitude to decibel.\n\tampToDb:function(lin){\n\t    return 20.0 * (lin > 0.00001 ? (Math.log(lin) / Math.LN10) : -5.0);\n\t},\n\n\t// Converts decibel to amplitude\n\tdbToAmp:function(db) {\n\t    return Math.pow(10.0, db / 20.0);\n\t},\n\n\t// Converts MIDI velocity to amplitude\n\tvelToAmp:function (velocity) {\n\t    return velocity / 127;\n\t},\n}","var MediaBuffer = function(mimeType, chunksDuration, bufferHeader){\n\tvar scope = this;\n\tscope.source = new MediaSource();\n\tscope.objectURL = URL.createObjectURL(scope.source);\n\n\tvar removing = false;\n\tvar totalTime = 0; // miliseconds\n\tvar sourceBuffer = null;\n\tvar buffers = [];\n\n\tscope.source.onsourceopen = function(){\n\t\tsourceBuffer = scope.source.addSourceBuffer(mimeType);\n\t\tsourceBuffer.mode = 'sequence';\n\t\tsourceBuffer.appendBuffer(bufferHeader);\n\n\t\tsourceBuffer.onerror = function(e){\n\t\t\tconsole.error(\"SourceBuffer error:\", e);\n\t\t}\n\n\t\tsourceBuffer.onupdateend = function(){\n\t\t\tif(removing){\n\t\t\t\tremoving = false;\n\t\t\t\ttotalTime = 10000;\n\n\t\t\t\t// 0 ~ 10 seconds\n\t\t\t\tsourceBuffer.remove(0, 10);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif(!sourceBuffer.updating && buffers.length !== 0)\n\t\t\t\tstartAppending(buffers.shift());\n\t\t};\n\t};\n\n\tfunction startAppending(buffer){\n\t\tsourceBuffer.appendBuffer(buffer);\n\t\ttotalTime += chunksDuration;\n\t\t// console.log(totalTime, buffer);\n\t}\n\n\tscope.source.onerror = function(e){\n\t\tconsole.error(\"MediaSource error:\", e);\n\t}\n\n\tscope.append = function(arrayBuffer){\n\t\tif(sourceBuffer === null)\n\t\t\treturn false;\n\n\t\tif (!sourceBuffer.updating && sourceBuffer.buffered.length === 2)\n\t\t\t// The problem of accessing to 'sourceBuffer.buffered' is that after you append data, the SourceBuffer instance becomes temporarily unusable while it's working.\n\t\t\t// During this time, the SourceBuffer's updating property will be set to true, so it's easy to check for.\n\t\t\tconsole.log('something wrong');\n\n\t\tif(totalTime >= 20000)\n\t\t\tremoving = true;\n\n\t\tif(!sourceBuffer.updating)\n\t\t\tstartAppending(arrayBuffer);\n\t\telse\n\t\t\tbuffers.push(arrayBuffer);\n\n\t\treturn totalTime/1000;\n\t}\n\n\tscope.stop = function(){\n\t\tif(sourceBuffer.updating)\n\t\t\tsourceBuffer.abort();\n\n\t\tif(scope.source.readyState === \"open\")\n\t\t\tscope.source.endOfStream();\n\t}\n}","// https://www.w3schools.com/tags/ref_av_dom.asp\n// https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement\nvar ScarletsMediaPlayer = function(element){\n\t// https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Media_events\n\tvar self = this;\n\n\tif(element === void 0)\n\t\telement = 'audio';\n\n\tif(element.constructor === String){\n\t\tif(element !== 'audio' && element !== 'video')\n\t\t\treturn console.error('Supported player is \"audio\" or \"video\"');\n\n\t\telement = document.createElement(element);\n\t\tdocument.body.appendChild(element);\n\t}\n\n\tvar propertyLinker = ['autoplay', 'loop', 'buffered', 'buffered', 'controller', 'currentTime', 'currentSrc', 'duration', 'ended', 'error', 'readyState', 'networkState', 'paused', 'played', 'seekable', 'seeking'];\n\n\t// Get element audio for output node\n\tvar audioOutputNode = false;\n\tObject.defineProperty(self, 'audioOutput', {\n\t\tget: function(){\n\t\t\tif(!audioOutputNode)\n\t\t\t\taudioOutputNode = ScarletsMedia.getElementAudioNode(element);\n\n\t\t\treturn audioOutputNode;\n\t\t},\n\t\tenumerable: true\n\t});\n\n\tif(element.tagName.toLowerCase() === 'video'){\n\t\tpropertyLinker = propertyLinker.concat(['poster', 'height', 'width']);\n\n\t\t// Get element video for output node\n\t\tvar videoOutputNode = false;\n\t\tObject.defineProperty(self, 'videoOutput', {\n\t\t\tget: function(){\n\t\t\t\tif(!videoOutputNode)\n\t\t\t\t\tvideoOutputNode = ScarletsMedia.getElementVideoNode(element);\n\n\t\t\t\treturn videoOutputNode;\n\t\t\t},\n\t\t\tenumerable: true\n\t\t});\n\t}\n\n\t// Reference element function\n\tself.load = function(){\n\t\telement.load();\n\t}\n\n\tself.canPlayType = function(){\n\t\telement.canPlayType();\n\t}\n\n\t// Reference element property\n\tfor (var i = 0; i < propertyLinker.length; i++) {\n\t\tScarletsMedia.extra.objectPropertyLinker(self, element, propertyLinker[i]);\n\t}\n\n\tself.preload = true;\n\telement.preload = 'metadata';\n\telement.crossorigin = 'anonymous';\n\tself.audioFadeEffect = true;\n\n\tself.speed = function(set){\n\t\tif(set === undefined) return element.defaultPlaybackRate;\n\t\telement.defaultPlaybackRate = element.playbackRate = set;\n\t}\n\n\tself.mute = function(set){\n\t\tif(set === undefined) return element.muted;\n\t\telement.defaultMuted = element.muted = set;\n\t}\n\n\tself.stop = function(){\n\t\tself.pause();\n\t\tself.currentTime = 0;\n\t}\n\n\tvar volume = 1;\n\tself.volume = function(set){\n\t\tif(set === undefined) return volume;\n\t\telement.volume = volume = set;\n\t}\n\n\tvar stillWaiting = false;\n\tfunction play(successCallback, errorCallback){\n\t\telement.play().then(function(){\n\t\t\tstillWaiting = false;\n\t\t\tif(successCallback) successCallback();\n\t\t}).catch(function(e){\n\t\t\tif(errorCallback) errorCallback(e);\n\t\t\telse{\n\t\t\t\t// If user haven't interacted with the page\n\t\t\t\t// and media play was requested, let's pending it\n\t\t\t\tif(userInteracted === false){\n\t\t\t\t\tif(stillWaiting === false){\n\t\t\t\t\t\twaitingUnlock.push(function(){\n\t\t\t\t\t\t\tplay(successCallback, errorCallback);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t});\n\t}\n\n\tself.play = function(successCallback, errorCallback){\n\t\tif(!element.paused){\n\t\t\tif(successCallback) successCallback();\n\t\t\treturn;\n\t\t}\n\t\tif(self.audioFadeEffect){\n\t\t\telement.volume = 0;\n\t\t\tplay(successCallback, errorCallback);\n\t\t\tScarletsMedia.extra.fadeNumber(0, volume, 0.02, 400, function(num){\n\t\t\t\telement.volume = num;\n\t\t\t}, successCallback);\n\t\t\treturn;\n\t\t}\n\n\t\tplay(successCallback, errorCallback);\n\t}\n\n\tself.pause = function(callback){\n\t\tif(element.paused){\n\t\t\tif(callback) callback();\n\t\t\treturn;\n\t\t}\n\t\tif(self.audioFadeEffect){\n\t\t\tScarletsMedia.extra.fadeNumber(volume, 0, -0.02, 400, function(num){\n\t\t\t\telement.volume = num;\n\t\t\t}, function(){\n\t\t\t\telement.pause();\n\t\t\t\tif(callback) callback();\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\telement.pause();\n\t\tif(callback) callback();\n\t}\n\n\tself.prepare = function(links, callback, force){\n\t\t// Stop playing media\n\t\tif(!force && !element.paused)\n\t\t\treturn self.pause(function(){\n\t\t\t\tself.prepare(links, callback, true);\n\t\t\t});\n\n\t\tvar temp = element.querySelectorAll('source');\n\t\tfor (var i = temp.length - 1; i >= 0; i--) {\n\t\t\ttemp[i].remove();\n\t\t}\n\n\t\tif(self.preload && callback){\n\t\t\tself.once('canplay', callback);\n\t\t\tself.once('error', function(){\n\t\t\t\tself.off('canplay', callback);\n\t\t\t});\n\t\t}\n\n\t\tif(typeof links === 'string')\n\t\t\telement.insertAdjacentHTML('beforeend', `<source src=\"${links.split('\"').join('\\\\\"')}\"/>`);\n\t\telse{\n\t\t\ttemp = '';\n\t\t\tfor (var i = 0; i < links.length; i++) {\n\t\t\t\ttemp += `<source src=\"${links[i].split('\"').join('\\\\\"')}\"/>`;\n\t\t\t}\n\t\t\telement.insertAdjacentHTML('beforeend', temp);\n\t\t}\n\n\t\t// Preload data\n\t\tif(self.preload)\n\t\t\telement.load();\n\n\t\telse if(callback)\n\t\t\tcallback();\n\t}\n\n\tvar eventRegistered = {};\n\tfunction eventTrigger(e){\n\t\tfor (var i = 0; i < eventRegistered[e.type].length; i++) {\n\t\t\teventRegistered[e.type][i](e, self);\n\t\t}\n\t}\n\n\t// https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Media_events\n\tself.on = function(eventName, callback){\n\t\tvar name = eventName.toLowerCase();\n\t\tif(eventRegistered[name] === undefined){\n\t\t\telement.addEventListener(eventName, eventTrigger, true);\n\t\t\teventRegistered[name] = [];\n\t\t}\n\t\teventRegistered[name].push(callback);\n\t\treturn self;\n\t}\n\n\tself.off = function(eventName, callback){\n\t\tvar name = eventName.toLowerCase();\n\t\tif(eventRegistered[name] === undefined){\n\t\t\telement.removeEventListener(eventName, callback, true);\n\t\t\treturn;\n\t\t}\n\n\t\tif(!callback)\n\t\t\teventRegistered[name].splice(0);\n\t\telse\n\t\t\teventRegistered[name].splice(eventRegistered[name].indexOf(callback), 1);\n\n\t\tif(eventRegistered[name].length === 0){\n\t\t\teventRegistered[name] = undefined;\n\t\t\telement.removeEventListener(eventName, eventTrigger, true);\n\t\t}\n\t\treturn self;\n\t}\n\n\tself.once = function(eventName, callback){\n\t\telement.addEventListener(eventName, callback, {once:true});\n\t\treturn self;\n\t}\n\n\tself.destroy = function(){\n\t\tfor(var key in eventRegistered){\n\t\t\tself.off(key);\n\t\t}\n\t\tself.playlist.list.splice(0);\n\t\tself.playlist.original.splice(0);\n\t\tfor(var key in self){\n\t\t\tdelete self[key];\n\t\t}\n\t\tself = null;\n\n\t\telement.pause();\n\t\telement.innerHTML = '';\n\t}\n\n\tvar playlistInitialized = false;\n\tfunction internalPlaylistEvent(){\n\t\tif(playlistInitialized) return;\n\t\tplaylistInitialized = true;\n\n\t\tself.on('ended', function(){\n\t\t\tif(self.playlist.currentIndex < self.playlist.list.length - 1)\n\t\t\t\tself.playlist.next(true);\n\t\t\telse if(self.playlist.loop)\n\t\t\t\tself.playlist.play(0);\n\t\t});\n\t}\n\n\tfunction playlistTriggerEvent(name){\n\t\tif(!eventRegistered[name]) return;\n\t\tfor (var i = 0; i < eventRegistered[name].length; i++) {\n\t\t\teventRegistered[name][i](self, self.playlist, self.playlist.currentIndex);\n\t\t}\n\t}\n\n\tself.playlist = {\n\t\tcurrentIndex:0,\n\t\tlist:[],\n\t\toriginal:[],\n\t\tloop:false,\n\t\tshuffled:false,\n\n\t\t// lists = [{yourProperty:'', stream:['main.mp3', 'fallback.ogg', ..]}, ...]\n\t\treload(lists){\n\t\t\tthis.original = lists;\n\t\t\tthis.shuffle(this.shuffled);\n\t\t\tinternalPlaylistEvent();\n\t\t},\n\n\t\t// obj = {yourProperty:'', stream:['main.mp3', 'fallback.ogg']}\n\t\tadd(obj){\n\t\t\tthis.original.push(obj);\n\t\t\tthis.shuffle(this.shuffled);\n\t\t\tinternalPlaylistEvent();\n\t\t},\n\n\t\t// index from 'original' property\n\t\tremove(index){\n\t\t\tthis.original.splice(index, 1);\n\t\t\tthis.shuffle(this.shuffled);\n\t\t},\n\n\t\tnext(autoplay){\n\t\t\tthis.currentIndex++;\n\t\t\tif(this.currentIndex >= this.list.length){\n\t\t\t\tif(this.loop)\n\t\t\t\t\tthis.currentIndex = 0;\n\t\t\t\telse{\n\t\t\t\t\tthis.currentIndex--;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(autoplay)\n\t\t\t\tthis.play(this.currentIndex);\n\t\t\telse playlistTriggerEvent('playlistchange');\n\t\t},\n\n\t\tprevious(autoplay){\n\t\t\tthis.currentIndex--;\n\t\t\tif(this.currentIndex < 0){\n\t\t\t\tif(this.loop)\n\t\t\t\t\tthis.currentIndex = this.list.length - 1;\n\t\t\t\telse{\n\t\t\t\t\tthis.currentIndex++;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(autoplay)\n\t\t\t\tthis.play(this.currentIndex);\n\t\t\telse playlistTriggerEvent('playlistchange');\n\t\t},\n\n\t\tplay(index){\n\t\t\tthis.currentIndex = index;\n\t\t\tplaylistTriggerEvent('playlistchange');\n\n\t\t\tvar src = this.list[index].stream;\n\t\t\tif(self.currentSrc === src)\n\t\t\t\tself.play();\n\t\t\telse self.prepare(this.list[index].stream, function(){\n\t\t\t\tself.play();\n\t\t\t});\n\t\t},\n\n\t\tshuffle(set){\n\t\t\tif(set === true){\n\t\t\t    var j, x, i;\n\t\t\t    for (i = this.list.length - 1; i > 0; i--) {\n\t\t\t        j = Math.floor(Math.random() * (i + 1));\n\t\t\t        x = this.list[i];\n\t\t\t        this.list[i] = this.list[j];\n\t\t\t        this.list[j] = x;\n\t\t\t    }\n\t\t\t}\n\t\t\telse this.list = this.original.slice(0);\n\n\t\t\tthis.shuffled = set;\n\t\t}\n\t};\n}","// options = mediaDevices.getUserMedia({thisData})\n// latency = 0ms is not possible (minimum is 70ms, or depend on computer performance)\nvar ScarletsMediaPresenter = function(options, latency){\n\tvar scope = this;\n\tif(!latency) latency = 1000;\n\n\t// The options are optional\n\t//var options = {\n\t//    mediaStream: new MediaStream(), // For custom media stream\n\t//    element: document.querySelector(...), // Record <audio>, <video>, <canvas>\n\t//    screen: true, // Recording the screen\n\t//\n\t//    audio:{\n\t//        channelCount:1,\n\t//        echoCancellation: false\n\t//    },\n\t//    video:{\n\t//        frameRate:15,\n\t//        width: 1280,\n\t//        height: 720,\n\t//        facingMode: (front ? \"user\" : \"environment\")\n\t//    }\n\t//};\n\n\tscope.debug = false;\n\tscope.mediaStream = false;\n\n\tscope.onRecordingReady = null;\n\tscope.onBufferProcess = null;\n\tscope.onStop = null;\n\n\tscope.mediaRecorder = null;\n\tscope.recordingReady = false;\n\n\tscope.recording = false;\n\tscope.mediaGranted = false;\n\n\tif(options === void 0)\n\t\toptions = {};\n\n\tif(options.element !== void 0)\n\t\toptions.mediaStream = options.element.captureStream();\n\n\tscope.debug = options.debug;\n\n\t// Deprecated\n\tscope.options = options;\n\n\tvar mediaType = options.video ? 'video' : 'audio';\n\n\t// Check supported mimeType and codecs for the recorder\n\tif (options.mimeType && !MediaRecorder.isTypeSupported(options.mimeType)) {\n\t\tconsole.log(\"MediaRecorder doesn't supports mimetype \" + options.mimeType);\n\t\toptions.mimeType = null;\n\t}\n\n\tif(!options.mimeType){\n\t\tvar supportedMimeType = false;\n\t\tvar codecsList = mediaType === 'audio' ? audioCodecs : videoCodecs;\n\n\t\tfor(var format in codecsList){\n\t\t\tvar mimeType = mediaType+'/'+format;\n\t\t\tvar codecs = codecsList[format];\n\n\t\t\tfor (var i = 0; i < codecs.length; i++) {\n\t\t\t\tvar temp = mimeType+';codecs='+codecs[i];\n\t\t\t\tif(MediaRecorder.isTypeSupported(temp) && MediaSource.isTypeSupported(temp)){\n\t\t\t\t\tsupportedMimeType = temp;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(supportedMimeType === false && MediaRecorder.isTypeSupported(mimeType) && MediaSource.isTypeSupported(mimeType))\n\t\t\t\tsupportedMimeType = mimeType;\n\n\t\t\tif(supportedMimeType !== false)\n\t\t\t\tbreak;\n\t\t}\n\t\toptions.mimeType = supportedMimeType;\n\n\t\tif (scope.debug) console.log(\"mimeType: \"+supportedMimeType);\n\t}\n\n\tvar mediaGranted = function(mediaStream) {\n\t\tscope.mediaGranted = true;\n\n\t\t// For adding effect later (if audio available)\n\t\tif(options.audio !== void 0){\n\t\t\tscope.source = ScarletsMedia.audioContext.createMediaStreamSource(mediaStream);\n\t\t\tscope.mediaStream = mediaStream = scope.destination.stream;\n\n\t\t\tif(pendingConnect.length !== 0){\n\t\t\t\tfor (var i = 0; i < pendingConnect.length; i++)\n\t\t\t\t\tscope.source.connect(pendingConnect[i]);\n\n\t\t\t\tfirstSourceConnect = false;\n\t\t\t\tpendingConnect.length = 0;\n\t\t\t}\n\t\t\telse scope.source.connect(scope.destination);\n\t\t}\n\n\t\tscope.bufferHeader = null;\n\t\tvar bufferHeaderLength = false;\n\n\t\tscope.mediaRecorder = new MediaRecorder(mediaStream, options);\n\n\t\tif(scope.debug) console.log(\"MediaRecorder obtained\");\n\t\tscope.mediaRecorder.onstart = function(e) {\n\t\t\tscope.recording = true;\n\t\t};\n\n\t\tconst isVideo = options.video !== void 0;\n\t\tconst headerLatency = isVideo ? 565 : 100;\n\n\t\tscope.mediaRecorder.ondataavailable = function(e){\n\t\t\t// Stream segments after the header was obtained\n\t\t\tif (bufferHeaderLength !== false){\n\t\t\t\tvar streamingTime = Number(String(Date.now()).slice(-5, -3));\n\t\t\t\tscope.onBufferProcess([e.data, streamingTime]);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Return if the recording was stopped\n\t\t\tif(scope.mediaRecorder.state !== 'recording')\n\t\t\t\treturn;\n\n\t\t\tif(e.data.size <= 1) return;\n\n\t\t\t// The audio buffer can contain some duration that causes a noise\n\t\t\t// So we will need to remove it on streamer side\n\t\t\t// Because the AudioBuffer can't be converted to ArrayBuffer with WebAudioAPI\n\t\t\tscope.bufferHeader = e.data;\n\n\t\t\tvar predefinedBuffer = getBufferHeader(scope.mediaRecorder.mimeType);\n\t\t\tif(predefinedBuffer !== false)\n\t\t\t\tscope.bufferHeader = predefinedBuffer;\n\n\t\t\tbufferHeaderLength = scope.bufferHeader.size;\n\n\t\t\tif(bufferHeaderLength > 900 || bufferHeaderLength < 100)\n\t\t\t\tconsole.log('%c[WARN] The buffer header length was more than 0.9KB or smaller than 0.1KB. This sometime cause decode error on streamer side. Try to avoid any heavy CPU usage when using the recorder.', \"color:yellow\");\n\n\t\t\tif(scope.onRecordingReady)\n\t\t\t\tscope.onRecordingReady({\n\t\t\t\t\tmimeType:options.mimeType,\n\t\t\t\t\tstartTime:Date.now(),\n\t\t\t\t\thasVideo:isVideo,\n\t\t\t\t\tdata:scope.bufferHeader\n\t\t\t\t});\n\n\t\t\tscope.recordingReady = true;\n\n\t\t\tif(latency === headerLatency) return;\n\n\t\t\t// Record with the custom latency\n\t\t\tscope.mediaRecorder.stop();\n\t\t\tsetTimeout(function(){\n\t\t\t\tscope.mediaRecorder.start(latency);\n\t\t\t}, 10);\n\t\t};\n\n\t\t// Get first header\n\t\tscope.mediaRecorder.start(headerLatency);\n\t}\n\n\tvar pendingConnect = [];\n\n\tscope.source = void 0;\n\tscope.destination = ScarletsMedia.audioContext.createMediaStreamDestination();\n\n\tvar firstSourceConnect = true;\n\tscope.connect = function(node){\n\t\tif(scope.source === void 0){\n\t\t\tpendingConnect.push(node);\n\t\t\treturn;\n\t\t}\n\n\t\tif(firstSourceConnect){\n\t\t\ttry{\n\t\t\t\tscope.source.disconnect(scope.destination);\n\t\t\t}catch(e){}\n\n\t\t\tfirstSourceConnect = false;\n\t\t}\n\n\t\tscope.source.connect(node);\n\t}\n\n\tscope.disconnect = function(node){\n\t\tif(scope.source)\n\t\t\tscope.source.disconnect(node);\n\t\telse{\n\t\t\tvar i = pendingConnect.indexOf(node);\n\t\t\tif(i === -1)\n\t\t\t\treturn;\n\n\t\t\tpendingConnect.splice(i, 1);\n\t\t}\n\t}\n\n\tfunction reAddTracks(mediaStream) {\n\t\tvar streams = mediaStream.getTracks();\n\t\tfor(var i = 0; i < streams.length; i++)\n\t\t\tscope.mediaRecorder.stream.addTrack(streams[i]);\n\n\t\tscope.mediaRecorder.start(latency);\n\t\tscope.recording = true;\n\t}\n\n\tvar afterStop = false;\n\tscope.startRecording = function(){\n\t\tif(afterStop){\n\t\t\tafterStop = false;\n\n\t\t\tif(!options.mediaStream){ // Not custom\n\t\t\t\tif(!scope.options.screen) // Camera / Audio\n\t\t\t\t\tnavigator.mediaDevices.getUserMedia(options).then(reAddTracks).catch(console.error);\n\t\t\t\telse // Screen\n\t\t\t\t\tnavigator.mediaDevices.getDisplayMedia(options).then(reAddTracks).catch(console.error);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\telse if(scope.mediaGranted === false || scope.mediaRecorder === null){\n\t\t\tscope.recordingReady = false;\n\n\t\t\tif(options.mediaStream) // Custom\n\t\t\t\tmediaGranted(options.mediaStream);\n\t\t\telse if(!scope.options.screen) // Camera / Audio\n\t\t\t\tnavigator.mediaDevices.getUserMedia(options).then(mediaGranted).catch(console.error);\n\t\t\telse // Screen\n\t\t\t\tnavigator.mediaDevices.getDisplayMedia(options).then(mediaGranted).catch(console.error);\n\n\t\t\treturn false;\n\t\t}\n\n\t\tif(scope.mediaRecorder.state !== 'recording'){\n\t\t\tscope.mediaRecorder.start(latency);\n\t\t\tscope.recording = true;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tscope.stopRecording = function(){\n\t\tif (!scope.recording ||!scope.mediaRecorder) {\n\t\t\treturn;\n\t\t}\n\t\tscope.recording = false;\n\t\tscope.mediaRecorder.stop();\n\n\t\tif(!options.mediaStream){\n\t\t\t// Turn off stream from microphone/camera\n\t\t\tvar streams = scope.mediaRecorder.stream.getTracks();\n\t\t\tfor(var i = 0; i < streams.length; i++){\n\t\t\t\tstreams[i].stop();\n\t\t\t\tscope.mediaRecorder.stream.removeTrack(streams[i]);\n\t\t\t}\n\t\t}\n\n\t\t// scope.mediaRecorder.ondataavailable = null;\n\t\t// scope.mediaRecorder.onstart = null;\n\n\t\tscope.bufferHeader = null;\n\n\t\tafterStop = true;\n\n\t\tif (scope.onStop) scope.onStop();\n\t};\n}\n\nScarletsMediaPresenter.isTypeSupported = function(mimeType){\n\tif(!MediaSource.isTypeSupported(mimeType))\n\t\treturn \"MediaSource is not supporting this type\";\n\tif(!MediaRecorder.isTypeSupported(mimeType))\n\t\treturn \"MediaRecorder is not supporting this type\";\n\treturn \"Maybe supported\";\n}\n","ScarletsMediaEffect.chorus = function(sourceNode){\n\tvar context = ScarletsMedia.audioContext;\n\tvar output = context.createGain();\n\tvar input = sourceNode === undefined ? context.createGain() : null;\n\tif(input) sourceNode = input;\n\n\tvar dry = context.createGain();\n    var wet = context.createGain();\n    var splitter = context.createChannelSplitter(2);\n    var merger = context.createChannelMerger(2);\n    sourceNode.connect(splitter);\n    sourceNode.connect(dry);\n\n    var channel = [{/* left */}, {/* right */}];\n\n    for (var i = 0; i < channel.length; i++) {\n    \tvar c = channel[i];\n\n    \t// Declaration\n    \tc.stream = context.createGain();\n    \tc.delayVibrato = context.createDelay();\n    \tc.delayFixed = context.createDelay();\n    \tc.feedback = context.createGain();\n    \tc.feedforward = context.createGain();\n    \tc.blend = context.createGain();\n\n    \t// Connection\n\t    splitter.connect(c.stream, i, 0);\n\t    c.stream.connect(c.delayVibrato);\n\t    c.stream.connect(c.delayFixed);\n\t    c.delayVibrato.connect(c.feedforward);\n\t    c.delayVibrato.connect(merger, 0, i);\n\t    c.delayFixed.connect(c.feedback);\n\t    c.feedback.connect(c.stream);\n\t    c.blend.connect(merger, 0, i);\n    }\n\n    // Output\n    merger.connect(wet);\n    dry.connect(output);\n    wet.connect(output);\n\n    // LFO modulation\n    var lfo = context.createOscillator();\n    var LDepth = context.createGain();\n    var RDepth = context.createGain();\n    lfo.connect(LDepth);\n    lfo.connect(RDepth);\n    LDepth.connect(channel[0].delayVibrato.delayTime);\n    RDepth.connect(channel[1].delayVibrato.delayTime);\n    lfo.start(0);\n\n    // Settings\n    lfo.type = 'sine';\n    lfo.frequency.value = 0.15;\n    LDepth.gain.value = 0.013;\n    RDepth.gain.value = -0.017;\n    channel[0].delayFixed.delayTime.value = 0.005;\n    channel[1].delayFixed.delayTime.value = 0.007;\n    channel[0].delayVibrato.delayTime.value = 0.013;\n    channel[1].delayVibrato.delayTime.value = 0.017;\n\n    var options = {rate:0, intensity:0, mix:0};\n\n\tvar ret =  {\n\t\t// Connect to output\n\t\t// output.connect(context.destination);\n\t\toutput:output,\n\t\tinput:input,\n\n\t\trate: function (value) { // value: 0 ~ 1\n\t\t\tif(value === undefined) return options.rate;\n\t\t\toptions.rate = value;\n\n\t    \tvalue = value * 0.29 + 0.01;\n\t    \tlfo.frequency.value = value;\n\t    },\n\n\t    intensity: function (value) { // value: 0 ~ 1\n\t\t\tif(value === undefined) return options.intensity;\n\t\t\toptions.intensity = value;\n\n\t    \tvar blend = 1.0 - (value * 0.2929);\n\t    \tvar feedforward = value * 0.2929 + 0.7071;\n\t    \tvar feedback = value * 0.7071;\n\n\t    \tfor (var i = 0; i < channel.length; i++) {\n\t\t    \tchannel[i].blend.gain.value = blend;\n\t\t    \tchannel[i].feedforward.gain.value = feedforward;\n\t\t    \tchannel[i].feedback.gain.value = feedback;\n\t    \t}\n\t    },\n\n\t    mix: function (value) {\n\t\t\tif(value === undefined) return options.mix;\n\t\t\toptions.mix = value;\n\t\t\t\n\t    \tdry.gain.value = value;\n\t    },\n\n\t\t// This should be executed to clean memory\n\t\tdestroy:function(){\n\t\t\tif(input) input.disconnect();\n\t\t\toutput.disconnect();\n\t\t\tlfo.stop(0);\n\t\t\tlfo.disconnect();\n\t\t\t\n\t    \tfor (var i = 0; i < channel.length; i++) {\n\t\t    \tchannel[i].stream.disconnect();\n\t    \t}\n\t\t\tfor(var key in this){\n\t\t\t\tdelete this[key];\n\t\t\t}\n\t\t\toutput = null;\n\t\t}\n\t};\n\n\t// Initial settings\n    ret.rate(0.5);\n    ret.intensity(0.0);\n    ret.mix(0.75);\n\n\treturn ret;\n};","ScarletsMediaEffect.conReverb = function(sourceNode){\n\tvar context = ScarletsMedia.audioContext;\n\tvar output = context.createGain();\n\tvar input = sourceNode === undefined ? context.createGain() : null;\n\tif(input) sourceNode = input;\n\n    var reverbNode = context.createConvolver();\n\tvar wetGainNode = context.createGain();\n\tvar dryGainNode = context.createGain();\n\n\tsourceNode.connect(dryGainNode);\n\tsourceNode.connect(reverbNode);\n\n    reverbNode.connect(wetGainNode);\n    dryGainNode.connect(output);\n    wetGainNode.connect(output);\n\n    function setBuffer(buffer){\n    \tif(reverbNode.buffer !== null){\n    \t\treverbNode.disconnect();\n    \t\treverbNode = context.createConvolver();\n\n\t\t\tsourceNode.connect(reverbNode);\n\t\t    reverbNode.connect(wetGainNode);\n    \t}\n    \treverbNode.buffer = buffer;\n    }\n\n\treturn {\n\t\t// Connect to output\n\t\t// output.connect(context.destination);\n\t\toutput:output,\n\t\tinput:input,\n\n\t\t// This must be set\n\t\tsetBuffer:setBuffer,\n\n\t\t// Load audio buffer from url\n\t\tloadBuffer:function(url){\n\t\t\tvar ajaxRequest = new XMLHttpRequest();\n\t\t\tajaxRequest.open('GET', url, true);\n\t\t\tajaxRequest.responseType = 'arraybuffer';\n\n\t\t\tajaxRequest.onload = function(){\n\t\t\t  var audioData = ajaxRequest.response;\n\t\t\t  context.decodeAudioData(audioData, function(buffer) {\n\t\t\t      setBuffer(buffer);\n\t\t\t  }, function(e){\"Error with decoding audio data\" + e.err});\n\t\t\t}\n\n\t\t\tajaxRequest.send();\n\t\t},\n\n\t\tmix: function(value){ // value: 0 ~ 1\n\t\t\tif(value === undefined) return wetGainNode.gain.value;\n\t\t\tdryGainNode.gain.value = 1 - value;\n\t\t\twetGainNode.gain.value = value;\n\t\t},\n\n\t\t// This should be executed to clean memory\n\t\tdestroy:function(){\n\t\t\tif(input) input.disconnect();\n\t\t\tdryGainNode.disconnect();\n\t\t\toutput.disconnect();\n\t\t\treverbNode.disconnect();\n\t\t\t\n\t\t\tfor(var key in this){\n\t\t\t\tdelete this[key];\n\t\t\t}\n\t\t\toutput = null;\n\t\t}\n\t};\n};","ScarletsMediaEffect.cutOff = function(passType, sourceNode){ // passType: 'lowpass' | 'bandpass' | 'highpass'\n\tvar context = ScarletsMedia.audioContext;\n\tvar output = context.createGain();\n\tvar input = sourceNode === undefined ? context.createGain() : null;\n\tif(input) sourceNode = input;\n\n\tvar filterNode = context.createBiquadFilter();\n\tfilterNode.type = passType || 'lowpass';\n\tfilterNode.frequency.value = 350;\n\tfilterNode.Q.value = 1;\n\tfilterNode.connect(output);\n\tsourceNode.connect(filterNode);\n\t\n\treturn {\n\t\t// Connect to output\n\t\t// output.connect(context.destination);\n\t\toutput:output,\n\t\tinput:input,\n\t\t\n\t\ttype: function(value){\n\t\t\tif(value === undefined)\n\t\t\t\treturn filterNode.type;\n\t\t\tfilterNode.type = value;\n\t\t},\n\t\tfrequency: function(value){\n\t\t\tif(value === undefined)\n\t\t\t\treturn filterNode.frequency.value;\n\t\t\tfilterNode.frequency.value = value;\n\t\t},\n\t\twidth: function(value){\n\t\t\tif(value === undefined)\n\t\t\t\treturn filterNode.Q.value;\n\t\t\tfilterNode.Q.value = value;\n\t\t},\n\n\t\t// This should be executed to clean memory\n\t\tdestroy:function(){\n\t\t\tif(input) input.disconnect();\n\t\t\tfilterNode.disconnect();\n\t\t\toutput.disconnect();\n\t\t\t\n\t\t\tfor(var key in this){\n\t\t\t\tdelete this[key];\n\t\t\t}\n\t\t\toutput = null;\n\t\t}\n\t};\n};","ScarletsMediaEffect.delay = function(sourceNode){\n\tvar context = ScarletsMedia.audioContext;\n\tvar output = context.createGain();\n\tvar input = sourceNode === undefined ? context.createGain() : null;\n\tif(input) sourceNode = input;\n\n\tvar dryGainNode = context.createGain();\n\tvar wetGainNode = context.createGain();\n\tvar feedbackGainNode = context.createGain();\n\tvar delayNode = context.createDelay();\n\n\tsourceNode.connect(dryGainNode);\n\tdryGainNode.connect(output);\n\n\tdelayNode.connect(feedbackGainNode);\n\tfeedbackGainNode.connect(delayNode);\n\n\tsourceNode.connect(delayNode);\n\tdelayNode.connect(wetGainNode);\n\t\n\twetGainNode.connect(output);\n\t\n\tvar ret = {\n\t\t// Connect to output\n\t\t// output.connect(context.destination);\n\t\toutput:output,\n\t\tinput:input,\n\n\t\tmix:function(value){ // value: 0 ~ 1\n\t\t\tif(value === undefined) return wetGainNode.gain.value;\n\t\t\tdryGainNode.gain.value = 1 - value;\n\t\t\twetGainNode.gain.value = value;\n\t\t},\n\t\ttime:function(value){ // value: 0 ~ 180\n\t\t\tif(value === undefined) return delayNode.delayTime.value;\n\t\t\tdelayNode.delayTime.value = value;\n\t\t},\n\t\tfeedback:function(value){ // value: 0 ~ 1\n\t\t\tif(value === undefined) return feedbackGainNode.gain.value;\n\t\t\tfeedbackGainNode.gain.value = value;\n\t\t},\n\n\t\t// This should be executed to clean memory\n\t\tdestroy:function(){\n\t\t\tif(input) input.disconnect();\n\t\t\toutput.disconnect();\n\t\t\tdryGainNode.disconnect();\n\t\t\twetGainNode.disconnect();\n\t\t\tfeedbackGainNode.disconnect();\n\t\t\tdelayNode.disconnect();\n\t\t\t\n\t\t\tfor(var key in this){\n\t\t\t\tdelete this[key];\n\t\t\t}\n\t\t\toutput = null;\n\t\t}\n\t};\n\n\tret.mix(0.5);\n\tret.time(0.3);\n\tret.feedback(0.5);\n\n\treturn ret;\n};","ScarletsMediaEffect.distortion = function(sourceNode){\n\tvar context = ScarletsMedia.audioContext;\n\tvar output = context.createGain();\n\tvar input = sourceNode === undefined ? context.createGain() : null;\n\tif(input) sourceNode = input;\n\tvar deg = 57 * Math.PI / 180;\n\n\tvar waveShaperNode = context.createWaveShaper();\n\twaveShaperNode.connect(output);\n\tsourceNode.connect(waveShaperNode);\n\n\tvar options = {\n\t\tamount:0\n\t};\n\treturn {\n\t\tset:function(amount){ // amount: 0 ~ 1\n\t\t\tif(amount === undefined) return options.amount;\n\t\t\toptions.amount = amount;\n\t\t\t\n\t\t\tamount = amount * 10;\n\t\t    var curve = new Float32Array(context.sampleRate);\n\t\t    var temp = 2 / context.sampleRate;\n\n\t\t    for (var i = 0 ; i < context.sampleRate; i++) {\n\t\t    \tvar x = i * temp - 1;\n\n\t\t    \t// http://kevincennis.github.io/transfergraph/\n\t\t    \tcurve[i] = (3 + amount) * x * deg / (Math.PI + amount * Math.abs(x));\n\t\t    }\n\n\t\t    waveShaperNode.curve = curve;\n\t\t},\n\n\t\t// Connect to output\n\t\t// output.connect(context.destination);\n\t\toutput:output,\n\t\tinput:input,\n\n\t\t// This should be executed to clean memory\n\t\tdestroy:function(){\n\t\t\tif(input) input.disconnect();\n\t\t\twaveShaperNode.disconnect();\n\t\t\toutput.disconnect();\n\n\t\t\twaveShaperNode = output = null;\n\t\t\tfor(var key in this){\n\t\t\t\tdelete this[key];\n\t\t\t}\n\t\t}\n\t};\n};","ScarletsMediaEffect.dubDelay = function(sourceNode){\n\tvar context = ScarletsMedia.audioContext;\n\tvar output = context.createGain();\n\tvar input = sourceNode === undefined ? context.createGain() : null;\n\tif(input) sourceNode = input;\n\n\tvar dryGainNode = context.createGain();\n\tvar wetGainNode = context.createGain();\n\tvar feedbackGainNode = context.createGain();\n\tvar delayNode = context.createDelay();\n\tvar bqFilterNode = context.createBiquadFilter(); \n\n\tsourceNode.connect(dryGainNode);\n\tdryGainNode.connect(output);\n\n\tsourceNode.connect(wetGainNode);\n\tsourceNode.connect(feedbackGainNode);\n\n\tfeedbackGainNode.connect(bqFilterNode);\n\tbqFilterNode.connect(delayNode);\n\tdelayNode.connect(feedbackGainNode);\n\tdelayNode.connect(wetGainNode);\n\n\twetGainNode.connect(output);\n\t\n\tvar ret = {\n\t\t// Connect to output\n\t\t// output.connect(context.destination);\n\t\toutput:output,\n\t\tinput:input,\n\t\t\n\t\tmix:function(value){ // value: 0 ~ 1\n\t\t\tif(value === undefined) return wetGainNode.gain.value;\n\t\t\tdryGainNode.gain.value = 1 - value;\n\t\t\twetGainNode.gain.value = value;\n\t\t},\n\t\ttime:function(value){ // value: 0 ~ 180\n\t\t\tif(value === undefined) return delayNode.delayTime.value;\n\t\t\tdelayNode.delayTime.value = value;\n\t\t},\n\t\tfeedback:function(value){ // value: 0 ~ 1\n\t\t\tif(value === undefined) return feedbackGainNode.gain.value;\n\t\t\tfeedbackGainNode.gain.value = value;\n\t\t},\n\t\tcutoff:function(value){ // value: 0 ~ 4000\n\t\t\tif(value === undefined) return bqFilterNode.frequency.value;\n\t\t\tbqFilterNode.frequency.value = value;\n\t\t},\n\n\t\t// This should be executed to clean memory\n\t\tdestroy:function(){\n\t\t\tif(input) input.disconnect();\n\t\t\toutput.disconnect();\n\t\t\tdryGainNode.disconnect();\n\t\t\twetGainNode.disconnect();\n\t\t\tfeedbackGainNode.disconnect();\n\n\t\t\tfor(var key in this){\n\t\t\t\tdelete this[key];\n\t\t\t}\n\t\t\toutput = null;\n\t\t}\n\t};\n\n\tret.mix(0.5);\n\tret.time(0.7);\n\tret.feedback(0.6);\n\tret.cutoff(700);\n\n\treturn ret;\n};","ScarletsMediaEffect.equalizer = function(frequencies, sourceNode){\n\tvar freq = frequencies || [32, 64, 125, 250, 500, 1000, 2000, 4000, 8000, 16000];\n\tvar context = ScarletsMedia.audioContext;\n\t\n\tvar output = context.createGain(); // Combine all effect\n\tvar input = sourceNode === undefined ? context.createGain() : null;\n\tif(input) sourceNode = input;\n\n\tvar equalizer = {};\n\tvar lastIndex = freq.length - 1;\n\n\tfor (var i = 0; i < freq.length; i++) {\n        var filter = context.createBiquadFilter(); // Frequency pass\n\t\tfilter.gain.value = 0;\n        filter.frequency.value = freq[i];\n\n        if(i === 0) filter.type = 'lowshelf';\n        else if(i === lastIndex) filter.type = 'highshelf';\n        else filter.type = 'peaking';\n\n\t\tif(i !== 0)\n\t    \tequalizer[freq[i - 1]].connect(filter);\n        equalizer[freq[i]] = filter;\n\t}\n\n\tsourceNode.connect(equalizer[freq[0]]);\n\tfilter.connect(output);\n\n\treturn {\n\t\t// Connect to output\n\t\t// output.connect(context.destination);\n\t\toutput:output,\n\t\tinput:input,\n\t\t\n\t\tfrequency:function(frequency, dB){ // value: -20 ~ 20\n\t\t\tif(dB === undefined) return equalizer[frequency].gain.value;\n\t\t\tequalizer[frequency].gain.value = dB;\n\t\t},\n\n\t\t// This should be executed to clean memory\n\t\tdestroy:function(){\n\t\t\tfor (var i = 0; i < freq.length; i++) {\n\t    \t\tequalizer[freq[i]].disconnect(); // filter\n\t\t\t}\n\t\t\tequalizer.splice(0);\n\n\t\t\tif(input) input.disconnect();\n\t\t\toutput.disconnect();\n\t\t\t\n\t\t\tfor(var key in this){\n\t\t\t\tdelete this[key];\n\t\t\t}\n\t\t\tequalizer = output = null;\n\t\t}\n\t};\n};","ScarletsMediaEffect.fade = function(sourceNode){\n\tvar context = ScarletsMedia.audioContext;\n\tvar output = context.createGain();\n\tvar input = sourceNode === undefined ? context.createGain() : null;\n\tif(input) sourceNode = input;\n\n\toutput.gain.value = 1;\n\tsourceNode.connect(output);\n\t\n\treturn {\n\t\t// Connect to output\n\t\t// output.connect(context.destination);\n\t\toutput:output,\n\t\tinput:input,\n\n\t\tin:function(value, time, callback){ // value: 0~1, time: in seconds\n\t\t\toutput.gain.cancelScheduledValues(context.currentTime);\n\n\t\t\tvar remainingTime = (1 - output.gain.value) * value;\n\t\t\toutput.gain.setTargetAtTime(1.0, context.currentTime, remainingTime * time);\n\n\t\t\tif(callback) setTimeout(callback, time * 1000);\n\t\t},\n\t\tout:function(value, time, callback){ // value: 0~1, time: in seconds\n\t\t\toutput.gain.cancelScheduledValues(context.currentTime);\n\n\t\t\tvar remainingTime = output.gain.value * value;\n\t\t\toutput.gain.setTargetAtTime(0.00001, context.currentTime, remainingTime / time);\n\n\t\t\tif(callback) setTimeout(callback, time * 1000);\n\t\t},\n\n\t\t// This should be executed to clean memory\n\t\tdestroy:function(){\n\t\t\tif(input) input.disconnect();\n\t\t\toutput.disconnect();\n\t\t\t\n\t\t\tfor(var key in this){\n\t\t\t\tdelete this[key];\n\t\t\t}\n\t\t\toutput = null;\n\t\t}\n\t};\n};","ScarletsMediaEffect.flanger = function(sourceNode){\n\tvar context = ScarletsMedia.audioContext;\n\tvar output = context.createGain();\n\tvar input = sourceNode === undefined ? context.createGain() : null;\n\tif(input) sourceNode = input;\n\n\tvar inputFeedbackNode = context.createGain();\n\tvar wetGainNode = context.createGain();\n\tvar dryGainNode = context.createGain();\n\tvar delayNode = context.createDelay();\n\tvar oscillatorNode = context.createOscillator();\n\tvar gainNode = context.createGain();\n\tvar feedbackNode = context.createGain();\n\toscillatorNode.type = 'sine';\n\n\tsourceNode.connect(inputFeedbackNode);\n\tsourceNode.connect(dryGainNode);\n\n\tinputFeedbackNode.connect(delayNode);\n\tinputFeedbackNode.connect(wetGainNode);\n\n\tdelayNode.connect(wetGainNode);\n\tdelayNode.connect(feedbackNode);\n\n\tfeedbackNode.connect(inputFeedbackNode);\n\n\toscillatorNode.connect(gainNode);\n\tgainNode.connect(delayNode.delayTime);\n\n\tdryGainNode.connect(output);\n\twetGainNode.connect(output);\n\n\toscillatorNode.start(0);\n\t\n\tvar ret = {\n\t\t// Connect to output\n\t\t// output.connect(context.destination);\n\t\toutput:output,\n\t\tinput:input,\n\n\t\tmix: function(value){ // value: 0 ~ 1\n\t\t\tif(value === undefined) return wetGainNode.gain.value;\n\t\t\tdryGainNode.gain.value = 1 - value;\n\t\t\twetGainNode.gain.value = value;\n\t\t},\n\t\ttime:function(value){ // value: 0 ~ 1\n\t\t\tif(value === undefined) return ScarletsMedia.extra.denormalize(delayNode.delayTime.value, 0.001, 0.02);\n\t\t\tdelayNode.delayTime.value = ScarletsMedia.extra.normalize(value, 0.001, 0.02);\n\t\t},\n\t\tspeed:function(value){ // value: 0 ~ 1\n\t\t\tif(value === undefined) return ScarletsMedia.extra.denormalize(delayNode.delayTime.value, 0.5, 5);\n\t\t\toscillatorNode.frequency.value = ScarletsMedia.extra.normalize(value, 0.5, 5);\n\t\t},\n\t\tdepth:function(value){ // value: 0 ~ 1\n\t\t\tif(value === undefined) return ScarletsMedia.extra.denormalize(delayNode.delayTime.value, 0.0005, 0.005);\n\t\t\tgainNode.gain.value = ScarletsMedia.extra.normalize(value, 0.0005, 0.005);\n\t\t},\n\t\tfeedback:function(value){ // value: 0 ~ 1\n\t\t\tif(value === undefined) return ScarletsMedia.extra.denormalize(delayNode.delayTime.value, 0, 0.8);\n\t\t\tfeedbackNode.gain.value = ScarletsMedia.extra.normalize(value, 0, 0.8);\n\t\t},\n\n\t\t// This should be executed to clean memory\n\t\tdestroy:function(){\n\t\t\tif(input) input.disconnect();\n\t\t\toutput.disconnect();\n\t\t\tinputFeedbackNode.disconnect();\n\t\t\tdryGainNode.disconnect();\n\n\t\t\tfor(var key in this){\n\t\t\t\tdelete this[key];\n\t\t\t}\n\t\t\toutput = null;\n\t\t}\n\t};\n\n\tret.time(0.45);\n\tret.speed(0.2);\n\tret.depth(0.1);\n\tret.feedback(0.1);\n\tret.mix(0.5);\n\n\treturn ret;\n};","ScarletsMediaEffect.harmonizer = function(sourceNode){\n\tvar context = ScarletsMedia.audioContext;\n\tvar output = context.createGain();\n\tvar input = sourceNode === undefined ? context.createGain() : null;\n\tif(input) sourceNode = input;\n  \tvar bands = 8;\n\n\t// Cascading 2 filters for sharp resonance.\n    var filters1 = [];\n    var filters2 = [];\n    var gains = [];\n\n    for (var i = 0; i < bands; i++) {\n      filters1[i] = context.createBiquadFilter();\n      filters1[i].type = 'bandpass';\n      filters2[i] = context.createBiquadFilter();\n      filters2[i].type = 'bandpass';\n      sourceNode.connect(filters1[i]);\n\n      gains[i] = context.createGain();\n      gains[i].connect(output);\n      filters1[i].connect(filters2[i]).connect(gains[i]);\n    }\n\n    output.gain.value = 35.0;\n    var options = {\n    \tpitch:0,\n    \tslope:0,\n    \twidth:0\n    };\n\n\tvar ret = {\n\t\t// Connect to output\n\t\t// output.connect(context.destination);\n\t\toutput:output,\n\t\tinput:input,\n\t\t\n\t\t// Change frequency of filters\n\t    pitch: function (value) {\n\t\t\tif(value === undefined) return options.pitch;\n\t\t\toptions.pitch = value;\n\t\t\t\n\t    \tvar f0 = ScarletsMedia.convert.midiToFreq(value);\n\t    \tfor (var i = 0; i < bands; i++) {\n\t    \t\tfilters1[i].frequency.value = f0;\n\t    \t\tfilters2[i].frequency.value = f0;\n\t    \t}\n\t    },\n\n\t    slope: function (value) {\n\t\t\tif(value === undefined) return options.slope;\n\t\t\toptions.slope = value;\n\t\t\t\n\t    \tfor (var i = 0; i < bands; i++) {\n\t    \t\tgains[i].gain.value = 1.0 + Math.sin(Math.PI + (Math.PI/2 * (value + i / bands)));\n\t    \t}\n\t    },\n\n\t    width: function (value) {\n\t\t\tif(value === undefined) return options.width;\n\t\t\toptions.width = value;\n\t\t\t\n\t    \tfor (var i = 1; i < bands; i++) {\n\t    \t\tvar q = 2 + 90 * Math.pow((1 - i / bands), value);\n\t    \t\tfilters1[i].Q.value = q;\n\t    \t\tfilters2[i].Q.value = q;\n\t    \t}\n\t    },\n\n\t\t// This should be executed to clean memory\n\t\tdestroy:function(){\n\t\t\tif(input) input.disconnect();\n\t\t\toutput.disconnect();\n\n\t\t    for (var i = 0; i < bands; i++) {\n\t\t        filters1[i].disconnect();\n\t\t  \t}\n\n\t\t\tfor(var key in this){\n\t\t\t\tdelete this[key];\n\t\t\t}\n\t\t\toutput = null;\n\t\t}\n\t};\n\n    ret.pitch(34);\n    ret.slope(0.65);\n    ret.width(0.15);\n\n\treturn ret;\n\n\t// sample\n\t// noise x0.25 -> harmonizer -> reverb x0.85\n};","ScarletsMediaEffect.noise = function(sourceNode){\n\tvar context = ScarletsMedia.audioContext;\n\tvar output = context.createGain();\n\tvar input = sourceNode === undefined ? context.createGain() : null;\n\tif(input) sourceNode = input;\n\n\tvar length = Math.floor(context.sampleRate * 9.73);\n\tvar noiseFloat32 = new Float32Array(length);\n\n\tfor (var i = 0; i < length; i++) {\n\t\tnoiseFloat32[i] = Math.sqrt(-2.0 * Math.log(Math.random())) * Math.cos(2.0 * Math.PI * Math.random()) * 0.5;\n\t}\n\n\tvar noiseBuffer = context.createBuffer(2, length, context.sampleRate);\n\tnoiseBuffer.getChannelData(0).set(noiseFloat32, 0);\n\tnoiseBuffer.getChannelData(1).set(noiseFloat32, 0);\n\n    var src = context.createBufferSource();\n    src.to(output);\n    src.loop = true;\n    src.start(0);\n    src.buffer = noiseBuffer;\n    src.loopStart = Math.random() * 9.73;\n\t\n\treturn {\n\t\t// Connect to output\n\t\t// output.connect(context.destination);\n\t\toutput:output,\n\t\tinput:input,\n\n\t\t// This should be executed to clean memory\n\t\tdestroy:function(){\n\t\t\tsrc.loop = false;\n\t\t\tsrc.buffer = null;\n    \t\tsrc.stop(0);\n\t\t\tsrc.disconnect();\n\t\t\tsrc = null;\n\n\t\t\tif(input) input.disconnect();\n\t\t\toutput.disconnect();\n\t\t\t\n\t\t\tfor(var key in this){\n\t\t\t\tdelete this[key];\n\t\t\t}\n\t\t\toutput = null;\n\t\t}\n\t};\n};\n","ScarletsMediaEffect.pingPongDelay = function(sourceNode){\n\tvar context = ScarletsMedia.audioContext;\n\tvar output = context.createGain();\n\tvar input = sourceNode === undefined ? context.createGain() : null;\n\tif(input) sourceNode = input;\n\tvar mix = 0;\n\n\tvar delayNodeLeft = context.createDelay();\n\tvar delayNodeRight = context.createDelay();\n\tvar dryGainNode = context.createGain();\n\tvar wetGainNode = context.createGain();\n\tvar feedbackGainNode = context.createGain();\n\tvar channelMerger = context.createChannelMerger(2);\n\n\tsourceNode.connect(dryGainNode);\n\tdryGainNode.connect(output);\n\n\tdelayNodeLeft.connect(channelMerger, 0, 0);\n\tdelayNodeRight.connect(channelMerger, 0, 1);\n\tdelayNodeLeft.connect(delayNodeRight);\n\n\tfeedbackGainNode.connect(delayNodeLeft);\n\tdelayNodeRight.connect(feedbackGainNode);\n\n\tsourceNode.connect(feedbackGainNode);\n\n\tchannelMerger.connect(wetGainNode);\n\twetGainNode.connect(output);\n\t\n\tvar ret = {\n\t\t// Connect to output\n\t\t// output.connect(context.destination);\n\t\toutput:output,\n\t\tinput:input,\n\n\t\tmix: function(value){ // value: 0 ~ 1\n\t\t\tif(value === undefined) return wetGainNode.gain.value;\n\t\t\tdryGainNode.gain.value = 1 - value;\n\t\t\twetGainNode.gain.value = value;\n\t\t},\n\t\ttime:function(value){ // value: 0 ~ 180\n\t\t\tif(value === undefined) return delayNodeLeft.delayTime.value;\n\t\t\tdelayNodeLeft.delayTime.value = value;\n\t\t\tdelayNodeRight.delayTime.value = value;\n\t\t},\n\t\tfeedback:function(value){ // value: 0 ~ 1\n\t\t\tif(value === undefined) return feedbackGainNode.gain.value;\n\t\t\tfeedbackGainNode.gain.value = value;\n\t\t},\n\n\t\t// This should be executed to clean memory\n\t\tdestroy:function(){\n\t\t\tif(input) input.disconnect();\n\t\t\toutput.disconnect();\n\t\t\tdryGainNode.disconnect();\n\t\t\tfeedbackGainNode.disconnect();\n\t\t\t\n\t\t\tfor(var key in this){\n\t\t\t\tdelete this[key];\n\t\t\t}\n\t\t\toutput = null;\n\t\t}\n\t};\n\n\tret.mix(0.5);\n\tret.time(0.3);\n\tret.feedback(0.5);\n\n\treturn ret;\n};","ScarletsMediaEffect.pitchShift = function(sourceNode){\n    var context = ScarletsMedia.audioContext;\n    var output = context.createGain();\n    var input = sourceNode === undefined ? context.createGain() : null;\n    if(input) sourceNode = input;\n\n    var bufferTime = 0.100;\n    var fadeTime = bufferTime / 2;\n    var bufferRate = bufferTime * context.sampleRate;\n\n    // Delay amount for changing pitch.\n    var modulateGain1 = context.createGain();\n    var modulateGain2 = context.createGain();\n\n    var delayNode1 = context.createDelay();\n    var delayNode2 = context.createDelay();\n    modulateGain1.connect(delayNode1.delayTime);\n    modulateGain2.connect(delayNode2.delayTime);\n\n    sourceNode.connect(delayNode1);\n    sourceNode.connect(delayNode2);\n\n    var fTime = context.currentTime + fadeTime;\n    var bTime = context.currentTime + bufferTime;\n\n    function createPitchBuffer(shiftUp){\n        var buffer = context.createBuffer(1, bufferRate, context.sampleRate);\n        var pitch = buffer.getChannelData(0);\n        \n        // Buffer pitch shift\n        for (var i = 0; i < bufferRate; i++) {\n            if(shiftUp)\n              pitch[i] = (bufferRate - i) / bufferRate;\n            else\n              pitch[i] = i / bufferRate;\n        }\n\n        return buffer;\n    }\n    \n    // Delay modulation.\n    var bufferSource = [0,0,0,0];\n    var bufferGain = [0,0,0,0];\n    for (var i = 0; i < bufferSource.length; i++) {\n        bufferSource[i] = context.createBufferSource();\n        bufferSource[i].loop = true;\n\n        bufferGain[i] = context.createGain();\n\n        if(i < 2)\n            bufferSource[i].buffer = createPitchBuffer(false);\n        else {\n            bufferSource[i].buffer = createPitchBuffer(true);\n            bufferGain[i].gain.value = 0;\n        }\n\n        if(i % 2){ // Odd\n            bufferGain[i].connect(modulateGain2);\n\t    \tbufferSource[i].start(bTime);\n        }\n        else { // Even\n            bufferGain[i].connect(modulateGain1);\n\t    \tbufferSource[i].start(fTime);\n        }\n\n        bufferSource[i].connect(bufferGain[i]);\n    }\n\n    function createPitchFadeBuffer(){\n        var buffer = context.createBuffer(1, bufferRate, context.sampleRate);\n        var pitch = buffer.getChannelData(0);\n            \n        var fadeLength = fadeTime * context.sampleRate;\n        var bufferLeft = bufferRate - fadeLength;\n        \n        // Buffer pitch shift\n        for (var i = 0; i < bufferRate; i++) {\n            if (i < fadeLength)\n                pitch[i] = Math.sqrt(i / fadeLength);\n            else\n                pitch[i] = Math.sqrt(1 - (i - bufferLeft) / fadeLength);\n        }\n\n        return buffer;\n    }\n\n    var fadeBuffer = createPitchFadeBuffer();\n\n    // Delay modulation.\n    var fadeNode = [0,0];\n    var mixNode = [0,0];\n    for (var i = 0; i < fadeNode.length; i++) {\n        fadeNode[i] = context.createBufferSource();\n        fadeNode[i].loop = true;\n        fadeNode[i].buffer = fadeBuffer;\n\n        mixNode[i] = context.createGain();\n    \tmixNode[i].gain.value = 0;\n        fadeNode[i].connect(mixNode[i].gain);\n\n        if(i % 2){ // Odd\n            bufferGain[i].connect(modulateGain2);\n\t    \tfadeNode[i].start(bTime);\n        }\n        else { // Even\n            bufferGain[i].connect(modulateGain1);\n\t    \tfadeNode[i].start(fTime);\n        }\n\n        mixNode[i].connect(output);\n    }\n    \n    delayNode1.connect(mixNode[0]);\n    delayNode2.connect(mixNode[1]);\n\n    function pitchGain(value){\n\t    modulateGain1.gain.value = \n\t    modulateGain2.gain.value = 0.5 * bufferTime * Math.abs(value);\n    }\n\n    var ret = {\n        // Connect to output\n        // output.connect(context.destination);\n        output:output,\n        input:input,\n\n        // pitchNode:[modulateGain1, modulateGain2],\n\n        shift:function(value){ // -3 ~ 3\n            if(value === undefined) return;\n\n            var pitchUp = value > 0;\n\t\t    bufferGain[0].gain.value = \n\t\t    bufferGain[1].gain.value = pitchUp ? 0 : 1;\n\t\t    bufferGain[2].gain.value = \n\t\t    bufferGain[3].gain.value = pitchUp ? 1 : 0;\n\n\t\t    pitchGain(value);\n        },\n\n        // This should be executed to clean memory\n        destroy:function(){\n            if(input) input.disconnect();\n            output.disconnect();\n\n            for (var i = 0; i < fadeNode.length; i++) {\n            \tfadeNode[i].stop();\n            \tfadeNode[i].disconnect();\n            \tmixNode[i].disconnect();\n            }\n\n            for (var i = 0; i < bufferSource.length; i++) {\n            \tbufferSource[i].stop();\n            \tbufferSource[i].disconnect();\n            \tbufferGain[i].disconnect();\n            }\n\n            modulateGain1.disconnect();\n\t\t\tmodulateGain2.disconnect();\n\t\t\tdelayNode1.disconnect();\n\t\t\tdelayNode2.disconnect();\n            \n            for(var key in this){\n                delete this[key];\n            }\n            output = null;\n        }\n    };\n\n    pitchGain(0);\n    return ret;\n}","ScarletsMediaEffect.reverb = function(sourceNode){\n\tvar context = ScarletsMedia.audioContext;\n\t\n\tvar output = context.createGain();\n\tvar input = sourceNode === undefined ? context.createGain() : null;\n\tif(input) sourceNode = input;\n\n\tvar reverbNode = context.createConvolver();\n\tvar wetGainNode = context.createGain();\n\tvar dryGainNode = context.createGain();\n\t\n\tsourceNode.connect(dryGainNode);\n\tdryGainNode.connect(output);\n\twetGainNode.connect(output);\n\n\tvar time = 1,\n\t\tdecay = 0.1,\n\t\treverse = false;\n\n\tfunction rebuildImpulse(){\n\t\tvar length = context.sampleRate * time;\n\t\tvar impulse = context.createBuffer(2, length, context.sampleRate);\n\t\tvar impulseL = impulse.getChannelData(0);\n\t\tvar impulseR = impulse.getChannelData(1);\n\n\t\tfor (var i = 0; i < length; i++) {\n\t\t\tvar n = reverse ? length - i : i;\n\t\t\timpulseL[i] = (Math.random() * 2 - 1) * Math.pow(1 - n / length, decay);\n\t\t\timpulseR[i] = (Math.random() * 2 - 1) * Math.pow(1 - n / length, decay);\n\t\t}\n\n\t    reverbNode.disconnect();\n\n\t    reverbNode = context.createConvolver();\n\t    sourceNode.connect(reverbNode);\n\t    reverbNode.connect(wetGainNode);\n\n\t\treverbNode.buffer = impulse;\n\t}\n\trebuildImpulse();\n\n\treturn {\n\t\t// Connect to output\n\t\t// output.connect(context.destination);\n\t\toutput:output,\n\t\tinput:input,\n\n\t\tmix: function(value){ // value: 0 ~ 1\n\t\t\tif(value === undefined) return wetGainNode.gain.value;\n\t\t\tdryGainNode.gain.value = 1 - value;\n\t\t\twetGainNode.gain.value = value;\n\t\t},\n\n\t\ttime: function(value){ // value: 0 ~ 3\n\t\t\tif(value === undefined) return time;\n\t\t\ttime = value;\n\t\t\trebuildImpulse();\n\t\t},\n\n\t\tdecay: function(value){// value: 0 ~ 3\n\t\t\tif(value === undefined) return decay;\n\t\t\tdecay = value;\n\t\t\trebuildImpulse();\n\t\t},\n\n\t\treverse: function(value){ // value: bool\n\t\t\tif(value === undefined) return reverse;\n\t\t\treverse = value;\n\t\t\trebuildImpulse();\n\t\t},\n\n\t\t// This should be executed to clean memory\n\t\tdestroy:function(){\n\t\t\tif(input) input.disconnect();\n\t\t\tdryGainNode.disconnect();\n\t\t\toutput.disconnect();\n\t\t\treverbNode.disconnect();\n\t\t\t\n\t\t\tfor(var key in this){\n\t\t\t\tdelete this[key];\n\t\t\t}\n\t\t\toutput = null;\n\t\t}\n\t};\n};","ScarletsMediaEffect.stereoPanner = function(sourceNode){\n\tvar context = ScarletsMedia.audioContext;\n\tvar output = context.createGain();\n\tvar input = sourceNode === undefined ? context.createGain() : null;\n\tif(input) sourceNode = input;\n\n\tvar stereoSupport = false;\n\tif(context.createStereoPanner){\n\t\tvar pannerNode = context.createStereoPanner();\n\t\tstereoSupport = true;\n\t}\n\telse {\n\t\tvar pannerNode = context.createPanner();\n\t\tpannerNode.type = 'equalpower';\n\t}\n\n\tsourceNode.connect(pannerNode);\n\tpannerNode.connect(output);\n\tpannerNode.pan.value = 0;\n\n\treturn {\n\t\t// Connect to output\n\t\t// output.connect(context.destination);\n\t\toutput:output,\n\t\tinput:input,\n\n\t\tset:function(pan){ // pan: -1 ~ 1\n\t\t\tif(pan === undefined) return pannerNode.pan.value;\n\t\t\tif(stereoSupport)\n\t\t\t\tpannerNode.pan.value = pan;\n\t\t\telse pannerNode.setPosition(pan, 0, 1 - Math.abs(pan));\n\t\t},\n\n\t\t// This should be executed to clean memory\n\t\tdestroy:function(){\n\t\t\tif(input) input.disconnect();\n\t\t\toutput.disconnect();\n\t\t\tpannerNode.disconnect();\n\t\t\t\n\t\t\tfor(var key in this){\n\t\t\t\tdelete this[key];\n\t\t\t}\n\t\t\toutput = pannerNode = null;\n\t\t}\n\t};\n};","ScarletsMediaEffect.tremolo = function(sourceNode){\n\tvar context = ScarletsMedia.audioContext;\n\tvar output = context.createGain();\n\tvar input = sourceNode === undefined ? context.createGain() : null;\n\tif(input) sourceNode = input;\n\n\tvar dryGainNode = context.createGain();\n\tvar wetGainNode = context.createGain();\n\n\tvar tremoloGainNode = context.createGain();\n\ttremoloGainNode.gain.value = 0;\n\n\tvar shaperNode = context.createWaveShaper();\n\tshaperNode.curve = new Float32Array([0, 1]);\n\tshaperNode.connect(tremoloGainNode.gain);\n\n\tsourceNode.connect(dryGainNode);\n\tdryGainNode.connect(output);\n\n\tvar lfoNode = context.createOscillator();\n\tlfoNode.connect(shaperNode);\n\tlfoNode.type = 'sine';\n\tlfoNode.start(0);\n\n\tsourceNode.connect(tremoloGainNode);\n\ttremoloGainNode.connect(wetGainNode);\n\twetGainNode.connect(output);\n\n\tvar ret = {\n\t\t// Connect to output\n\t\t// output.connect(context.destination);\n\t\toutput:output,\n\t\tinput:input,\n\n\t\tmix: function(value){ // value: 0 ~ 1\n\t\t\tif(value === undefined) return wetGainNode.gain.value;\n\t\t\tdryGainNode.gain.value = 1 - value;\n\t\t\twetGainNode.gain.value = value;\n\t\t},\n\t\tspeed:function(value){\n\t\t\tif(value === undefined) return ScarletsMedia.extra.denormalize(lfoNode.frequency.value, 0, 20);\n\t\t\tlfoNode.frequency.value = ScarletsMedia.extra.normalize(value, 0, 20);\n\t\t},\n\t\tdepth:function(value){\n\t\t\tif(value === undefined) return 1 - this.shaperNode.curve[0];\n\t\t\tshaperNode.curve = new Float32Array([1 - value, 1]);\n\t\t},\n\n\t\t// This should be executed to clean memory\n\t\tdestroy:function(){\n\t\t\tif(input) input.disconnect();\n\t\t\toutput.disconnect();\n\t\t\tdryGainNode.disconnect();\n\t\t\ttremoloGainNode.disconnect();\n\t\t\t\n\t\t\tfor(var key in this){\n\t\t\t\tdelete this[key];\n\t\t\t}\n\t\t\toutput = null;\n\t\t}\n\t};\n\n\tret.speed(0.2);\n\tret.depth(1);\n\tret.mix(0.8);\n\n\treturn ret;\n};","ScarletsMediaEffect.vibrato = function(sourceNode){\n\tvar context = ScarletsMedia.audioContext;\n\tvar output = context.createGain();\n\tvar input = sourceNode === undefined ? context.createGain() : null;\n\tif(input) sourceNode = input;\n\n\tconsole.log(\"Vibrato was not finished yet\");\n\n    var delayNode = context.createDelay();\n\tvar wetGainNode = context.createGain();\n\tvar dryGainNode = context.createGain();\n    var lfoNode = context.createOscillator();\n    //var depthNode = context.createGain();\n\n\tsourceNode.connect(dryGainNode);\n\tdryGainNode.connect(output);\n\twetGainNode.connect(output);\n\n    delayNode.delayTime.value = 1;\n    //depthNode.gain.value = 1;\n    lfoNode.frequency.value = 3;\n    lfoNode.type = 'sine';\n    lfoNode.start(0);\n\n    lfoNode.connect(delayNode.delayTime);\n    //depthNode.connect(delayNode.delayTime);\n    sourceNode.connect(delayNode);\n    delayNode.connect(wetGainNode);\n\n\treturn {\n\t\t// Connect to output\n\t\t// output.connect(context.destination);\n\t\toutput:output,\n\t\tinput:input,\n\t\t\n\t\tmix:function(value){ // value: 0 ~ 1\n\t\t\tif(value === undefined) return wetGainNode.gain.value;\n\t\t\tdryGainNode.gain.value = 1 - value;\n\t\t\twetGainNode.gain.value = value;\n\t\t},\n\t\t\n\t\tdelay:function(value){\n\t\t\tif(value === undefined) return delayNode.delayTime.value;\n\t\t\tdelayNode.delayTime.value = value;\n\t\t},\n\t\t\n\t\tdepth:function(value){\n\t\t\tif(value === undefined) return depthNode.gain.value;\n\t\t\tdepthNode.gain.value = value;\n\t\t},\n\t\t\n\t\tspeed:function(value){\n\t\t\tif(value === undefined) return lfoNode.frequency.value;\n\t\t\tlfoNode.frequency.value = value;\n\t\t},\n\n\t\t// This should be executed to clean memory\n\t\tdestroy:function(){\n\t\t\tif(input) input.disconnect();\n\t\t\toutput.disconnect();\n\n    \t\tsourceNode.disconnect(delayNode);\n    \t\tsourceNode.disconnect(dryGainNode);\n\n\t\t\tlfoNode.stop();\n\t\t\tlfoNode.disconnect();\n\t\t\tdepthNode.disconnect();\n\t\t\t\n\t\t\tfor(var key in this){\n\t\t\t\tdelete this[key];\n\t\t\t}\n\t\t\toutput = null;\n\t\t}\n\t};\n};","// Minimum 3 bufferElement\nvar ScarletsVideoStreamer = function(videoElement, chunksDuration){\n\tif(!chunksDuration) chunksDuration = 1000;\n\tvar chunksSeconds = chunksDuration/1000;\n\n\tvar scope = this;\n\n\tscope.debug = false;\n\tscope.playing = false;\n\tscope.latency = 0;\n\tscope.mimeType = null;\n\n\tscope.audioContext = ScarletsMedia.audioContext;\n\tscope.outputNode = false; // Set this to a connectable Audio Node\n\n\t// If the outputNode is not set, then the audio will be outputted directly\n\tvar directAudioOutput = true;\n\n\tvar mediaBuffer = false;\n\tvar audioNode = scope.audioContext.createMediaElementSource(videoElement);\n\n\tvideoElement.addEventListener('error', function(e){\n\t\tconsole.error(e.target.error);\n\t});\n\n\tscope.audioConnect = function(node){\n\t\tif(directAudioOutput === true){\n\t\t\tdirectAudioOutput = false;\n\t\t\taudioNode.disconnect();\n\t\t}\n\n\t\tscope.outputNode = scope.audioContext.createGain();\n\t\tscope.outputNode.connect(node);\n\t\taudioNode.connect(node);\n\t}\n\n\tscope.audioDisconnect = function(){\n\t\toutputNode.disconnect();\n\t\tdirectAudioOutput = true;\n\n\t\taudioNode.disconnect();\n\t\taudioNode.connect(scope.audioContext.destination);\n\t}\n\n\tscope.stop = function(){\n\t\tmediaBuffer.stop();\n\t\tscope.playing = false;\n\t\tscope.buffering = false;\n\t}\n\n\tscope.setBufferHeader = function(packet){\n\t\tif(!packet || !packet.data)\n\t\t\treturn;\n\n\t\tvar arrayBuffer = packet.data;\n\t\tscope.mimeType = packet.mimeType;\n\n\t\tif(mediaBuffer !== false)\n\t\t\tmediaBuffer.stop();\n\t\telse audioNode.connect(scope.audioContext.destination);\n\n\t\tmediaBuffer = new MediaBuffer(scope.mimeType, chunksDuration, arrayBuffer);\n\n\t\tvideoElement.src = scope.objectURL = mediaBuffer.objectURL;\n\t}\n\n\tscope.playStream = function(){\n\t\tscope.playing = true;\n\t}\n\n\tscope.receiveBuffer = function(packet){\n\t\tif(scope.playing === false || !mediaBuffer.append) return;\n\n\t\tvar arrayBuffer = packet[0];\n\t\tvar streamingTime = packet[1];\n\n\t\tmediaBuffer.append(arrayBuffer);\n\n\t\tif(videoElement.paused)\n\t\t\tvideoElement.play();\n\n\t\tscope.latency = (Number(String(Date.now()).slice(-5, -3)) - streamingTime) + scope.audioContext.baseLatency + chunksSeconds;\n\t\tif(scope.debug) console.log(\"Total latency: \"+scope.latency);\n\t}\n}\n","ScarletsMedia.extra = new function(){\n\tvar self = this;\n\tself.isMobile = function(){\n\t    return /iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(navigator.userAgent);\n\t}\n\n\tself.objectPropertyLinker = function(self, target, property){\n\t\tObject.defineProperty(self, property, {\n\t\t  get: function(){ return target[property]; },\n\t\t  set: function(value){ target[property] = value; },\n\t\t  enumerable: true,\n\t\t  configurable: true\n\t\t});\n\t}\n\n\tself.normalize = function(value, min, max){\n\t\treturn ((max - min) * value) + min;\n\t}\n\n\tself.denormalize = function(value, min, max){\n\t\treturn (value - min) / (max - min);\n\t}\n\n\tvar maxFade = 0;\n\tself.fadeNumber = function(from, to, increment, fadeTime, onIncrease, onFinish){\n\t\tmaxFade = 0;\n\t\tvar current = from;\n\t\tvar interval = fadeTime/(Math.abs(from-to)/Math.abs(increment));\n\t\tif(!interval || interval == Infinity){\n\t\t\tsetTimeout(function(){\n\t\t\t\tif(onIncrease) onIncrease(to);\n\t\t\t\tif(onFinish) onFinish();\n\t\t\t}, fadeTime);\n\t\t\treturn;\n\t\t}\n\n\t\tvar timer = setInterval(function(){\n\t\t\tif(maxFade>=100) clearInterval(timer);\n\t\t\tmaxFade++;\n\n\t\t\tcurrent = (current+increment)*1000;\n\t\t\tcurrent = Math.ceil(current)/1000;\n\n\t\t\t//Increasing and current is more than target\n\t\t\tif((increment >= 0 && (current >= to || from >= to))\n\t\t\t\t||\n\t\t\t//Decreasing and current is lower than target\n\t\t\t(increment <= 0 && (current <= to || from <= to))\n\t\t\t\t||\n\t\t\t//Infinity or Zero number\n\t\t\t(current == Infinity || !current))\n\t\t\t{\n\t\t\t\tclearInterval(timer);\n\t\t\t\tonIncrease(to);\n\t\t\t\tif(onFinish) onFinish();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif(onIncrease) onIncrease(current);\n\t\t}, interval);\n\t}\n\n\t// ===== Precise Timer =====\n\t//\n\tvar timeout = [];\n\tvar timeoutIncrement = 0;\n\tself.preciseTimeout = function(func, miliseconds){\n\t\tvar now = Date.now();\n\t\ttimeoutIncrement++;\n\t\ttimeout.push({\n\t\t\tid:timeoutIncrement,\n\t\t\twhen:now+miliseconds,\n\t\t\tfunc:func,\n\n\t\t\t// When browser loss focus\n\t\t\tfallback:setTimeout(function(){\n\t\t\t\tclearPreciseTimer(timeoutIncrement).func();\n\t\t\t}, miliseconds)\n\t\t});\n\t\tstartPreciseTime();\n\t\treturn timeoutIncrement;\n\t}\n\tself.clearPreciseTimeout = function(id){\n\t\tclearPreciseTimer(id, timeout);\n\t}\n\n\tvar interval = [];\n\tvar intervalIncrement = 0;\n\tself.preciseInterval = function(func, miliseconds){\n\t\tvar now = Date.now();\n\t\tintervalIncrement++;\n\t\tvar temp = {\n\t\t\tid:intervalIncrement,\n\t\t\tinterval:miliseconds,\n\t\t\twhen:now+miliseconds,\n\t\t\tfunc:func\n\t\t};\n\n\t\t// When browser loss focus\n\t\ttemp.fallback = setInterval(function(){\n\t\t\tif(temp.when >= Date.now())\n\t\t\t\treturn; // Avoid multiple call\n\n\t\t\ttemp.when += temp.interval;\n\t\t\ttemp.func();\n\t\t}, miliseconds);\n\n\t\tinterval.push(temp);\n\t\tstartPreciseTime();\n\t\treturn intervalIncrement;\n\t}\n\tself.clearPreciseInterval = function(id){\n\t\tvar temp = clearPreciseTimer(id, interval);\n\t\tclearInterval(temp.fallback);\n\t}\n\n\tfunction clearPreciseTimer(id, list){\n\t\tfor (var i in list) {\n\t\t\tif(list[i].id === id)\n\t\t\t\treturn list.splice(i, 1);\n\t\t}\n\t}\n\n\tvar preciseTimerStarted = false;\n\tfunction startPreciseTime(){\n\t\tif(preciseTimerStarted) return;\n\t\tpreciseTimerStarted = true;\n\n\t\tvar preciseTimer = function(){\n\t\t\tif(timeout.length === 0 && interval.length === 0){\n\t\t\t\tpreciseTimerStarted = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trequestAnimationFrame(preciseTimer);\n\n\t\t\tvar currentTime = Date.now();\n\t\t\tfor (var i in timeout) {\n\t\t\t\tif(timeout[i].when < currentTime){\n\t\t\t\t\ttimeout[i].func();\n\t\t\t\t\tclearTimeout(timeout[i].fallback);\n\t\t\t\t\ttimeout.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (var i in interval) {\n\t\t\t\tif(interval[i].when < currentTime){\n\t\t\t\t\tinterval[i].func();\n\t\t\t\t\tinterval[i].when += interval[i].interval;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\trequestAnimationFrame(preciseTimer);\n\t}\n};\n\nif(moduleMode){\n\tglobal.Media = ScarletsMedia;\n\tglobal.MediaEffect = ScarletsMediaEffect;\n\tglobal.AudioStreamer = ScarletsAudioStreamer;\n\tglobal.VideoStreamer = ScarletsVideoStreamer;\n\tglobal.MediaPlayer = ScarletsMediaPlayer;\n\tglobal.MediaPresenter = ScarletsMediaPresenter;\n\tglobal.MediaBuffer = MediaBuffer;\n}\nelse{\n\tglobal.ScarletsMedia = ScarletsMedia;\n\tglobal.ScarletsMediaEffect = ScarletsMediaEffect;\n\tglobal.ScarletsAudioStreamer = ScarletsAudioStreamer;\n\tglobal.ScarletsVideoStreamer = ScarletsVideoStreamer;\n\tglobal.ScarletsMediaPlayer = ScarletsMediaPlayer;\n\tglobal.ScarletsMediaPresenter = ScarletsMediaPresenter;\n\tglobal.MediaBuffer = MediaBuffer;\n}\n\n// ===== Module End =====\n})));"]}