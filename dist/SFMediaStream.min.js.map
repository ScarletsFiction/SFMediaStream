{"version":3,"sources":["a_init.js","AudioStreamer.js","Convert.js","MediaBuffer.js","MediaPlayer.js","MediaPresenter.js","Plugin/Chorus.js","Plugin/ConReverb.js","Plugin/CutOff.js","Plugin/Delay.js","Plugin/Distortion.js","Plugin/DubDelay.js","Plugin/Equalizer.js","Plugin/Fade.js","Plugin/Flanger.js","Plugin/Harmonizer.js","Plugin/Noise.js","Plugin/PingPongDelay.js","Plugin/PitchShift.js","Plugin/Reverb.js","Plugin/StereoPanner.js","Plugin/Tremolo.js","Plugin/Vibrato.js","VideoStreamer.js","z_extra.js"],"names":["global","factory","exports","_typeof","module","window","this","moduleMode","ScarletsMedia","audioContext","getElementAudioNode","elem","crossOrigin","createMediaElementSource","getElementVideoNode","ScarletsMediaEffect","audioCodecs","webm","mp4","ogg","videoCodecs","3gpp","waitingUnlock","userInteracted","AudioContext","console","error","mobileMediaUnlock","e","emptyBuffer","createBuffer","source","createBufferSource","buffer","connect","destination","onended","disconnect","removeListener","start","noteOn","resume","document","removeEventListener","i","length","addEventListener","ScarletsAudioStreamer","chunksDuration","chunksSeconds","scope","debug","playing","latency","mimeType","bufferElement","outputNode","directAudioOutput","bufferHeader","mediaBuffer","audioElement","Audio","audioNode","node","createGain","stop","buffering","setBufferHeader","packet","data","arrayBuffer","MediaBuffer","Uint8Array","src","objectURL","decodeAudioData","slice","audioBuffer","noiseLength","getChannelData","webAudioBufferInsert","index","temp","frameCount","channelLength","numberOfChannels","newBuffer","sampleRate","set","subarray","cleanNoise","context","playStream","bufferElementIndex","realtimeBufferPlay","log","byteLength","Number","String","Date","now","baseLatency","finalBuffer","addBufferHeader","receiveBuffer","append","paused","play","convert","midiToFreq","midi","Math","pow","floor","freqToMidi","freq","LN2","powerToDb","power","db","LN10","dbToPower","exp","ampToDb","lin","dbToAmp","velToAmp","velocity","MediaSource","URL","createObjectURL","removing","totalTime","sourceBuffer","buffers","startAppending","appendBuffer","onsourceopen","addSourceBuffer","mode","onerror","onupdateend","remove","updating","shift","buffered","push","abort","readyState","endOfStream","ScarletsMediaPlayer","element","self","constructor","createElement","body","appendChild","propertyLinker","audioOutputNode","Object","defineProperty","get","enumerable","tagName","toLowerCase","concat","videoOutputNode","load","canPlayType","extra","objectPropertyLinker","preload","crossorigin","audioFadeEffect","speed","undefined","defaultPlaybackRate","playbackRate","mute","muted","defaultMuted","volume","stillWaiting","successCallback","errorCallback","then","catch","fadeNumber","num","pause","callback","prepare","links","force","querySelectorAll","once","off","insertAdjacentHTML","split","join","eventRegistered","eventTrigger","type","on","eventName","name","splice","indexOf","destroy","key","playlist","list","original","innerHTML","playlistInitialized","internalPlaylistEvent","currentIndex","next","loop","playlistTriggerEvent","shuffled","reload","lists","shuffle","add","obj","autoplay","previous","stream","j","x","random","ScarletsMediaPresenter","options","mediaStream","onRecordingReady","onBufferProcess","mediaRecorder","recordingReady","recording","mediaGranted","polyfill","mediaType","video","supportedMimeType","codecsList","format","codecs","MediaRecorder","isTypeSupported","audio","createMediaStreamSource","pendingConnect","firstSourceConnect","bufferHeaderLength","onstart","ondataavailable","state","size","startTime","streamingTime","createMediaStreamDestination","startRecording","screen","navigator","mediaDevices","getDisplayMedia","getUserMedia","stopRecording","streams","getTracks","removeTrack","chorus","sourceNode","output","input","dry","wet","splitter","createChannelSplitter","merger","createChannelMerger","channel","c","delayVibrato","createDelay","delayFixed","feedback","feedforward","blend","lfo","createOscillator","LDepth","RDepth","delayTime","frequency","value","gain","rate","intensity","mix","ret","conReverb","reverbNode","createConvolver","wetGainNode","dryGainNode","setBuffer","loadBuffer","url","ajaxRequest","XMLHttpRequest","open","responseType","onload","audioData","response","err","send","cutOff","passType","filterNode","createBiquadFilter","Q","width","delay","feedbackGainNode","delayNode","time","distortion","deg","PI","waveShaperNode","createWaveShaper","amount","curve","Float32Array","abs","dubDelay","bqFilterNode","cutoff","equalizer","frequencies","lastIndex","filter","dB","fade","in","cancelScheduledValues","currentTime","remainingTime","setTargetAtTime","setTimeout","out","flanger","inputFeedbackNode","oscillatorNode","gainNode","feedbackNode","denormalize","normalize","depth","harmonizer","filters1","filters2","gains","pitch","slope","f0","sin","q","noise","noiseFloat32","sqrt","cos","noiseBuffer","to","loopStart","pingPongDelay","delayNodeLeft","delayNodeRight","channelMerger","pitchShift","bufferTime","fadeTime","bufferRate","modulateGain1","modulateGain2","delayNode1","delayNode2","fTime","bTime","createPitchBuffer","shiftUp","bufferSource","bufferGain","fadeBuffer","fadeLength","bufferLeft","createPitchFadeBuffer","fadeNode","mixNode","pitchGain","pitchUp","reverb","decay","reverse","rebuildImpulse","impulse","impulseL","impulseR","n","stereoPanner","stereoSupport","createStereoPanner","pannerNode","createPanner","pan","setPosition","tremolo","tremoloGainNode","shaperNode","lfoNode","vibrato","depthNode","ScarletsVideoStreamer","videoElement","audioConnect","audioDisconnect","isMobile","test","userAgent","target","property","configurable","min","max","maxFade","from","increment","onIncrease","onFinish","current","interval","Infinity","timer","setInterval","clearInterval","ceil","timeout","timeoutIncrement","preciseTimeout","func","miliseconds","id","when","fallback","clearPreciseTimer","startPreciseTime","clearPreciseTimeout","intervalIncrement","preciseInterval","clearPreciseInterval","preciseTimerStarted","requestAnimationFrame","preciseTimer","clearTimeout","Media","MediaEffect","AudioStreamer","VideoStreamer","MediaPlayer","MediaPresenter"],"mappings":"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","file":"SFMediaStream.min.js","sourcesContent":["/*\r\n\tScarletsFiction MediaStream Library\r\n\t\r\n\tHTML5 media streamer library for playing music, video, playlist,\r\n\tor even live streaming microphone & camera with node server\r\n\thttps://github.com/ScarletsFiction/SFMediaStream\r\n\t\r\n\tMake sure you include this header on this script\r\n*/\r\n(function(global, factory){\r\n  if(typeof exports === 'object' && typeof module !== 'undefined'){\r\n  \tmodule.exports = {};\r\n  \tfactory(module.exports, window, true);\r\n  }\r\n  else factory(global, window);\r\n}(this || window, (function(global, window, moduleMode){'use strict';\r\n// ===== Module Init =====\r\n\r\n// Initialize global data\r\nvar ScarletsMedia = {\r\n\taudioContext: false, // Created after user gesture\r\n\r\n\t// Get Audio Node from HTML5's audio tag\r\n\tgetElementAudioNode:function(elem){\r\n\t\telem.crossOrigin = 'anonymous';\r\n\t\treturn this.audioContext.createMediaElementSource(elem);\r\n\t},\r\n\r\n\t// videoContext: window.VideoContext ? new VideoContext() : false,\r\n\r\n\t// Still underdevelopment: https://github.com/bbc/VideoContext\r\n\tgetElementVideoNode:function(elem){\r\n\t\telem.crossOrigin = 'anonymous';\r\n\t\treturn null;\r\n\t}\r\n};\r\n\r\nvar ScarletsMediaEffect = {};\r\nvar audioCodecs = {\r\n\twebm:['opus', 'vorbis'],\r\n\tmp4:['mp4a.67', 'mp4a.40.29', 'mp4a.40.5', 'mp4a.40.2', 'mp3'],\r\n\togg:['opus', 'vorbis'], // This may not work on mobile\r\n};\r\nvar videoCodecs = {\r\n\twebm:['vp8,opus', 'vp8,vorbis'],\r\n\tmp4:['mp4v.20.8,mp4a.40.2', 'mp4v.20.240,mp4a.40.2', 'avc1.42E01E,mp4a.40.2', 'avc1.58A01E,mp4a.40.2', 'avc1.64001E,mp4a.40.2'],\r\n\t'3gpp':['mp4v.20.8,samr'],\r\n\togg:['dirac,vorbis', 'theora,vorbis'], // This may not work on mobile\r\n};\r\n\r\nvar waitingUnlock = [];\r\nvar userInteracted = false;\r\n\r\n// Unlock mobile media security\r\n(function(){\r\n\tif(!window.AudioContext) return console.error(\"`AudioContext` was not available\");\r\n\tScarletsMedia.audioContext = new AudioContext();\r\n\r\n\tvar mobileMediaUnlock = function(e){\r\n\t\tvar emptyBuffer = ScarletsMedia.audioContext.createBuffer(1, 1, 22050);\r\n\t\tvar source = ScarletsMedia.audioContext.createBufferSource();\r\n\t\tsource.buffer = emptyBuffer;\r\n\t\tsource.connect(ScarletsMedia.audioContext.destination);\r\n\r\n\t\tsource.onended = function(){\r\n\t\t\tsource.disconnect(0);\r\n\t\t\tsource = emptyBuffer = null;\r\n\r\n\t\t\tremoveListener();\r\n\t\t}\r\n\r\n\t\t// Play the empty buffer.\r\n\t\tif(!source.start) source.noteOn(0);\r\n\t\telse source.start(0);\r\n\t\tScarletsMedia.audioContext.resume();\r\n\t}\r\n\r\n\tfunction removeListener(){\r\n\t\tdocument.removeEventListener('touchstart', mobileMediaUnlock, true);\r\n\t\tdocument.removeEventListener('touchend', mobileMediaUnlock, true);\r\n\t\tdocument.removeEventListener('click', mobileMediaUnlock, true);\r\n\r\n\t\tfor (var i = 0; i < waitingUnlock.length; i++) {\r\n\t\t\twaitingUnlock[i]();\r\n\t\t}\r\n\r\n\t\twaitingUnlock.length = 0;\r\n\t}\r\n\r\n\tdocument.addEventListener('touchstart', mobileMediaUnlock, true);\r\n\tdocument.addEventListener('touchend', mobileMediaUnlock, true);\r\n\tdocument.addEventListener('click', mobileMediaUnlock, true);\r\n})();","// Minimum 3 bufferElement\r\nvar ScarletsAudioStreamer = function(chunksDuration){\r\n\tvar bufferElement = 3;\r\n\r\n\tif(!chunksDuration) chunksDuration = 1000;\r\n\tvar chunksSeconds = chunksDuration/1000;\r\n\r\n\tvar scope = this;\r\n\r\n\tscope.debug = false;\r\n\tscope.playing = false;\r\n\tscope.latency = 0;\r\n\tscope.mimeType = null;\r\n\tscope.bufferElement = [];\r\n\r\n\tscope.audioContext = ScarletsMedia.audioContext;\r\n\tscope.outputNode = false; // Set this to a connectable Audio Node\r\n\r\n\t// If the outputNode is not set, then the audio will be outputted directly\r\n\tvar directAudioOutput = true;\r\n\r\n\tvar bufferHeader = false;\r\n\tvar mediaBuffer = false;\r\n\r\n\tvar audioElement = new Audio();\r\n\tvar audioNode = scope.audioContext.createMediaElementSource(audioElement);\r\n\r\n\tscope.connect = function(node){\r\n\t\tif(directAudioOutput === true){\r\n\t\t\tdirectAudioOutput = false;\r\n\t\t\taudioNode.disconnect();\r\n\t\t}\r\n\r\n\t\tscope.outputNode = scope.audioContext.createGain();\r\n\t\tscope.outputNode.connect(node);\r\n\t\taudioNode.connect(node);\r\n\t}\r\n\r\n\tscope.disconnect = function(node){\r\n\t\tscope.outputNode.disconnect(node);\r\n\t\tdirectAudioOutput = true;\r\n\r\n\t\taudioNode.disconnect(node);\r\n\t\taudioNode.connect(scope.audioContext.destination);\r\n\t}\r\n\r\n\tscope.stop = function(){\r\n\t\tmediaBuffer.stop();\r\n\t\tscope.playing = false;\r\n\t\tscope.buffering = false;\r\n\t}\r\n\r\n\tscope.setBufferHeader = function(packet){\r\n\t\tif(!packet.data){\r\n\t\t\tbufferHeader = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar arrayBuffer = packet.data;\r\n\t\tscope.mimeType = packet.mimeType;\r\n\r\n\t\tif(mediaBuffer !== false)\r\n\t\t\tmediaBuffer.stop();\r\n\t\telse audioNode.connect(scope.audioContext.destination);\r\n\r\n\t\tmediaBuffer = new MediaBuffer(scope.mimeType, chunksDuration, arrayBuffer);\r\n\t\tbufferHeader = new Uint8Array(arrayBuffer);\r\n\r\n\t\taudioElement.src = scope.objectURL = mediaBuffer.objectURL;\r\n\r\n\t\t// Get buffer noise length\r\n\t\tscope.audioContext.decodeAudioData(arrayBuffer.slice(0), function(audioBuffer){\r\n\t\t\t// headerDuration = audioBuffer.duration;\r\n\t\t\tnoiseLength = audioBuffer.getChannelData(0).length;\r\n\t\t});\r\n\t}\r\n\r\n\t// ===== For handling WebAudio =====\r\n\tfunction createBufferSource(){\r\n\t\tvar temp = scope.audioContext.createBufferSource();\r\n\t\ttemp.onended = function(){\r\n\t\t\tthis.stop();\r\n\t\t\tthis.disconnect();\r\n\t\t}\r\n\t\treturn temp;\r\n\t}\r\n\r\n\tvar addBufferHeader = function(arrayBuffer){\r\n\t\tvar finalBuffer = new Uint8Array(bufferHeader.byteLength + arrayBuffer.byteLength);\r\n\t\tfinalBuffer.set(bufferHeader, 0);\r\n\t\tfinalBuffer.set(new Uint8Array(arrayBuffer), bufferHeader.byteLength);\r\n\t\treturn finalBuffer.buffer;\r\n\t}\r\n\r\n\tvar noiseLength = 0;\r\n\tfunction cleanNoise(buffer){\r\n\t\tvar frameCount = buffer.getChannelData(0).length - noiseLength;\r\n\t\tif(frameCount === 0) return false;\r\n\r\n  \t\tvar channelLength = buffer.numberOfChannels;\r\n\t\tvar newBuffer = scope.audioContext.createBuffer(channelLength, frameCount, buffer.sampleRate);\r\n\r\n\t\tfor (var i = 0; i < channelLength; i++) {\r\n\t    \tnewBuffer.getChannelData(i).set(buffer.getChannelData(i).subarray(noiseLength));\r\n\t    }\r\n\r\n\t    return newBuffer;\r\n\t}\r\n\r\n\tfunction webAudioBufferInsert(index, buffer){\r\n\t\tscope.bufferElement[index] = createBufferSource();\r\n\t\tbuffer = cleanNoise(buffer);\r\n\r\n\t\tif(buffer === false) return false;\r\n\t\tscope.bufferElement[index].buffer = buffer;\r\n\r\n\t\tif(scope.outputNode && scope.outputNode.context && directAudioOutput === false)\r\n\t\t\tscope.bufferElement[index].connect(scope.outputNode);\r\n\r\n\t\telse // Direct output to destination\r\n\t\t\tscope.bufferElement[index].connect(scope.audioContext.destination);\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// ===== Realtime Playing =====\r\n\t// Play audio immediately after received\r\n\r\n\tscope.playStream = function(){\r\n\t\tscope.playing = true;\r\n\t}\r\n\r\n\tvar bufferElementIndex = 0;\r\n\tscope.realtimeBufferPlay = function(arrayBuffer){\r\n\t\tif(scope.playing === false) return;\r\n\r\n\t\tif(scope.debug) console.log(\"Receiving data\", arrayBuffer[0].byteLength);\r\n\t\tif(arrayBuffer[0].byteLength === 0) return;\r\n\t\tarrayBuffer = arrayBuffer[0];\r\n\r\n\t\tscope.latency = (Number(String(Date.now()).slice(-5, -3)) - arrayBuffer[1]) + chunksSeconds + scope.audioContext.baseLatency;\r\n\r\n\t\tvar index = bufferElementIndex;\r\n\t\tbufferElementIndex++;\r\n\t\tif(bufferElementIndex > 2)\r\n\t\t\tbufferElementIndex = 0;\r\n\r\n\t\tscope.audioContext.decodeAudioData(addBufferHeader(arrayBuffer), function(buffer){\r\n\t\t\tif(webAudioBufferInsert(index, buffer) === false)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tscope.bufferElement[index].start(0);\r\n\t\t});\r\n\t}\r\n\r\n\t// ====== Synchronous Playing ======\r\n\t// Play next audio when last audio was finished\r\n\r\n\tscope.receiveBuffer = function(arrayBuffer){\r\n\t\tif(scope.playing === false || !mediaBuffer.append) return;\r\n\r\n\t\tmediaBuffer.append(arrayBuffer[0]);\r\n\r\n\t\tif(audioElement.paused)\r\n\t\t\taudioElement.play();\r\n\r\n\t\tscope.latency = (Number(String(Date.now()).slice(-5, -3)) - arrayBuffer[1]) +  scope.audioContext.baseLatency + chunksSeconds;\r\n\t\tif(scope.debug) console.log(\"Total latency: \"+scope.latency);\r\n\t}\r\n}","ScarletsMedia.convert = {\r\n\t// Converts a MIDI pitch number to frequency.\r\n\t// midi = 0 ~ 127\r\n\tmidiToFreq:function (midi) {\r\n\t    if(midi <= -1500) return 0;\r\n\t    else if(midi > 1499) return 3.282417553401589e+38;\r\n\t    else return 440.0 * Math.pow(2, (Math.floor(midi) - 69) / 12.0);\r\n\t},\r\n\r\n\t// Converts frequency to MIDI pitch.\r\n\tfreqToMidi:function(freq){\r\n\t\tif(freq > 0)\r\n\t\t\treturn Math.floor(Math.log(freq/440.0) / Math.LN2 * 12 + 69);\r\n\t\telse return -1500;\r\n\t},\r\n\r\n    // Converts power to decibel. Note that it is off by 100dB to make it\r\n\tpowerToDb:function(power){\r\n\t    if (power <= 0)\r\n\t    \treturn 0;\r\n\t    else {\r\n\t        var db = 100 + 10.0 / Math.LN10 * Math.log(power);\r\n\t        if(db < 0) return 0;\r\n\t        return db;\r\n\t    }\r\n\t},\r\n\r\n    // Converts decibel to power\r\n\tdbToPower:function(db){\r\n\t    if (db <= 0) return 0;\r\n\t    else {\r\n  \t        if (db > 870) db = 870;\r\n  \t        return Math.exp(Math.LN10 * 0.1 * (db - 100.0));\r\n\t    }\r\n\t},\r\n\r\n\t// Converts amplitude to decibel.\r\n\tampToDb:function(lin){\r\n\t    return 20.0 * (lin > 0.00001 ? (Math.log(lin) / Math.LN10) : -5.0);\r\n\t},\r\n\r\n\t// Converts decibel to amplitude\r\n\tdbToAmp:function(db) {\r\n\t    return Math.pow(10.0, db / 20.0);\r\n\t},\r\n\r\n\t// Converts MIDI velocity to amplitude\r\n\tvelToAmp:function (velocity) {\r\n\t    return velocity / 127;\r\n\t},\r\n}","var MediaBuffer = function(mimeType, chunksDuration, bufferHeader){\r\n\tvar scope = this;\r\n\tscope.source = new MediaSource();\r\n\tscope.objectURL = URL.createObjectURL(scope.source);\r\n\r\n\tvar removing = false;\r\n\tvar totalTime = 0; // miliseconds\r\n\tvar sourceBuffer = null;\r\n\tvar buffers = [];\r\n\r\n\tscope.source.onsourceopen = function(){\r\n\t\tsourceBuffer = scope.source.addSourceBuffer(mimeType);\r\n\t\tsourceBuffer.mode = 'sequence';\r\n\t\tsourceBuffer.appendBuffer(bufferHeader);\r\n\r\n\t\tsourceBuffer.onerror = console.error;\r\n\t\tsourceBuffer.onupdateend = function(){\r\n\t\t\tif(removing){\r\n\t\t\t\tremoving = false;\r\n\t\t\t\ttotalTime = 10000;\r\n\r\n\t\t\t\t// 0 ~ 10 seconds\r\n\t\t\t\tsourceBuffer.remove(0, 10);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(!sourceBuffer.updating && buffers.length !== 0)\r\n\t\t\t\tstartAppending(buffers.shift());\r\n\t\t};\r\n\t};\r\n\r\n\tfunction startAppending(buffer){\r\n\t\tsourceBuffer.appendBuffer(buffer);\r\n\t\ttotalTime += chunksDuration;\r\n\t\t// console.log(totalTime, buffer);\r\n\t}\r\n\r\n\tscope.source.onerror = console.error;\r\n\r\n\tscope.append = function(arrayBuffer){\r\n\t\tif(sourceBuffer === null)\r\n\t\t\treturn false;\r\n\r\n\t\tif(sourceBuffer.buffered.length === 2)\r\n\t\t\tconsole.log('something wrong');\r\n\r\n\t\tif(totalTime >= 20000)\r\n\t\t\tremoving = true;\r\n\r\n\t\tif(!sourceBuffer.updating)\r\n\t\t\tstartAppending(arrayBuffer);\r\n\t\telse\r\n\t\t\tbuffers.push(arrayBuffer);\r\n\r\n\t\treturn totalTime/1000;\r\n\t}\r\n\r\n\tscope.stop = function(){\r\n\t\tif(sourceBuffer.updating)\r\n\t\t\tsourceBuffer.abort();\r\n\r\n\t\tif(scope.source.readyState === \"open\")\r\n\t\t\tscope.source.endOfStream();\r\n\t}\r\n}","// https://www.w3schools.com/tags/ref_av_dom.asp\r\n// https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement\r\nvar ScarletsMediaPlayer = function(element){\r\n\t// https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Media_events\r\n\tvar self = this;\r\n\r\n\tif(element === void 0)\r\n\t\telement = 'audio';\r\n\r\n\tif(element.constructor === String){\r\n\t\tif(element !== 'audio' && element !== 'video')\r\n\t\t\treturn console.error('Supported player is \"audio\" or \"video\"');\r\n\r\n\t\telement = document.createElement(element);\r\n\t\tdocument.body.appendChild(element);\r\n\t}\r\n\r\n\tvar propertyLinker = ['autoplay', 'loop', 'buffered', 'buffered', 'controller', 'currentTime', 'currentSrc', 'duration', 'ended', 'error', 'readyState', 'networkState', 'paused', 'played', 'seekable', 'seeking'];\r\n\r\n\t// Get element audio for output node\r\n\tvar audioOutputNode = false;\r\n\tObject.defineProperty(self, 'audioOutput', {\r\n\t\tget: function(){\r\n\t\t\tif(!audioOutputNode)\r\n\t\t\t\taudioOutputNode = ScarletsMedia.getElementAudioNode(element);\r\n\r\n\t\t\treturn audioOutputNode;\r\n\t\t},\r\n\t\tenumerable: true\r\n\t});\r\n\r\n\tif(element.tagName.toLowerCase() === 'video'){\r\n\t\tpropertyLinker = propertyLinker.concat(['poster', 'height', 'width']);\r\n\r\n\t\t// Get element video for output node\r\n\t\tvar videoOutputNode = false;\r\n\t\tObject.defineProperty(self, 'videoOutput', {\r\n\t\t\tget: function(){\r\n\t\t\t\tif(!videoOutputNode)\r\n\t\t\t\t\tvideoOutputNode = ScarletsMedia.getElementVideoNode(element);\r\n\r\n\t\t\t\treturn videoOutputNode;\r\n\t\t\t},\r\n\t\t\tenumerable: true\r\n\t\t});\r\n\t}\r\n\r\n\t// Reference element function\r\n\tself.load = function(){\r\n\t\telement.load();\r\n\t}\r\n\r\n\tself.canPlayType = function(){\r\n\t\telement.canPlayType();\r\n\t}\r\n\r\n\t// Reference element property\r\n\tfor (var i = 0; i < propertyLinker.length; i++) {\r\n\t\tScarletsMedia.extra.objectPropertyLinker(self, element, propertyLinker[i]);\r\n\t}\r\n\r\n\tself.preload = true;\r\n\telement.preload = 'metadata';\r\n\telement.crossorigin = 'anonymous';\r\n\tself.audioFadeEffect = true;\r\n\r\n\tself.speed = function(set){\r\n\t\tif(set === undefined) return element.defaultPlaybackRate;\r\n\t\telement.defaultPlaybackRate = element.playbackRate = set;\r\n\t}\r\n\r\n\tself.mute = function(set){\r\n\t\tif(set === undefined) return element.muted;\r\n\t\telement.defaultMuted = element.muted = set;\r\n\t}\r\n\r\n\tvar volume = 1;\r\n\tself.volume = function(set){\r\n\t\tif(set === undefined) return volume;\r\n\t\telement.volume = volume = set;\r\n\t}\r\n\r\n\tvar stillWaiting = false;\r\n\tfunction play(successCallback, errorCallback){\r\n\t\telement.play().then(function(){\r\n\t\t\tstillWaiting = false;\r\n\t\t\tif(successCallback) successCallback();\r\n\t\t}).catch(function(e){\r\n\t\t\tif(errorCallback) errorCallback(e);\r\n\t\t\telse{\r\n\t\t\t\t// If user haven't interacted with the page\r\n\t\t\t\t// and media play was requested, let's pending it\r\n\t\t\t\tif(userInteracted === false){\r\n\t\t\t\t\tif(stillWaiting === false){\r\n\t\t\t\t\t\twaitingUnlock.push(function(){\r\n\t\t\t\t\t\t\tplay(successCallback, errorCallback);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tself.play = function(successCallback, errorCallback){\r\n\t\tif(!element.paused){\r\n\t\t\tif(successCallback) successCallback();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(self.audioFadeEffect){\r\n\t\t\telement.volume = 0;\r\n\t\t\tplay(successCallback, errorCallback);\r\n\t\t\tScarletsMedia.extra.fadeNumber(0, volume, 0.02, 400, function(num){\r\n\t\t\t\telement.volume = num;\r\n\t\t\t}, successCallback);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tplay(successCallback, errorCallback);\r\n\t}\r\n\r\n\tself.pause = function(callback){\r\n\t\tif(element.paused){\r\n\t\t\tif(callback) callback();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(self.audioFadeEffect){\r\n\t\t\tScarletsMedia.extra.fadeNumber(volume, 0, -0.02, 400, function(num){\r\n\t\t\t\telement.volume = num;\r\n\t\t\t}, function(){\r\n\t\t\t\telement.pause();\r\n\t\t\t\tif(callback) callback();\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\telement.pause();\r\n\t\tif(callback) callback();\r\n\t}\r\n\r\n\tself.prepare = function(links, callback, force){\r\n\t\t// Stop playing media\r\n\t\tif(!force && !element.paused)\r\n\t\t\treturn self.pause(function(){\r\n\t\t\t\tself.prepare(links, callback, true);\r\n\t\t\t});\r\n\r\n\t\tvar temp = element.querySelectorAll('source');\r\n\t\tfor (var i = temp.length - 1; i >= 0; i--) {\r\n\t\t\ttemp[i].remove();\r\n\t\t}\r\n\r\n\t\tif(self.preload && callback){\r\n\t\t\tself.once('canplay', callback);\r\n\t\t\tself.once('error', function(){\r\n\t\t\t\tself.off('canplay', callback);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif(typeof links === 'string')\r\n\t\t\telement.insertAdjacentHTML('beforeend', `<source src=\"${links.split('\"').join('\\\\\"')}\"/>`);\r\n\t\telse{\r\n\t\t\ttemp = '';\r\n\t\t\tfor (var i = 0; i < links.length; i++) {\r\n\t\t\t\ttemp += `<source src=\"${links[i].split('\"').join('\\\\\"')}\"/>`;\r\n\t\t\t}\r\n\t\t\telement.insertAdjacentHTML('beforeend', temp);\r\n\t\t}\r\n\r\n\t\t// Preload data\r\n\t\tif(self.preload)\r\n\t\t\telement.load();\r\n\r\n\t\telse if(callback)\r\n\t\t\tcallback();\r\n\t}\r\n\r\n\tvar eventRegistered = {};\r\n\tfunction eventTrigger(e){\r\n\t\tfor (var i = 0; i < eventRegistered[e.type].length; i++) {\r\n\t\t\teventRegistered[e.type][i](e, self);\r\n\t\t}\r\n\t}\r\n\r\n\t// https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Media_events\r\n\tself.on = function(eventName, callback){\r\n\t\tvar name = eventName.toLowerCase();\r\n\t\tif(eventRegistered[name] === undefined){\r\n\t\t\telement.addEventListener(eventName, eventTrigger, true);\r\n\t\t\teventRegistered[name] = [];\r\n\t\t}\r\n\t\teventRegistered[name].push(callback);\r\n\t\treturn self;\r\n\t}\r\n\r\n\tself.off = function(eventName, callback){\r\n\t\tvar name = eventName.toLowerCase();\r\n\t\tif(eventRegistered[name] === undefined){\r\n\t\t\telement.removeEventListener(eventName, callback, true);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(!callback)\r\n\t\t\teventRegistered[name].splice(0);\r\n\t\telse\r\n\t\t\teventRegistered[name].splice(eventRegistered[name].indexOf(callback), 1);\r\n\r\n\t\tif(eventRegistered[name].length === 0){\r\n\t\t\teventRegistered[name] = undefined;\r\n\t\t\telement.removeEventListener(eventName, eventTrigger, true);\r\n\t\t}\r\n\t\treturn self;\r\n\t}\r\n\r\n\tself.once = function(eventName, callback){\r\n\t\telement.addEventListener(eventName, callback, {once:true});\r\n\t\treturn self;\r\n\t}\r\n\r\n\tself.destroy = function(){\r\n\t\tfor(var key in eventRegistered){\r\n\t\t\tself.off(key);\r\n\t\t}\r\n\t\tself.playlist.list.splice(0);\r\n\t\tself.playlist.original.splice(0);\r\n\t\tfor(var key in self){\r\n\t\t\tdelete self[key];\r\n\t\t}\r\n\t\tself = null;\r\n\r\n\t\telement.pause();\r\n\t\telement.innerHTML = '';\r\n\t}\r\n\r\n\tvar playlistInitialized = false;\r\n\tfunction internalPlaylistEvent(){\r\n\t\tif(playlistInitialized) return;\r\n\t\tplaylistInitialized = true;\r\n\r\n\t\tself.on('ended', function(){\r\n\t\t\tif(self.playlist.currentIndex < self.playlist.list.length - 1)\r\n\t\t\t\tself.playlist.next(true);\r\n\t\t\telse if(self.playlist.loop)\r\n\t\t\t\tself.playlist.play(0);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction playlistTriggerEvent(name){\r\n\t\tif(!eventRegistered[name]) return;\r\n\t\tfor (var i = 0; i < eventRegistered[name].length; i++) {\r\n\t\t\teventRegistered[name][i](self, self.playlist, self.playlist.currentIndex);\r\n\t\t}\r\n\t}\r\n\r\n\tself.playlist = {\r\n\t\tcurrentIndex:0,\r\n\t\tlist:[],\r\n\t\toriginal:[],\r\n\t\tloop:false,\r\n\t\tshuffled:false,\r\n\r\n\t\t// lists = [{yourProperty:'', stream:['main.mp3', 'fallback.ogg', ..]}, ...]\r\n\t\treload:function(lists){\r\n\t\t\tthis.original = lists;\r\n\t\t\tthis.shuffle(this.shuffled);\r\n\t\t\tinternalPlaylistEvent();\r\n\t\t},\r\n\r\n\t\t// obj = {yourProperty:'', stream:['main.mp3', 'fallback.ogg']}\r\n\t\tadd:function(obj){\r\n\t\t\tthis.original.push(obj);\r\n\t\t\tthis.shuffle(this.shuffled);\r\n\t\t\tinternalPlaylistEvent();\r\n\t\t},\r\n\r\n\t\t// index from 'original' property\r\n\t\tremove:function(index){\r\n\t\t\tthis.original.splice(index, 1);\r\n\t\t\tthis.shuffle(this.shuffled);\r\n\t\t},\r\n\r\n\t\tnext:function(autoplay){\r\n\t\t\tthis.currentIndex++;\r\n\t\t\tif(this.currentIndex >= this.list.length){\r\n\t\t\t\tif(this.loop)\r\n\t\t\t\t\tthis.currentIndex = 0;\r\n\t\t\t\telse{\r\n\t\t\t\t\tthis.currentIndex--;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(autoplay)\r\n\t\t\t\tthis.play(this.currentIndex);\r\n\t\t\telse playlistTriggerEvent('playlistchange');\r\n\t\t},\r\n\r\n\t\tprevious:function(autoplay){\r\n\t\t\tthis.currentIndex--;\r\n\t\t\tif(this.currentIndex < 0){\r\n\t\t\t\tif(this.loop)\r\n\t\t\t\t\tthis.currentIndex = this.list.length - 1;\r\n\t\t\t\telse{\r\n\t\t\t\t\tthis.currentIndex++;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(autoplay)\r\n\t\t\t\tthis.play(this.currentIndex);\r\n\t\t\telse playlistTriggerEvent('playlistchange');\r\n\t\t},\r\n\r\n\t\tplay:function(index){\r\n\t\t\tthis.currentIndex = index;\r\n\t\t\tplaylistTriggerEvent('playlistchange');\r\n\r\n\t\t\tself.prepare(this.list[index].stream, function(){\r\n\t\t\t\tself.play();\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tshuffle:function(set){\r\n\t\t\tif(set === true){\r\n\t\t\t    var j, x, i;\r\n\t\t\t    for (i = this.list.length - 1; i > 0; i--) {\r\n\t\t\t        j = Math.floor(Math.random() * (i + 1));\r\n\t\t\t        x = this.list[i];\r\n\t\t\t        this.list[i] = this.list[j];\r\n\t\t\t        this.list[j] = x;\r\n\t\t\t    }\r\n\t\t\t}\r\n\t\t\telse this.list = this.original.slice(0);\r\n\r\n\t\t\tthis.shuffled = set;\r\n\t\t}\r\n\t};\r\n}","// options = mediaDevices.getUserMedia({thisData})\r\n// latency = 0ms is not possible (minimum is 70ms, or depend on computer performance)\r\nvar ScarletsMediaPresenter = function(options, latency){\r\n\tvar scope = this;\r\n\tif(!latency) latency = 1000;\r\n\t//var options = {\r\n\t//    audio:{\r\n\t//        channelCount:1,\r\n\t//        echoCancellation: false\r\n\t//    },\r\n\t//    video:{\r\n\t//        frameRate:15,\r\n\t//        width: 1280,\r\n\t//        height: 720,\r\n\t//        facingMode: (front ? \"user\" : \"environment\")\r\n\t//    }\r\n\t//};\r\n\r\n\tscope.debug = false;\r\n\tscope.mediaStream = false;\r\n\r\n\tscope.onRecordingReady = null;\r\n\tscope.onBufferProcess = null;\r\n\r\n\tscope.mediaRecorder = null;\r\n\tscope.recordingReady = false;\r\n\r\n\tscope.recording = false;\r\n\tscope.mediaGranted = false;\r\n\r\n\tif(options === void 0)\r\n\t\toptions = {};\r\n\r\n\tscope.debug = options.debug;\r\n\r\n\t// Deprecated\r\n\tscope.options = options;\r\n\r\n\tscope.polyfill = void 0;\r\n\r\n\tvar mediaType = options.video ? 'video' : 'audio';\r\n\r\n\t// Check supported mimeType and codecs for the recorder\r\n\tif(!options.mimeType){\r\n\t\tvar supportedMimeType = false;\r\n\t\tvar codecsList = mediaType === 'audio' ? audioCodecs : videoCodecs;\r\n\r\n\t\tfor(var format in codecsList){\r\n\t\t\tvar mimeType = mediaType+'/'+format;\r\n\t\t\tvar codecs = codecsList[format];\r\n\r\n\t\t\tfor (var i = 0; i < codecs.length; i++) {\r\n\t\t\t\tvar temp = mimeType+';codecs=\"'+codecs[i]+'\"';\r\n\t\t\t\tif(MediaRecorder.isTypeSupported(temp) && MediaSource.isTypeSupported(temp)){\r\n\t\t\t\t\tsupportedMimeType = temp;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(supportedMimeType === false && MediaRecorder.isTypeSupported(mimeType) && MediaSource.isTypeSupported(mimeType))\r\n\t\t\t\tsupportedMimeType = mimeType;\r\n\r\n\t\t\tif(supportedMimeType !== false)\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\toptions.mimeType = supportedMimeType;\r\n\t\tconsole.log(\"mimeType: \"+supportedMimeType);\r\n\t}\r\n\r\n\tvar mediaGranted = function(mediaStream) {\r\n\t\tscope.mediaGranted = true;\r\n\r\n\t\t// For adding effect later (if audio available)\r\n\t\tif(options.audio !== void 0){\r\n\t\t\tscope.source = ScarletsMedia.audioContext.createMediaStreamSource(mediaStream);\r\n\t\t\tscope.mediaStream = mediaStream = scope.destination.stream;\r\n\r\n\t\t\tif(pendingConnect.length !== 0){\r\n\t\t\t\tfor (var i = 0; i < pendingConnect.length; i++)\r\n\t\t\t\t\tscope.source.connect(pendingConnect[i]);\r\n\r\n\t\t\t\tfirstSourceConnect = false;\r\n\t\t\t\tpendingConnect.length = 0;\r\n\t\t\t}\r\n\t\t\telse scope.source.connect(scope.destination);\r\n\t\t}\r\n\r\n\t\tscope.bufferHeader = null;\r\n\t\tvar bufferHeaderLength = false;\r\n\r\n\t\tscope.mediaRecorder = new MediaRecorder(mediaStream, options, scope.polyfill);\r\n\r\n\t\tif(scope.debug) console.log(\"MediaRecorder obtained\");\r\n\t\tscope.mediaRecorder.onstart = function(e) {\r\n\t\t\tscope.recording = true;\r\n\t\t};\r\n\r\n\t\tscope.mediaRecorder.ondataavailable = function(e){\r\n\t\t\t// Stream segments after the header was obtained\r\n\t\t\tif(bufferHeaderLength !== false){\r\n\t\t\t\tvar streamingTime = Number(String(Date.now()).slice(-5, -3));\r\n\t\t\t\tscope.onBufferProcess([e.data, streamingTime]);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Return if the recording was stopped\r\n\t\t\tif(scope.mediaRecorder.state !== 'recording')\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif(e.data.size <= 1) return;\r\n\r\n\t\t\t// The audio buffer can contain some duration that causes a noise\r\n\t\t\t// So we will need to remove it on streamer side\r\n\t\t\t// Because the AudioBuffer can't be converted to ArrayBuffer with WebAudioAPI\r\n\t\t\tscope.bufferHeader = e.data;\r\n\t\t\tbufferHeaderLength = e.data.size;\r\n\r\n\t\t\tif(scope.onRecordingReady)\r\n\t\t\t\tscope.onRecordingReady({\r\n\t\t\t\t\tmimeType:options.mimeType,\r\n\t\t\t\t\tstartTime:Date.now(),\r\n\t\t\t\t\tdata:scope.bufferHeader\r\n\t\t\t\t});\r\n\t\t\tscope.recordingReady = true;\r\n\t\t};\r\n\r\n\t\t// Get first header\r\n\t\tscope.mediaRecorder.start(latency);\r\n\t}\r\n\r\n\tvar pendingConnect = [];\r\n\r\n\tscope.source = void 0;\r\n\tscope.destination = ScarletsMedia.audioContext.createMediaStreamDestination();\r\n\r\n\tvar firstSourceConnect = true;\r\n\tscope.connect = function(node){\r\n\t\tif(scope.source === void 0){\r\n\t\t\tpendingConnect.push(node);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(firstSourceConnect){\r\n\t\t\ttry{\r\n\t\t\t\tscope.source.disconnect(scope.destination);\r\n\t\t\t}catch(e){}\r\n\r\n\t\t\tfirstSourceConnect = false;\r\n\t\t}\r\n\r\n\t\tscope.source.connect(node);\r\n\t}\r\n\r\n\tscope.disconnect = function(node){\r\n\t\tif(scope.source)\r\n\t\t\tscope.source.disconnect(node);\r\n\t\telse{\r\n\t\t\tvar i = pendingConnect.indexOf(node);\r\n\t\t\tif(i === -1)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tpendingConnect.splice(i, 1);\r\n\t\t}\r\n\t}\r\n\r\n\tscope.startRecording = function(){\r\n\t\tif(scope.mediaGranted === false || scope.mediaRecorder === null){\r\n\t\t\tscope.recordingReady = false;\r\n\r\n\t\t\tif(!scope.options.screen)\r\n\t\t\t\tnavigator.mediaDevices.getUserMedia(options).then(mediaGranted).catch(console.error);\r\n\t\t\telse\r\n\t\t\t\tnavigator.mediaDevices.getDisplayMedia(options).then(mediaGranted).catch(console.error);\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\telse if(scope.mediaRecorder.state === 'recording')\r\n\t\t\treturn true;\r\n\t\telse{\r\n\t\t\tscope.mediaRecorder.start(latency);\r\n\t\t\tscope.recording = true;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t};\r\n\r\n\t// ToDo: Allow reuse instead of removing tracks when stopping\r\n\tscope.stopRecording = function(){\r\n\t\tscope.mediaRecorder.stop();\r\n\t\tif(!scope.mediaRecorder.stream.stop){\r\n\t\t\tvar streams = scope.mediaRecorder.stream.getTracks();\r\n\t\t\tfor(var i = 0; i < streams.length; i++){\r\n\t\t\t\tstreams[i].stop();\r\n\t\t\t\tscope.mediaRecorder.stream.removeTrack(streams[i]);\r\n\t\t\t}\r\n\t\t} else scope.mediaRecorder.stream.stop();\r\n\r\n\t\tscope.mediaRecorder.ondataavailable = null;\r\n\t\tscope.mediaRecorder.onstart = null;\r\n\r\n\t\tscope.bufferHeader = null;\r\n\t\tscope.recording = false;\r\n\t};\r\n}","ScarletsMediaEffect.chorus = function(sourceNode){\r\n\tvar context = ScarletsMedia.audioContext;\r\n\tvar output = context.createGain();\r\n\tvar input = sourceNode === undefined ? context.createGain() : null;\r\n\tif(input) sourceNode = input;\r\n\r\n\tvar dry = context.createGain();\r\n    var wet = context.createGain();\r\n    var splitter = context.createChannelSplitter(2);\r\n    var merger = context.createChannelMerger(2);\r\n    sourceNode.connect(splitter);\r\n    sourceNode.connect(dry);\r\n\r\n    var channel = [{/* left */}, {/* right */}];\r\n\r\n    for (var i = 0; i < channel.length; i++) {\r\n    \tvar c = channel[i];\r\n\r\n    \t// Declaration\r\n    \tc.stream = context.createGain();\r\n    \tc.delayVibrato = context.createDelay();\r\n    \tc.delayFixed = context.createDelay();\r\n    \tc.feedback = context.createGain();\r\n    \tc.feedforward = context.createGain();\r\n    \tc.blend = context.createGain();\r\n\r\n    \t// Connection\r\n\t    splitter.connect(c.stream, i, 0);\r\n\t    c.stream.connect(c.delayVibrato);\r\n\t    c.stream.connect(c.delayFixed);\r\n\t    c.delayVibrato.connect(c.feedforward);\r\n\t    c.delayVibrato.connect(merger, 0, i);\r\n\t    c.delayFixed.connect(c.feedback);\r\n\t    c.feedback.connect(c.stream);\r\n\t    c.blend.connect(merger, 0, i);\r\n    }\r\n\r\n    // Output\r\n    merger.connect(wet);\r\n    dry.connect(output);\r\n    wet.connect(output);\r\n\r\n    // LFO modulation\r\n    var lfo = context.createOscillator();\r\n    var LDepth = context.createGain();\r\n    var RDepth = context.createGain();\r\n    lfo.connect(LDepth);\r\n    lfo.connect(RDepth);\r\n    LDepth.connect(channel[0].delayVibrato.delayTime);\r\n    RDepth.connect(channel[1].delayVibrato.delayTime);\r\n    lfo.start(0);\r\n\r\n    // Settings\r\n    lfo.type = 'sine';\r\n    lfo.frequency.value = 0.15;\r\n    LDepth.gain.value = 0.013;\r\n    RDepth.gain.value = -0.017;\r\n    channel[0].delayFixed.delayTime.value = 0.005;\r\n    channel[1].delayFixed.delayTime.value = 0.007;\r\n    channel[0].delayVibrato.delayTime.value = 0.013;\r\n    channel[1].delayVibrato.delayTime.value = 0.017;\r\n\r\n    var options = {rate:0, intensity:0, mix:0};\r\n\r\n\tvar ret =  {\r\n\t\t// Connect to output\r\n\t\t// output.connect(context.destination);\r\n\t\toutput:output,\r\n\t\tinput:input,\r\n\r\n\t\trate: function (value) { // value: 0 ~ 1\r\n\t\t\tif(value === undefined) return options.rate;\r\n\t\t\toptions.rate = value;\r\n\r\n\t    \tvalue = value * 0.29 + 0.01;\r\n\t    \tlfo.frequency.value = value;\r\n\t    },\r\n\r\n\t    intensity: function (value) { // value: 0 ~ 1\r\n\t\t\tif(value === undefined) return options.intensity;\r\n\t\t\toptions.intensity = value;\r\n\r\n\t    \tvar blend = 1.0 - (value * 0.2929);\r\n\t    \tvar feedforward = value * 0.2929 + 0.7071;\r\n\t    \tvar feedback = value * 0.7071;\r\n\r\n\t    \tfor (var i = 0; i < channel.length; i++) {\r\n\t\t    \tchannel[i].blend.gain.value = blend;\r\n\t\t    \tchannel[i].feedforward.gain.value = feedforward;\r\n\t\t    \tchannel[i].feedback.gain.value = feedback;\r\n\t    \t}\r\n\t    },\r\n\r\n\t    mix: function (value) {\r\n\t\t\tif(value === undefined) return options.mix;\r\n\t\t\toptions.mix = value;\r\n\t\t\t\r\n\t    \tdry.gain.value = value;\r\n\t    },\r\n\r\n\t\t// This should be executed to clean memory\r\n\t\tdestroy:function(){\r\n\t\t\tif(input) input.disconnect();\r\n\t\t\toutput.disconnect();\r\n\t\t\tlfo.stop(0);\r\n\t\t\tlfo.disconnect();\r\n\t\t\t\r\n\t    \tfor (var i = 0; i < channel.length; i++) {\r\n\t\t    \tchannel[i].stream.disconnect();\r\n\t    \t}\r\n\t\t\tfor(var key in this){\r\n\t\t\t\tdelete this[key];\r\n\t\t\t}\r\n\t\t\toutput = null;\r\n\t\t}\r\n\t};\r\n\r\n\t// Initial settings\r\n    ret.rate(0.5);\r\n    ret.intensity(0.0);\r\n    ret.mix(0.75);\r\n\r\n\treturn ret;\r\n};","ScarletsMediaEffect.conReverb = function(sourceNode){\r\n\tvar context = ScarletsMedia.audioContext;\r\n\tvar output = context.createGain();\r\n\tvar input = sourceNode === undefined ? context.createGain() : null;\r\n\tif(input) sourceNode = input;\r\n\r\n    var reverbNode = context.createConvolver();\r\n\tvar wetGainNode = context.createGain();\r\n\tvar dryGainNode = context.createGain();\r\n\r\n\tsourceNode.connect(dryGainNode);\r\n\tsourceNode.connect(reverbNode);\r\n\r\n    reverbNode.connect(wetGainNode);\r\n    dryGainNode.connect(output);\r\n    wetGainNode.connect(output);\r\n\r\n    function setBuffer(buffer){\r\n    \tif(reverbNode.buffer !== null){\r\n    \t\treverbNode.disconnect();\r\n    \t\treverbNode = context.createConvolver();\r\n\r\n\t\t\tsourceNode.connect(reverbNode);\r\n\t\t    reverbNode.connect(wetGainNode);\r\n    \t}\r\n    \treverbNode.buffer = buffer;\r\n    }\r\n\r\n\treturn {\r\n\t\t// Connect to output\r\n\t\t// output.connect(context.destination);\r\n\t\toutput:output,\r\n\t\tinput:input,\r\n\r\n\t\t// This must be set\r\n\t\tsetBuffer:setBuffer,\r\n\r\n\t\t// Load audio buffer from url\r\n\t\tloadBuffer:function(url){\r\n\t\t\tvar ajaxRequest = new XMLHttpRequest();\r\n\t\t\tajaxRequest.open('GET', url, true);\r\n\t\t\tajaxRequest.responseType = 'arraybuffer';\r\n\r\n\t\t\tajaxRequest.onload = function(){\r\n\t\t\t  var audioData = ajaxRequest.response;\r\n\t\t\t  context.decodeAudioData(audioData, function(buffer) {\r\n\t\t\t      setBuffer(buffer);\r\n\t\t\t  }, function(e){\"Error with decoding audio data\" + e.err});\r\n\t\t\t}\r\n\r\n\t\t\tajaxRequest.send();\r\n\t\t},\r\n\r\n\t\tmix: function(value){ // value: 0 ~ 1\r\n\t\t\tif(value === undefined) return wetGainNode.gain.value;\r\n\t\t\tdryGainNode.gain.value = 1 - value;\r\n\t\t\twetGainNode.gain.value = value;\r\n\t\t},\r\n\r\n\t\t// This should be executed to clean memory\r\n\t\tdestroy:function(){\r\n\t\t\tif(input) input.disconnect();\r\n\t\t\tdryGainNode.disconnect();\r\n\t\t\toutput.disconnect();\r\n\t\t\treverbNode.disconnect();\r\n\t\t\t\r\n\t\t\tfor(var key in this){\r\n\t\t\t\tdelete this[key];\r\n\t\t\t}\r\n\t\t\toutput = null;\r\n\t\t}\r\n\t};\r\n};","ScarletsMediaEffect.cutOff = function(passType, sourceNode){ // passType: 'lowpass' | 'bandpass' | 'highpass'\r\n\tvar context = ScarletsMedia.audioContext;\r\n\tvar output = context.createGain();\r\n\tvar input = sourceNode === undefined ? context.createGain() : null;\r\n\tif(input) sourceNode = input;\r\n\r\n\tvar filterNode = context.createBiquadFilter();\r\n\tfilterNode.type = passType || 'lowpass';\r\n\tfilterNode.frequency.value = 350;\r\n\tfilterNode.Q.value = 1;\r\n\tfilterNode.connect(output);\r\n\tsourceNode.connect(filterNode);\r\n\t\r\n\treturn {\r\n\t\t// Connect to output\r\n\t\t// output.connect(context.destination);\r\n\t\toutput:output,\r\n\t\tinput:input,\r\n\t\t\r\n\t\ttype: function(value){\r\n\t\t\tif(value === undefined)\r\n\t\t\t\treturn filterNode.type;\r\n\t\t\tfilterNode.type = value;\r\n\t\t},\r\n\t\tfrequency: function(value){\r\n\t\t\tif(value === undefined)\r\n\t\t\t\treturn filterNode.frequency.value;\r\n\t\t\tfilterNode.frequency.value = value;\r\n\t\t},\r\n\t\twidth: function(value){\r\n\t\t\tif(value === undefined)\r\n\t\t\t\treturn filterNode.Q.value;\r\n\t\t\tfilterNode.Q.value = value;\r\n\t\t},\r\n\r\n\t\t// This should be executed to clean memory\r\n\t\tdestroy:function(){\r\n\t\t\tif(input) input.disconnect();\r\n\t\t\tfilterNode.disconnect();\r\n\t\t\toutput.disconnect();\r\n\t\t\t\r\n\t\t\tfor(var key in this){\r\n\t\t\t\tdelete this[key];\r\n\t\t\t}\r\n\t\t\toutput = null;\r\n\t\t}\r\n\t};\r\n};","ScarletsMediaEffect.delay = function(sourceNode){\r\n\tvar context = ScarletsMedia.audioContext;\r\n\tvar output = context.createGain();\r\n\tvar input = sourceNode === undefined ? context.createGain() : null;\r\n\tif(input) sourceNode = input;\r\n\r\n\tvar dryGainNode = context.createGain();\r\n\tvar wetGainNode = context.createGain();\r\n\tvar feedbackGainNode = context.createGain();\r\n\tvar delayNode = context.createDelay();\r\n\r\n\tsourceNode.connect(dryGainNode);\r\n\tdryGainNode.connect(output);\r\n\r\n\tdelayNode.connect(feedbackGainNode);\r\n\tfeedbackGainNode.connect(delayNode);\r\n\r\n\tsourceNode.connect(delayNode);\r\n\tdelayNode.connect(wetGainNode);\r\n\t\r\n\twetGainNode.connect(output);\r\n\t\r\n\tvar ret = {\r\n\t\t// Connect to output\r\n\t\t// output.connect(context.destination);\r\n\t\toutput:output,\r\n\t\tinput:input,\r\n\r\n\t\tmix:function(value){ // value: 0 ~ 1\r\n\t\t\tif(value === undefined) return wetGainNode.gain.value;\r\n\t\t\tdryGainNode.gain.value = 1 - value;\r\n\t\t\twetGainNode.gain.value = value;\r\n\t\t},\r\n\t\ttime:function(value){ // value: 0 ~ 180\r\n\t\t\tif(value === undefined) return delayNode.delayTime.value;\r\n\t\t\tdelayNode.delayTime.value = value;\r\n\t\t},\r\n\t\tfeedback:function(value){ // value: 0 ~ 1\r\n\t\t\tif(value === undefined) return feedbackGainNode.gain.value;\r\n\t\t\tfeedbackGainNode.gain.value = value;\r\n\t\t},\r\n\r\n\t\t// This should be executed to clean memory\r\n\t\tdestroy:function(){\r\n\t\t\tif(input) input.disconnect();\r\n\t\t\toutput.disconnect();\r\n\t\t\tdryGainNode.disconnect();\r\n\t\t\twetGainNode.disconnect();\r\n\t\t\tfeedbackGainNode.disconnect();\r\n\t\t\tdelayNode.disconnect();\r\n\t\t\t\r\n\t\t\tfor(var key in this){\r\n\t\t\t\tdelete this[key];\r\n\t\t\t}\r\n\t\t\toutput = null;\r\n\t\t}\r\n\t};\r\n\r\n\tret.mix(0.5);\r\n\tret.time(0.3);\r\n\tret.feedback(0.5);\r\n\r\n\treturn ret;\r\n};","ScarletsMediaEffect.distortion = function(sourceNode){\r\n\tvar context = ScarletsMedia.audioContext;\r\n\tvar output = context.createGain();\r\n\tvar input = sourceNode === undefined ? context.createGain() : null;\r\n\tif(input) sourceNode = input;\r\n\tvar deg = 57 * Math.PI / 180;\r\n\r\n\tvar waveShaperNode = context.createWaveShaper();\r\n\twaveShaperNode.connect(output);\r\n\tsourceNode.connect(waveShaperNode);\r\n\r\n\tvar options = {\r\n\t\tamount:0\r\n\t};\r\n\treturn {\r\n\t\tset:function(amount){ // amount: 0 ~ 1\r\n\t\t\tif(amount === undefined) return options.amount;\r\n\t\t\toptions.amount = amount;\r\n\t\t\t\r\n\t\t\tamount = amount * 10;\r\n\t\t    var curve = new Float32Array(context.sampleRate);\r\n\t\t    var temp = 2 / context.sampleRate;\r\n\r\n\t\t    for (var i = 0 ; i < context.sampleRate; i++) {\r\n\t\t    \tvar x = i * temp - 1;\r\n\r\n\t\t    \t// http://kevincennis.github.io/transfergraph/\r\n\t\t    \tcurve[i] = (3 + amount) * x * deg / (Math.PI + amount * Math.abs(x));\r\n\t\t    }\r\n\r\n\t\t    waveShaperNode.curve = curve;\r\n\t\t},\r\n\r\n\t\t// Connect to output\r\n\t\t// output.connect(context.destination);\r\n\t\toutput:output,\r\n\t\tinput:input,\r\n\r\n\t\t// This should be executed to clean memory\r\n\t\tdestroy:function(){\r\n\t\t\tif(input) input.disconnect();\r\n\t\t\twaveShaperNode.disconnect();\r\n\t\t\toutput.disconnect();\r\n\r\n\t\t\twaveShaperNode = output = null;\r\n\t\t\tfor(var key in this){\r\n\t\t\t\tdelete this[key];\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n};","ScarletsMediaEffect.dubDelay = function(sourceNode){\r\n\tvar context = ScarletsMedia.audioContext;\r\n\tvar output = context.createGain();\r\n\tvar input = sourceNode === undefined ? context.createGain() : null;\r\n\tif(input) sourceNode = input;\r\n\r\n\tvar dryGainNode = context.createGain();\r\n\tvar wetGainNode = context.createGain();\r\n\tvar feedbackGainNode = context.createGain();\r\n\tvar delayNode = context.createDelay();\r\n\tvar bqFilterNode = context.createBiquadFilter(); \r\n\r\n\tsourceNode.connect(dryGainNode);\r\n\tdryGainNode.connect(output);\r\n\r\n\tsourceNode.connect(wetGainNode);\r\n\tsourceNode.connect(feedbackGainNode);\r\n\r\n\tfeedbackGainNode.connect(bqFilterNode);\r\n\tbqFilterNode.connect(delayNode);\r\n\tdelayNode.connect(feedbackGainNode);\r\n\tdelayNode.connect(wetGainNode);\r\n\r\n\twetGainNode.connect(output);\r\n\t\r\n\tvar ret = {\r\n\t\t// Connect to output\r\n\t\t// output.connect(context.destination);\r\n\t\toutput:output,\r\n\t\tinput:input,\r\n\t\t\r\n\t\tmix:function(value){ // value: 0 ~ 1\r\n\t\t\tif(value === undefined) return wetGainNode.gain.value;\r\n\t\t\tdryGainNode.gain.value = 1 - value;\r\n\t\t\twetGainNode.gain.value = value;\r\n\t\t},\r\n\t\ttime:function(value){ // value: 0 ~ 180\r\n\t\t\tif(value === undefined) return delayNode.delayTime.value;\r\n\t\t\tdelayNode.delayTime.value = value;\r\n\t\t},\r\n\t\tfeedback:function(value){ // value: 0 ~ 1\r\n\t\t\tif(value === undefined) return feedbackGainNode.gain.value;\r\n\t\t\tfeedbackGainNode.gain.value = value;\r\n\t\t},\r\n\t\tcutoff:function(value){ // value: 0 ~ 4000\r\n\t\t\tif(value === undefined) return bqFilterNode.frequency.value;\r\n\t\t\tbqFilterNode.frequency.value = value;\r\n\t\t},\r\n\r\n\t\t// This should be executed to clean memory\r\n\t\tdestroy:function(){\r\n\t\t\tif(input) input.disconnect();\r\n\t\t\toutput.disconnect();\r\n\t\t\tdryGainNode.disconnect();\r\n\t\t\twetGainNode.disconnect();\r\n\t\t\tfeedbackGainNode.disconnect();\r\n\r\n\t\t\tfor(var key in this){\r\n\t\t\t\tdelete this[key];\r\n\t\t\t}\r\n\t\t\toutput = null;\r\n\t\t}\r\n\t};\r\n\r\n\tret.mix(0.5);\r\n\tret.time(0.7);\r\n\tret.feedback(0.6);\r\n\tret.cutoff(700);\r\n\r\n\treturn ret;\r\n};","ScarletsMediaEffect.equalizer = function(frequencies, sourceNode){\r\n\tvar freq = frequencies || [32, 64, 125, 250, 500, 1000, 2000, 4000, 8000, 16000];\r\n\tvar context = ScarletsMedia.audioContext;\r\n\t\r\n\tvar output = context.createGain(); // Combine all effect\r\n\tvar input = sourceNode === undefined ? context.createGain() : null;\r\n\tif(input) sourceNode = input;\r\n\r\n\tvar equalizer = {};\r\n\tvar lastIndex = freq.length - 1;\r\n\r\n\tfor (var i = 0; i < freq.length; i++) {\r\n        var filter = context.createBiquadFilter(); // Frequency pass\r\n\t\tfilter.gain.value = 0;\r\n        filter.frequency.value = freq[i];\r\n\r\n        if(i === 0) filter.type = 'lowshelf';\r\n        else if(i === lastIndex) filter.type = 'highshelf';\r\n        else filter.type = 'peaking';\r\n\r\n\t\tif(i !== 0)\r\n\t    \tequalizer[freq[i - 1]].connect(filter);\r\n        equalizer[freq[i]] = filter;\r\n\t}\r\n\r\n\tsourceNode.connect(equalizer[freq[0]]);\r\n\tfilter.connect(output);\r\n\r\n\treturn {\r\n\t\t// Connect to output\r\n\t\t// output.connect(context.destination);\r\n\t\toutput:output,\r\n\t\tinput:input,\r\n\t\t\r\n\t\tfrequency:function(frequency, dB){ // value: -20 ~ 20\r\n\t\t\tif(dB === undefined) return equalizer[frequency].gain.value;\r\n\t\t\tequalizer[frequency].gain.value = dB;\r\n\t\t},\r\n\r\n\t\t// This should be executed to clean memory\r\n\t\tdestroy:function(){\r\n\t\t\tfor (var i = 0; i < freq.length; i++) {\r\n\t    \t\tequalizer[freq[i]].disconnect(); // filter\r\n\t\t\t}\r\n\t\t\tequalizer.splice(0);\r\n\r\n\t\t\tif(input) input.disconnect();\r\n\t\t\toutput.disconnect();\r\n\t\t\t\r\n\t\t\tfor(var key in this){\r\n\t\t\t\tdelete this[key];\r\n\t\t\t}\r\n\t\t\tequalizer = output = null;\r\n\t\t}\r\n\t};\r\n};","ScarletsMediaEffect.fade = function(sourceNode){\r\n\tvar context = ScarletsMedia.audioContext;\r\n\tvar output = context.createGain();\r\n\tvar input = sourceNode === undefined ? context.createGain() : null;\r\n\tif(input) sourceNode = input;\r\n\r\n\toutput.gain.value = 1;\r\n\tsourceNode.connect(output);\r\n\t\r\n\treturn {\r\n\t\t// Connect to output\r\n\t\t// output.connect(context.destination);\r\n\t\toutput:output,\r\n\t\tinput:input,\r\n\r\n\t\tin:function(value, time, callback){ // value: 0~1, time: in seconds\r\n\t\t\toutput.gain.cancelScheduledValues(context.currentTime);\r\n\r\n\t\t\tvar remainingTime = (1 - output.gain.value) * value;\r\n\t\t\toutput.gain.setTargetAtTime(1.0, context.currentTime, remainingTime * time);\r\n\r\n\t\t\tif(callback) setTimeout(callback, time * 1000);\r\n\t\t},\r\n\t\tout:function(value, time, callback){ // value: 0~1, time: in seconds\r\n\t\t\toutput.gain.cancelScheduledValues(context.currentTime);\r\n\r\n\t\t\tvar remainingTime = output.gain.value * value;\r\n\t\t\toutput.gain.setTargetAtTime(0.00001, context.currentTime, remainingTime / time);\r\n\r\n\t\t\tif(callback) setTimeout(callback, time * 1000);\r\n\t\t},\r\n\r\n\t\t// This should be executed to clean memory\r\n\t\tdestroy:function(){\r\n\t\t\tif(input) input.disconnect();\r\n\t\t\toutput.disconnect();\r\n\t\t\t\r\n\t\t\tfor(var key in this){\r\n\t\t\t\tdelete this[key];\r\n\t\t\t}\r\n\t\t\toutput = null;\r\n\t\t}\r\n\t};\r\n};","ScarletsMediaEffect.flanger = function(sourceNode){\r\n\tvar context = ScarletsMedia.audioContext;\r\n\tvar output = context.createGain();\r\n\tvar input = sourceNode === undefined ? context.createGain() : null;\r\n\tif(input) sourceNode = input;\r\n\r\n\tvar inputFeedbackNode = context.createGain();\r\n\tvar wetGainNode = context.createGain();\r\n\tvar dryGainNode = context.createGain();\r\n\tvar delayNode = context.createDelay();\r\n\tvar oscillatorNode = context.createOscillator();\r\n\tvar gainNode = context.createGain();\r\n\tvar feedbackNode = context.createGain();\r\n\toscillatorNode.type = 'sine';\r\n\r\n\tsourceNode.connect(inputFeedbackNode);\r\n\tsourceNode.connect(dryGainNode);\r\n\r\n\tinputFeedbackNode.connect(delayNode);\r\n\tinputFeedbackNode.connect(wetGainNode);\r\n\r\n\tdelayNode.connect(wetGainNode);\r\n\tdelayNode.connect(feedbackNode);\r\n\r\n\tfeedbackNode.connect(inputFeedbackNode);\r\n\r\n\toscillatorNode.connect(gainNode);\r\n\tgainNode.connect(delayNode.delayTime);\r\n\r\n\tdryGainNode.connect(output);\r\n\twetGainNode.connect(output);\r\n\r\n\toscillatorNode.start(0);\r\n\t\r\n\tvar ret = {\r\n\t\t// Connect to output\r\n\t\t// output.connect(context.destination);\r\n\t\toutput:output,\r\n\t\tinput:input,\r\n\r\n\t\tmix: function(value){ // value: 0 ~ 1\r\n\t\t\tif(value === undefined) return wetGainNode.gain.value;\r\n\t\t\tdryGainNode.gain.value = 1 - value;\r\n\t\t\twetGainNode.gain.value = value;\r\n\t\t},\r\n\t\ttime:function(value){ // value: 0 ~ 1\r\n\t\t\tif(value === undefined) return ScarletsMedia.extra.denormalize(delayNode.delayTime.value, 0.001, 0.02);\r\n\t\t\tdelayNode.delayTime.value = ScarletsMedia.extra.normalize(value, 0.001, 0.02);\r\n\t\t},\r\n\t\tspeed:function(value){ // value: 0 ~ 1\r\n\t\t\tif(value === undefined) return ScarletsMedia.extra.denormalize(delayNode.delayTime.value, 0.5, 5);\r\n\t\t\toscillatorNode.frequency.value = ScarletsMedia.extra.normalize(value, 0.5, 5);\r\n\t\t},\r\n\t\tdepth:function(value){ // value: 0 ~ 1\r\n\t\t\tif(value === undefined) return ScarletsMedia.extra.denormalize(delayNode.delayTime.value, 0.0005, 0.005);\r\n\t\t\tgainNode.gain.value = ScarletsMedia.extra.normalize(value, 0.0005, 0.005);\r\n\t\t},\r\n\t\tfeedback:function(value){ // value: 0 ~ 1\r\n\t\t\tif(value === undefined) return ScarletsMedia.extra.denormalize(delayNode.delayTime.value, 0, 0.8);\r\n\t\t\tfeedbackNode.gain.value = ScarletsMedia.extra.normalize(value, 0, 0.8);\r\n\t\t},\r\n\r\n\t\t// This should be executed to clean memory\r\n\t\tdestroy:function(){\r\n\t\t\tif(input) input.disconnect();\r\n\t\t\toutput.disconnect();\r\n\t\t\tinputFeedbackNode.disconnect();\r\n\t\t\tdryGainNode.disconnect();\r\n\r\n\t\t\tfor(var key in this){\r\n\t\t\t\tdelete this[key];\r\n\t\t\t}\r\n\t\t\toutput = null;\r\n\t\t}\r\n\t};\r\n\r\n\tret.time(0.45);\r\n\tret.speed(0.2);\r\n\tret.depth(0.1);\r\n\tret.feedback(0.1);\r\n\tret.mix(0.5);\r\n\r\n\treturn ret;\r\n};","ScarletsMediaEffect.harmonizer = function(sourceNode){\r\n\tvar context = ScarletsMedia.audioContext;\r\n\tvar output = context.createGain();\r\n\tvar input = sourceNode === undefined ? context.createGain() : null;\r\n\tif(input) sourceNode = input;\r\n  \tvar bands = 8;\r\n\r\n\t// Cascading 2 filters for sharp resonance.\r\n    var filters1 = [];\r\n    var filters2 = [];\r\n    var gains = [];\r\n\r\n    for (var i = 0; i < bands; i++) {\r\n      filters1[i] = context.createBiquadFilter();\r\n      filters1[i].type = 'bandpass';\r\n      filters2[i] = context.createBiquadFilter();\r\n      filters2[i].type = 'bandpass';\r\n      sourceNode.connect(filters1[i]);\r\n\r\n      gains[i] = context.createGain();\r\n      gains[i].connect(output);\r\n      filters1[i].connect(filters2[i]).connect(gains[i]);\r\n    }\r\n\r\n    output.gain.value = 35.0;\r\n    var options = {\r\n    \tpitch:0,\r\n    \tslope:0,\r\n    \twidth:0\r\n    };\r\n\r\n\tvar ret = {\r\n\t\t// Connect to output\r\n\t\t// output.connect(context.destination);\r\n\t\toutput:output,\r\n\t\tinput:input,\r\n\t\t\r\n\t\t// Change frequency of filters\r\n\t    pitch: function (value) {\r\n\t\t\tif(value === undefined) return options.pitch;\r\n\t\t\toptions.pitch = value;\r\n\t\t\t\r\n\t    \tvar f0 = ScarletsMedia.convert.midiToFreq(value);\r\n\t    \tfor (var i = 0; i < bands; i++) {\r\n\t    \t\tfilters1[i].frequency.value = f0;\r\n\t    \t\tfilters2[i].frequency.value = f0;\r\n\t    \t}\r\n\t    },\r\n\r\n\t    slope: function (value) {\r\n\t\t\tif(value === undefined) return options.slope;\r\n\t\t\toptions.slope = value;\r\n\t\t\t\r\n\t    \tfor (var i = 0; i < bands; i++) {\r\n\t    \t\tgains[i].gain.value = 1.0 + Math.sin(Math.PI + (Math.PI/2 * (value + i / bands)));\r\n\t    \t}\r\n\t    },\r\n\r\n\t    width: function (value) {\r\n\t\t\tif(value === undefined) return options.width;\r\n\t\t\toptions.width = value;\r\n\t\t\t\r\n\t    \tfor (var i = 1; i < bands; i++) {\r\n\t    \t\tvar q = 2 + 90 * Math.pow((1 - i / bands), value);\r\n\t    \t\tfilters1[i].Q.value = q;\r\n\t    \t\tfilters2[i].Q.value = q;\r\n\t    \t}\r\n\t    },\r\n\r\n\t\t// This should be executed to clean memory\r\n\t\tdestroy:function(){\r\n\t\t\tif(input) input.disconnect();\r\n\t\t\toutput.disconnect();\r\n\r\n\t\t    for (var i = 0; i < bands; i++) {\r\n\t\t        filters1[i].disconnect();\r\n\t\t  \t}\r\n\r\n\t\t\tfor(var key in this){\r\n\t\t\t\tdelete this[key];\r\n\t\t\t}\r\n\t\t\toutput = null;\r\n\t\t}\r\n\t};\r\n\r\n    ret.pitch(34);\r\n    ret.slope(0.65);\r\n    ret.width(0.15);\r\n\r\n\treturn ret;\r\n\r\n\t// sample\r\n\t// noise x0.25 -> harmonizer -> reverb x0.85\r\n};","ScarletsMediaEffect.noise = function(sourceNode){\r\n\tvar context = ScarletsMedia.audioContext;\r\n\tvar output = context.createGain();\r\n\tvar input = sourceNode === undefined ? context.createGain() : null;\r\n\tif(input) sourceNode = input;\r\n\r\n\tvar length = Math.floor(context.sampleRate * 9.73);\r\n\tvar noiseFloat32 = new Float32Array(length);\r\n\r\n\tfor (var i = 0; i < length; i++) {\r\n\t\tnoiseFloat32[i] = Math.sqrt(-2.0 * Math.log(Math.random())) * Math.cos(2.0 * Math.PI * Math.random()) * 0.5;\r\n\t}\r\n\r\n\tvar noiseBuffer = context.createBuffer(2, length, context.sampleRate);\r\n\tnoiseBuffer.getChannelData(0).set(noiseFloat32, 0);\r\n\tnoiseBuffer.getChannelData(1).set(noiseFloat32, 0);\r\n\r\n    var src = context.createBufferSource();\r\n    src.to(output);\r\n    src.loop = true;\r\n    src.start(0);\r\n    src.buffer = noiseBuffer;\r\n    src.loopStart = Math.random() * 9.73;\r\n\t\r\n\treturn {\r\n\t\t// Connect to output\r\n\t\t// output.connect(context.destination);\r\n\t\toutput:output,\r\n\t\tinput:input,\r\n\r\n\t\t// This should be executed to clean memory\r\n\t\tdestroy:function(){\r\n\t\t\tsrc.loop = false;\r\n\t\t\tsrc.buffer = null;\r\n    \t\tsrc.stop(0);\r\n\t\t\tsrc.disconnect();\r\n\t\t\tsrc = null;\r\n\r\n\t\t\tif(input) input.disconnect();\r\n\t\t\toutput.disconnect();\r\n\t\t\t\r\n\t\t\tfor(var key in this){\r\n\t\t\t\tdelete this[key];\r\n\t\t\t}\r\n\t\t\toutput = null;\r\n\t\t}\r\n\t};\r\n};\r\n","ScarletsMediaEffect.pingPongDelay = function(sourceNode){\r\n\tvar context = ScarletsMedia.audioContext;\r\n\tvar output = context.createGain();\r\n\tvar input = sourceNode === undefined ? context.createGain() : null;\r\n\tif(input) sourceNode = input;\r\n\tvar mix = 0;\r\n\r\n\tvar delayNodeLeft = context.createDelay();\r\n\tvar delayNodeRight = context.createDelay();\r\n\tvar dryGainNode = context.createGain();\r\n\tvar wetGainNode = context.createGain();\r\n\tvar feedbackGainNode = context.createGain();\r\n\tvar channelMerger = context.createChannelMerger(2);\r\n\r\n\tsourceNode.connect(dryGainNode);\r\n\tdryGainNode.connect(output);\r\n\r\n\tdelayNodeLeft.connect(channelMerger, 0, 0);\r\n\tdelayNodeRight.connect(channelMerger, 0, 1);\r\n\tdelayNodeLeft.connect(delayNodeRight);\r\n\r\n\tfeedbackGainNode.connect(delayNodeLeft);\r\n\tdelayNodeRight.connect(feedbackGainNode);\r\n\r\n\tsourceNode.connect(feedbackGainNode);\r\n\r\n\tchannelMerger.connect(wetGainNode);\r\n\twetGainNode.connect(output);\r\n\t\r\n\tvar ret = {\r\n\t\t// Connect to output\r\n\t\t// output.connect(context.destination);\r\n\t\toutput:output,\r\n\t\tinput:input,\r\n\r\n\t\tmix: function(value){ // value: 0 ~ 1\r\n\t\t\tif(value === undefined) return wetGainNode.gain.value;\r\n\t\t\tdryGainNode.gain.value = 1 - value;\r\n\t\t\twetGainNode.gain.value = value;\r\n\t\t},\r\n\t\ttime:function(value){ // value: 0 ~ 180\r\n\t\t\tif(value === undefined) return delayNodeLeft.delayTime.value;\r\n\t\t\tdelayNodeLeft.delayTime.value = value;\r\n\t\t\tdelayNodeRight.delayTime.value = value;\r\n\t\t},\r\n\t\tfeedback:function(value){ // value: 0 ~ 1\r\n\t\t\tif(value === undefined) return feedbackGainNode.gain.value;\r\n\t\t\tfeedbackGainNode.gain.value = value;\r\n\t\t},\r\n\r\n\t\t// This should be executed to clean memory\r\n\t\tdestroy:function(){\r\n\t\t\tif(input) input.disconnect();\r\n\t\t\toutput.disconnect();\r\n\t\t\tdryGainNode.disconnect();\r\n\t\t\tfeedbackGainNode.disconnect();\r\n\t\t\t\r\n\t\t\tfor(var key in this){\r\n\t\t\t\tdelete this[key];\r\n\t\t\t}\r\n\t\t\toutput = null;\r\n\t\t}\r\n\t};\r\n\r\n\tret.mix(0.5);\r\n\tret.time(0.3);\r\n\tret.feedback(0.5);\r\n\r\n\treturn ret;\r\n};","ScarletsMediaEffect.pitchShift = function(sourceNode){\r\n    var context = ScarletsMedia.audioContext;\r\n    var output = context.createGain();\r\n    var input = sourceNode === undefined ? context.createGain() : null;\r\n    if(input) sourceNode = input;\r\n\r\n    var bufferTime = 0.100;\r\n    var fadeTime = bufferTime / 2;\r\n    var bufferRate = bufferTime * context.sampleRate;\r\n\r\n    // Delay amount for changing pitch.\r\n    var modulateGain1 = context.createGain();\r\n    var modulateGain2 = context.createGain();\r\n\r\n    var delayNode1 = context.createDelay();\r\n    var delayNode2 = context.createDelay();\r\n    modulateGain1.connect(delayNode1.delayTime);\r\n    modulateGain2.connect(delayNode2.delayTime);\r\n\r\n    sourceNode.connect(delayNode1);\r\n    sourceNode.connect(delayNode2);\r\n\r\n    var fTime = context.currentTime + fadeTime;\r\n    var bTime = context.currentTime + bufferTime;\r\n\r\n    function createPitchBuffer(shiftUp){\r\n        var buffer = context.createBuffer(1, bufferRate, context.sampleRate);\r\n        var pitch = buffer.getChannelData(0);\r\n        \r\n        // Buffer pitch shift\r\n        for (var i = 0; i < bufferRate; i++) {\r\n            if(shiftUp)\r\n              pitch[i] = (bufferRate - i) / bufferRate;\r\n            else\r\n              pitch[i] = i / bufferRate;\r\n        }\r\n\r\n        return buffer;\r\n    }\r\n    \r\n    // Delay modulation.\r\n    var bufferSource = [0,0,0,0];\r\n    var bufferGain = [0,0,0,0];\r\n    for (var i = 0; i < bufferSource.length; i++) {\r\n        bufferSource[i] = context.createBufferSource();\r\n        bufferSource[i].loop = true;\r\n\r\n        bufferGain[i] = context.createGain();\r\n\r\n        if(i < 2)\r\n            bufferSource[i].buffer = createPitchBuffer(false);\r\n        else {\r\n            bufferSource[i].buffer = createPitchBuffer(true);\r\n            bufferGain[i].gain.value = 0;\r\n        }\r\n\r\n        if(i % 2){ // Odd\r\n            bufferGain[i].connect(modulateGain2);\r\n\t    \tbufferSource[i].start(bTime);\r\n        }\r\n        else { // Even\r\n            bufferGain[i].connect(modulateGain1);\r\n\t    \tbufferSource[i].start(fTime);\r\n        }\r\n\r\n        bufferSource[i].connect(bufferGain[i]);\r\n    }\r\n\r\n    function createPitchFadeBuffer(){\r\n        var buffer = context.createBuffer(1, bufferRate, context.sampleRate);\r\n        var pitch = buffer.getChannelData(0);\r\n            \r\n        var fadeLength = fadeTime * context.sampleRate;\r\n        var bufferLeft = bufferRate - fadeLength;\r\n        \r\n        // Buffer pitch shift\r\n        for (var i = 0; i < bufferRate; i++) {\r\n            if (i < fadeLength)\r\n                pitch[i] = Math.sqrt(i / fadeLength);\r\n            else\r\n                pitch[i] = Math.sqrt(1 - (i - bufferLeft) / fadeLength);\r\n        }\r\n\r\n        return buffer;\r\n    }\r\n\r\n    var fadeBuffer = createPitchFadeBuffer();\r\n\r\n    // Delay modulation.\r\n    var fadeNode = [0,0];\r\n    var mixNode = [0,0];\r\n    for (var i = 0; i < fadeNode.length; i++) {\r\n        fadeNode[i] = context.createBufferSource();\r\n        fadeNode[i].loop = true;\r\n        fadeNode[i].buffer = fadeBuffer;\r\n\r\n        mixNode[i] = context.createGain();\r\n    \tmixNode[i].gain.value = 0;\r\n        fadeNode[i].connect(mixNode[i].gain);\r\n\r\n        if(i % 2){ // Odd\r\n            bufferGain[i].connect(modulateGain2);\r\n\t    \tfadeNode[i].start(bTime);\r\n        }\r\n        else { // Even\r\n            bufferGain[i].connect(modulateGain1);\r\n\t    \tfadeNode[i].start(fTime);\r\n        }\r\n\r\n        mixNode[i].connect(output);\r\n    }\r\n    \r\n    delayNode1.connect(mixNode[0]);\r\n    delayNode2.connect(mixNode[1]);\r\n\r\n    function pitchGain(value){\r\n\t    modulateGain1.gain.value = \r\n\t    modulateGain2.gain.value = 0.5 * bufferTime * Math.abs(value);\r\n    }\r\n\r\n    var ret = {\r\n        // Connect to output\r\n        // output.connect(context.destination);\r\n        output:output,\r\n        input:input,\r\n\r\n        // pitchNode:[modulateGain1, modulateGain2],\r\n\r\n        shift:function(value){ // -3 ~ 3\r\n            if(value === undefined) return;\r\n\r\n            var pitchUp = value > 0;\r\n\t\t    bufferGain[0].gain.value = \r\n\t\t    bufferGain[1].gain.value = pitchUp ? 0 : 1;\r\n\t\t    bufferGain[2].gain.value = \r\n\t\t    bufferGain[3].gain.value = pitchUp ? 1 : 0;\r\n\r\n\t\t    pitchGain(value);\r\n        },\r\n\r\n        // This should be executed to clean memory\r\n        destroy:function(){\r\n            if(input) input.disconnect();\r\n            output.disconnect();\r\n\r\n            for (var i = 0; i < fadeNode.length; i++) {\r\n            \tfadeNode[i].stop();\r\n            \tfadeNode[i].disconnect();\r\n            \tmixNode[i].disconnect();\r\n            }\r\n\r\n            for (var i = 0; i < bufferSource.length; i++) {\r\n            \tbufferSource[i].stop();\r\n            \tbufferSource[i].disconnect();\r\n            \tbufferGain[i].disconnect();\r\n            }\r\n\r\n            modulateGain1.disconnect();\r\n\t\t\tmodulateGain2.disconnect();\r\n\t\t\tdelayNode1.disconnect();\r\n\t\t\tdelayNode2.disconnect();\r\n            \r\n            for(var key in this){\r\n                delete this[key];\r\n            }\r\n            output = null;\r\n        }\r\n    };\r\n\r\n    pitchGain(0);\r\n    return ret;\r\n}","ScarletsMediaEffect.reverb = function(sourceNode){\r\n\tvar context = ScarletsMedia.audioContext;\r\n\t\r\n\tvar output = context.createGain();\r\n\tvar input = sourceNode === undefined ? context.createGain() : null;\r\n\tif(input) sourceNode = input;\r\n\r\n\tvar reverbNode = context.createConvolver();\r\n\tvar wetGainNode = context.createGain();\r\n\tvar dryGainNode = context.createGain();\r\n\t\r\n\tsourceNode.connect(dryGainNode);\r\n\tdryGainNode.connect(output);\r\n\twetGainNode.connect(output);\r\n\r\n\tvar time = 1,\r\n\t\tdecay = 0.1,\r\n\t\treverse = false;\r\n\r\n\tfunction rebuildImpulse(){\r\n\t\tvar length = context.sampleRate * time;\r\n\t\tvar impulse = context.createBuffer(2, length, context.sampleRate);\r\n\t\tvar impulseL = impulse.getChannelData(0);\r\n\t\tvar impulseR = impulse.getChannelData(1);\r\n\r\n\t\tfor (var i = 0; i < length; i++) {\r\n\t\t\tvar n = reverse ? length - i : i;\r\n\t\t\timpulseL[i] = (Math.random() * 2 - 1) * Math.pow(1 - n / length, decay);\r\n\t\t\timpulseR[i] = (Math.random() * 2 - 1) * Math.pow(1 - n / length, decay);\r\n\t\t}\r\n\r\n\t    reverbNode.disconnect();\r\n\r\n\t    reverbNode = context.createConvolver();\r\n\t    sourceNode.connect(reverbNode);\r\n\t    reverbNode.connect(wetGainNode);\r\n\r\n\t\treverbNode.buffer = impulse;\r\n\t}\r\n\trebuildImpulse();\r\n\r\n\treturn {\r\n\t\t// Connect to output\r\n\t\t// output.connect(context.destination);\r\n\t\toutput:output,\r\n\t\tinput:input,\r\n\r\n\t\tmix: function(value){ // value: 0 ~ 1\r\n\t\t\tif(value === undefined) return wetGainNode.gain.value;\r\n\t\t\tdryGainNode.gain.value = 1 - value;\r\n\t\t\twetGainNode.gain.value = value;\r\n\t\t},\r\n\r\n\t\ttime: function(value){ // value: 0 ~ 3\r\n\t\t\tif(value === undefined) return time;\r\n\t\t\ttime = value;\r\n\t\t\trebuildImpulse();\r\n\t\t},\r\n\r\n\t\tdecay: function(value){// value: 0 ~ 3\r\n\t\t\tif(value === undefined) return decay;\r\n\t\t\tdecay = value;\r\n\t\t\trebuildImpulse();\r\n\t\t},\r\n\r\n\t\treverse: function(value){ // value: bool\r\n\t\t\tif(value === undefined) return reverse;\r\n\t\t\treverse = value;\r\n\t\t\trebuildImpulse();\r\n\t\t},\r\n\r\n\t\t// This should be executed to clean memory\r\n\t\tdestroy:function(){\r\n\t\t\tif(input) input.disconnect();\r\n\t\t\tdryGainNode.disconnect();\r\n\t\t\toutput.disconnect();\r\n\t\t\treverbNode.disconnect();\r\n\t\t\t\r\n\t\t\tfor(var key in this){\r\n\t\t\t\tdelete this[key];\r\n\t\t\t}\r\n\t\t\toutput = null;\r\n\t\t}\r\n\t};\r\n};","ScarletsMediaEffect.stereoPanner = function(sourceNode){\r\n\tvar context = ScarletsMedia.audioContext;\r\n\tvar output = context.createGain();\r\n\tvar input = sourceNode === undefined ? context.createGain() : null;\r\n\tif(input) sourceNode = input;\r\n\r\n\tvar stereoSupport = false;\r\n\tif(context.createStereoPanner){\r\n\t\tvar pannerNode = context.createStereoPanner();\r\n\t\tstereoSupport = true;\r\n\t}\r\n\telse {\r\n\t\tvar pannerNode = context.createPanner();\r\n\t\tpannerNode.type = 'equalpower';\r\n\t}\r\n\r\n\tsourceNode.connect(pannerNode);\r\n\tpannerNode.connect(output);\r\n\tpannerNode.pan.value = 0;\r\n\r\n\treturn {\r\n\t\t// Connect to output\r\n\t\t// output.connect(context.destination);\r\n\t\toutput:output,\r\n\t\tinput:input,\r\n\r\n\t\tset:function(pan){ // pan: -1 ~ 1\r\n\t\t\tif(pan === undefined) return pannerNode.pan.value;\r\n\t\t\tif(stereoSupport)\r\n\t\t\t\tpannerNode.pan.value = pan;\r\n\t\t\telse pannerNode.setPosition(pan, 0, 1 - Math.abs(pan));\r\n\t\t},\r\n\r\n\t\t// This should be executed to clean memory\r\n\t\tdestroy:function(){\r\n\t\t\tif(input) input.disconnect();\r\n\t\t\toutput.disconnect();\r\n\t\t\tpannerNode.disconnect();\r\n\t\t\t\r\n\t\t\tfor(var key in this){\r\n\t\t\t\tdelete this[key];\r\n\t\t\t}\r\n\t\t\toutput = pannerNode = null;\r\n\t\t}\r\n\t};\r\n};","ScarletsMediaEffect.tremolo = function(sourceNode){\r\n\tvar context = ScarletsMedia.audioContext;\r\n\tvar output = context.createGain();\r\n\tvar input = sourceNode === undefined ? context.createGain() : null;\r\n\tif(input) sourceNode = input;\r\n\r\n\tvar dryGainNode = context.createGain();\r\n\tvar wetGainNode = context.createGain();\r\n\r\n\tvar tremoloGainNode = context.createGain();\r\n\ttremoloGainNode.gain.value = 0;\r\n\r\n\tvar shaperNode = context.createWaveShaper();\r\n\tshaperNode.curve = new Float32Array([0, 1]);\r\n\tshaperNode.connect(tremoloGainNode.gain);\r\n\r\n\tsourceNode.connect(dryGainNode);\r\n\tdryGainNode.connect(output);\r\n\r\n\tvar lfoNode = context.createOscillator();\r\n\tlfoNode.connect(shaperNode);\r\n\tlfoNode.type = 'sine';\r\n\tlfoNode.start(0);\r\n\r\n\tsourceNode.connect(tremoloGainNode);\r\n\ttremoloGainNode.connect(wetGainNode);\r\n\twetGainNode.connect(output);\r\n\r\n\tvar ret = {\r\n\t\t// Connect to output\r\n\t\t// output.connect(context.destination);\r\n\t\toutput:output,\r\n\t\tinput:input,\r\n\r\n\t\tmix: function(value){ // value: 0 ~ 1\r\n\t\t\tif(value === undefined) return wetGainNode.gain.value;\r\n\t\t\tdryGainNode.gain.value = 1 - value;\r\n\t\t\twetGainNode.gain.value = value;\r\n\t\t},\r\n\t\tspeed:function(value){\r\n\t\t\tif(value === undefined) return ScarletsMedia.extra.denormalize(lfoNode.frequency.value, 0, 20);\r\n\t\t\tlfoNode.frequency.value = ScarletsMedia.extra.normalize(value, 0, 20);\r\n\t\t},\r\n\t\tdepth:function(value){\r\n\t\t\tif(value === undefined) return 1 - this.shaperNode.curve[0];\r\n\t\t\tshaperNode.curve = new Float32Array([1 - value, 1]);\r\n\t\t},\r\n\r\n\t\t// This should be executed to clean memory\r\n\t\tdestroy:function(){\r\n\t\t\tif(input) input.disconnect();\r\n\t\t\toutput.disconnect();\r\n\t\t\tdryGainNode.disconnect();\r\n\t\t\ttremoloGainNode.disconnect();\r\n\t\t\t\r\n\t\t\tfor(var key in this){\r\n\t\t\t\tdelete this[key];\r\n\t\t\t}\r\n\t\t\toutput = null;\r\n\t\t}\r\n\t};\r\n\r\n\tret.speed(0.2);\r\n\tret.depth(1);\r\n\tret.mix(0.8);\r\n\r\n\treturn ret;\r\n};","ScarletsMediaEffect.vibrato = function(sourceNode){\r\n\tvar context = ScarletsMedia.audioContext;\r\n\tvar output = context.createGain();\r\n\tvar input = sourceNode === undefined ? context.createGain() : null;\r\n\tif(input) sourceNode = input;\r\n\r\n\tconsole.log(\"Vibrato was not finished yet\");\r\n\r\n    var delayNode = context.createDelay();\r\n\tvar wetGainNode = context.createGain();\r\n\tvar dryGainNode = context.createGain();\r\n    var lfoNode = context.createOscillator();\r\n    //var depthNode = context.createGain();\r\n\r\n\tsourceNode.connect(dryGainNode);\r\n\tdryGainNode.connect(output);\r\n\twetGainNode.connect(output);\r\n\r\n    delayNode.delayTime.value = 1;\r\n    //depthNode.gain.value = 1;\r\n    lfoNode.frequency.value = 3;\r\n    lfoNode.type = 'sine';\r\n    lfoNode.start(0);\r\n\r\n    lfoNode.connect(delayNode.delayTime);\r\n    //depthNode.connect(delayNode.delayTime);\r\n    sourceNode.connect(delayNode);\r\n    delayNode.connect(wetGainNode);\r\n\r\n\treturn {\r\n\t\t// Connect to output\r\n\t\t// output.connect(context.destination);\r\n\t\toutput:output,\r\n\t\tinput:input,\r\n\t\t\r\n\t\tmix:function(value){ // value: 0 ~ 1\r\n\t\t\tif(value === undefined) return wetGainNode.gain.value;\r\n\t\t\tdryGainNode.gain.value = 1 - value;\r\n\t\t\twetGainNode.gain.value = value;\r\n\t\t},\r\n\t\t\r\n\t\tdelay:function(value){\r\n\t\t\tif(value === undefined) return delayNode.delayTime.value;\r\n\t\t\tdelayNode.delayTime.value = value;\r\n\t\t},\r\n\t\t\r\n\t\tdepth:function(value){\r\n\t\t\tif(value === undefined) return depthNode.gain.value;\r\n\t\t\tdepthNode.gain.value = value;\r\n\t\t},\r\n\t\t\r\n\t\tspeed:function(value){\r\n\t\t\tif(value === undefined) return lfoNode.frequency.value;\r\n\t\t\tlfoNode.frequency.value = value;\r\n\t\t},\r\n\r\n\t\t// This should be executed to clean memory\r\n\t\tdestroy:function(){\r\n\t\t\tif(input) input.disconnect();\r\n\t\t\toutput.disconnect();\r\n\r\n    \t\tsourceNode.disconnect(delayNode);\r\n    \t\tsourceNode.disconnect(dryGainNode);\r\n\r\n\t\t\tlfoNode.stop();\r\n\t\t\tlfoNode.disconnect();\r\n\t\t\tdepthNode.disconnect();\r\n\t\t\t\r\n\t\t\tfor(var key in this){\r\n\t\t\t\tdelete this[key];\r\n\t\t\t}\r\n\t\t\toutput = null;\r\n\t\t}\r\n\t};\r\n};","// Minimum 3 bufferElement\r\nvar ScarletsVideoStreamer = function(videoElement, chunksDuration){\r\n\tif(!chunksDuration) chunksDuration = 1000;\r\n\tvar chunksSeconds = chunksDuration/1000;\r\n\r\n\tvar scope = this;\r\n\r\n\tscope.debug = false;\r\n\tscope.playing = false;\r\n\tscope.latency = 0;\r\n\tscope.mimeType = null;\r\n\r\n\tscope.audioContext = ScarletsMedia.audioContext;\r\n\tscope.outputNode = false; // Set this to a connectable Audio Node\r\n\r\n\t// If the outputNode is not set, then the audio will be outputted directly\r\n\tvar directAudioOutput = true;\r\n\r\n\tvar mediaBuffer = false;\r\n\tvar audioNode = scope.audioContext.createMediaElementSource(videoElement);\r\n\r\n\tscope.audioConnect = function(node){\r\n\t\tif(directAudioOutput === true){\r\n\t\t\tdirectAudioOutput = false;\r\n\t\t\taudioNode.disconnect();\r\n\t\t}\r\n\r\n\t\tscope.outputNode = scope.audioContext.createGain();\r\n\t\tscope.outputNode.connect(node);\r\n\t\taudioNode.connect(node);\r\n\t}\r\n\r\n\tscope.audioDisconnect = function(){\r\n\t\toutputNode.disconnect();\r\n\t\tdirectAudioOutput = true;\r\n\r\n\t\taudioNode.disconnect();\r\n\t\taudioNode.connect(scope.audioContext.destination);\r\n\t}\r\n\r\n\tscope.stop = function(){\r\n\t\tmediaBuffer.stop();\r\n\t\tscope.playing = false;\r\n\t\tscope.buffering = false;\r\n\t}\r\n\r\n\tscope.setBufferHeader = function(packet){\r\n\t\tif(!packet || !packet.data)\r\n\t\t\treturn;\r\n\r\n\t\tvar arrayBuffer = packet.data;\r\n\t\tscope.mimeType = packet.mimeType;\r\n\r\n\t\tif(mediaBuffer !== false)\r\n\t\t\tmediaBuffer.stop();\r\n\t\telse audioNode.connect(scope.audioContext.destination);\r\n\r\n\t\tmediaBuffer = new MediaBuffer(scope.mimeType, chunksDuration, arrayBuffer);\r\n\r\n\t\tconsole.log(mediaBuffer);\r\n\t\tvideoElement.src = scope.objectURL = mediaBuffer.objectURL;\r\n\t}\r\n\r\n\tscope.playStream = function(){\r\n\t\tscope.playing = true;\r\n\t}\r\n\r\n\tscope.receiveBuffer = function(arrayBuffer){\r\n\t\tif(scope.playing === false || !mediaBuffer.append) return;\r\n\r\n\t\tmediaBuffer.append(arrayBuffer[0]);\r\n\r\n\t\tif(videoElement.paused)\r\n\t\t\tvideoElement.play();\r\n\r\n\t\tscope.latency = (Number(String(Date.now()).slice(-5, -3)) - arrayBuffer[1]) + scope.audioContext.baseLatency + chunksSeconds;\r\n\t\tif(scope.debug) console.log(\"Total latency: \"+scope.latency);\r\n\t}\r\n}","ScarletsMedia.extra = new function(){\r\n\tvar self = this;\r\n\tself.isMobile = function(){\r\n\t    return /iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(navigator.userAgent);\r\n\t}\r\n\r\n\tself.objectPropertyLinker = function(self, target, property){\r\n\t\tObject.defineProperty(self, property, {\r\n\t\t  get: function(){ return target[property]; },\r\n\t\t  set: function(value){ target[property] = value; },\r\n\t\t  enumerable: true,\r\n\t\t  configurable: true\r\n\t\t});\r\n\t}\r\n\r\n\tself.normalize = function(value, min, max){\r\n\t\treturn ((max - min) * value) + min;\r\n\t}\r\n\r\n\tself.denormalize = function(value, min, max){\r\n\t\treturn (value - min) / (max - min);\r\n\t}\r\n\r\n\tvar maxFade = 0;\r\n\tself.fadeNumber = function(from, to, increment, fadeTime, onIncrease, onFinish){\r\n\t\tmaxFade = 0;\r\n\t\tvar current = from;\r\n\t\tvar interval = fadeTime/(Math.abs(from-to)/Math.abs(increment));\r\n\t\tif(!interval || interval == Infinity){\r\n\t\t\tsetTimeout(function(){\r\n\t\t\t\tif(onIncrease) onIncrease(to);\r\n\t\t\t\tif(onFinish) onFinish();\r\n\t\t\t}, fadeTime);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar timer = setInterval(function(){\r\n\t\t\tif(maxFade>=100) clearInterval(timer);\r\n\t\t\tmaxFade++;\r\n\t\t\r\n\t\t\tcurrent = (current+increment)*1000;\r\n\t\t\tcurrent = Math.ceil(current)/1000;\r\n\t\t\r\n\t\t\t//Increasing and current is more than target\r\n\t\t\tif((increment >= 0 && (current >= to || from >= to))\r\n\t\t\t\t||\r\n\t\t\t//Decreasing and current is lower than target\r\n\t\t\t(increment <= 0 && (current <= to || from <= to))\r\n\t\t\t\t||\r\n\t\t\t//Infinity or Zero number\r\n\t\t\t(current == Infinity || !current))\r\n\t\t\t{\r\n\t\t\t\tclearInterval(timer);\r\n\t\t\t\tonIncrease(to);\r\n\t\t\t\tif(onFinish) onFinish();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(onIncrease) onIncrease(current); \r\n\t\t}, interval);\r\n\t}\r\n\r\n\t// ===== Precise Timer =====\r\n\t// \r\n\tvar timeout = [];\r\n\tvar timeoutIncrement = 0;\r\n\tself.preciseTimeout = function(func, miliseconds){\r\n\t\tvar now = Date.now();\r\n\t\ttimeoutIncrement++;\r\n\t\ttimeout.push({\r\n\t\t\tid:timeoutIncrement,\r\n\t\t\twhen:now+miliseconds,\r\n\t\t\tfunc:func,\r\n\r\n\t\t\t// When browser loss focus\r\n\t\t\tfallback:setTimeout(function(){\r\n\t\t\t\tclearPreciseTimer(timeoutIncrement).func();\r\n\t\t\t}, miliseconds)\r\n\t\t});\r\n\t\tstartPreciseTime();\r\n\t\treturn timeoutIncrement;\r\n\t}\r\n\tself.clearPreciseTimeout = function(id){\r\n\t\tclearPreciseTimer(id, timeout);\r\n\t}\r\n\r\n\tvar interval = [];\r\n\tvar intervalIncrement = 0;\r\n\tself.preciseInterval = function(func, miliseconds){\r\n\t\tvar now = Date.now();\r\n\t\tintervalIncrement++;\r\n\t\tvar temp = {\r\n\t\t\tid:intervalIncrement,\r\n\t\t\tinterval:miliseconds,\r\n\t\t\twhen:now+miliseconds,\r\n\t\t\tfunc:func\r\n\t\t};\r\n\r\n\t\t// When browser loss focus\r\n\t\ttemp.fallback = setInterval(function(){\r\n\t\t\tif(temp.when >= Date.now())\r\n\t\t\t\treturn; // Avoid multiple call\r\n\r\n\t\t\ttemp.when += temp.interval;\r\n\t\t\ttemp.func();\r\n\t\t}, miliseconds);\r\n\r\n\t\tinterval.push(temp);\r\n\t\tstartPreciseTime();\r\n\t\treturn intervalIncrement;\r\n\t}\r\n\tself.clearPreciseInterval = function(id){\r\n\t\tvar temp = clearPreciseTimer(id, interval);\r\n\t\tclearInterval(temp.fallback);\r\n\t}\r\n\r\n\tfunction clearPreciseTimer(id, list){\r\n\t\tfor (var i in list) {\r\n\t\t\tif(list[i].id === id)\r\n\t\t\t\treturn list.splice(i, 1);\r\n\t\t}\r\n\t}\r\n\r\n\tvar preciseTimerStarted = false;\r\n\tfunction startPreciseTime(){\r\n\t\tif(preciseTimerStarted) return;\r\n\t\tpreciseTimerStarted = true;\r\n\r\n\t\tvar preciseTimer = function(){\r\n\t\t\tif(timeout.length === 0 && interval.length === 0){\r\n\t\t\t\tpreciseTimerStarted = false;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\trequestAnimationFrame(preciseTimer);\r\n\t\t\t\r\n\t\t\tvar currentTime = Date.now();\r\n\t\t\tfor (var i in timeout) {\r\n\t\t\t\tif(timeout[i].when < currentTime){\r\n\t\t\t\t\ttimeout[i].func();\r\n\t\t\t\t\tclearTimeout(timeout[i].fallback);\r\n\t\t\t\t\ttimeout.splice(i, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i in interval) {\r\n\t\t\t\tif(interval[i].when < currentTime){\r\n\t\t\t\t\tinterval[i].func();\r\n\t\t\t\t\tinterval[i].when += interval[i].interval;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\trequestAnimationFrame(preciseTimer);\r\n\t}\r\n};\r\n\r\nif(moduleMode){\r\n\tglobal.Media = ScarletsMedia;\r\n\tglobal.MediaEffect = ScarletsMediaEffect;\r\n\tglobal.AudioStreamer = ScarletsAudioStreamer;\r\n\tglobal.VideoStreamer = ScarletsVideoStreamer;\r\n\tglobal.MediaPlayer = ScarletsMediaPlayer;\r\n\tglobal.MediaPresenter = ScarletsMediaPresenter;\r\n}\r\nelse{\r\n\tglobal.ScarletsMedia = ScarletsMedia;\r\n\tglobal.ScarletsMediaEffect = ScarletsMediaEffect;\r\n\tglobal.ScarletsAudioStreamer = ScarletsAudioStreamer;\r\n\tglobal.ScarletsVideoStreamer = ScarletsVideoStreamer;\r\n\tglobal.ScarletsMediaPlayer = ScarletsMediaPlayer;\r\n\tglobal.ScarletsMediaPresenter = ScarletsMediaPresenter;\r\n}\r\n\r\n// ===== Module End =====\r\n})));"]}